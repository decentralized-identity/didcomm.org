<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/styles.css" data-identity="gatsby-global-css">:root{--color-primary:#29679c;--color-primary-hover:#245a88;--color-primary-pressed:#204f78;--color-secondary:#f1c232;--color-secondary-hover:#e5b82f;--color-secondary-pressed:#d9af2d;--color-error:#ef2727;--color-background:#fff;--color-background-primary:rgba(41,103,156,0.07);--color-background-primary-hover:rgba(41,103,156,0.15);--color-background-primary-pressed:rgba(41,103,156,0.21);--color-background-secondary:#fdf6e0;--color-text-primary:#000;--color-text-secondary:#666;--color-tertiary:#999;--color-production:#1fad3e;--color-background-production:rgba(31,173,62,0.07);--color-demonstrated:#d9af2d;--color-background-demonstrated:rgba(217,175,45,0.1);--color-proposed:#666;--color-background-proposed:hsla(0,0%,40%,0.07)}*,:after,:before{box-sizing:border-box;margin:0;padding:0}a{text-decoration:none}button{background:none;border:none}ol,ul{list-style:none}fieldset{border:none}body{color:var(--color-text-primary);font-family:Inter,sans-serif;font-size:17px;font-weight:400;line-height:24px}.content{margin:0 auto;max-width:1296px;padding:72px 32px}@media screen and (max-width:768px){.content{padding:48px 16px}}.font-caption{font-size:12px}.font-caption,.font-footnote{font-weight:400;line-height:16px}.font-footnote{font-size:13px}.font-subheadline{font-size:15px;font-weight:500;line-height:20px}.font-callout{font-size:16px;font-weight:600;line-height:24px}.font-body{font-weight:400}.font-body,.font-headline{font-size:17px;line-height:24px}.font-headline,.font-title-3{font-weight:600}.font-title-3{font-size:20px;line-height:32px}.font-title-2{font-size:22px;font-weight:700;line-height:32px}.font-title-1{font-size:28px;font-weight:800;line-height:32px}.font-title-large{font-size:34px;font-weight:900;line-height:40px}.visually-hidden{clip:rect(0 0 0 0);border:0;height:1px;margin:-1px;overflow:hidden;padding:0;position:absolute;width:1px}.rounded{border-radius:4px}.shadow-medium{box-shadow:0 12px 12px rgba(0,0,0,.03),0 8px 16px rgba(0,0,0,.03),0 1px 24px rgba(0,0,0,.03)}.grid-3{grid-column-gap:72px;grid-row-gap:24px;display:grid;grid-template-columns:repeat(3,1fr);height:100%;width:100%}@media screen and (max-width:768px){.grid-3{grid-template-columns:1fr}.hide-mobile{display:none}}@media screen and (min-width:768px){.hide-desktop{display:none}}@media print{.hide-print{display:none}}.no-scroll{height:100%;overflow:hidden}button:focus,button:hover{cursor:pointer}.emoji-icon{display:inline!important;margin:1px 0 0!important;position:relative!important;top:5px!important;width:25px!important}.task-list-item{list-style-type:none}.Header-module--header--1Qt4T{background-color:var(--color-background);color:var(--color-text-primary);padding:12px 32px}@media screen and (max-width:768px){.Header-module--header--1Qt4T{padding:12px 16px}}.Header-module--container--3KhaC{align-items:center;display:grid;grid-template-columns:200px 1fr 200px;margin:0 auto;max-width:1376px;width:100%}@media screen and (max-width:768px){.Header-module--container--3KhaC{grid-column-gap:16px;grid-template-columns:auto 1fr}}.Header-module--search--ucYp8{display:flex;justify-content:center}.Header-module--search--ucYp8:empty+.Header-module--linksContainer--WRDuP{display:block;grid-column:3;grid-row:1}.Header-module--active--1N9yZ{pointer-events:none}.Header-module--primary--yIDLc{background-color:var(--color-primary);color:var(--color-background)}.Header-module--logo--RPmCm{align-items:center;color:inherit;display:flex}.Header-module--logo--RPmCm:hover{color:var(--color-secondary-hover)}.Header-module--logo--RPmCm:focus{color:var(--color-secondary-pressed)}.Header-module--logoImg--f8A17{display:block;height:48px;width:48px}.Header-module--logoText--EwM4-{margin-left:16px}.Header-module--links--3cZB-{display:flex;justify-content:flex-end}.Header-module--link--4ebYS{color:inherit;margin-left:16px}.Header-module--link--4ebYS:hover{color:var(--color-secondary-hover)}.Header-module--link--4ebYS:focus{color:var(--color-secondary-pressed)}.Layout-module--layout--36KWw{background-color:var(--color-background);min-height:100vh}.Layout-module--primary--3dHHh{background-color:var(--color-background-primary)}.Layout-module--accent--3cy0V{background-color:var(--color-primary)}.Features-module--feature--2-Z3l{display:grid;grid-template-columns:auto;grid-template-rows:auto auto auto}@media screen and (max-width:768px){.Features-module--feature--2-Z3l{grid-template-columns:auto 1fr;grid-template-rows:auto auto}}.Features-module--icon--3Lduc{grid-row:1;height:72px;width:72px}@media screen and (max-width:768px){.Features-module--icon--3Lduc{grid-column:2;height:32px;margin-left:8px;width:32px}}.Features-module--title--1TZf3{grid-column:span 2;grid-row:2;margin:32px 0 24px}@media screen and (max-width:768px){.Features-module--title--1TZf3{font-size:20px;font-weight:600;grid-column:1;grid-row:1;line-height:32px;margin:0 0 12px}}.Features-module--text--LRQ-w{grid-column:span 2}.Features-module--text--LRQ-w a{color:var(--color-primary)}.Features-module--text--LRQ-w a:hover{color:var(--color-primary-hover)}.Features-module--text--LRQ-w a:focus{color:var(--color-primary-pressed)}.Book-module--title--3XmVr{margin-bottom:72px;word-break:break-word}@media screen and (max-width:768px){.Book-module--title--3XmVr{font-size:28px;font-weight:800;line-height:32px;margin-bottom:24px}}@media print{.Book-module--title--3XmVr{margin-bottom:40px}}.Book-module--body--Hy0rr{grid-column:span 2;overflow:hidden;word-break:break-word}@media screen and (max-width:768px){.Book-module--body--Hy0rr{grid-column:1}}@media print{.Book-module--body--Hy0rr{grid-column:span 3;overflow:visible}}.Book-module--body--Hy0rr>:first-child{margin-top:0}.Book-module--body--Hy0rr h1,.Book-module--body--Hy0rr h2{font-size:22px;font-weight:700;line-height:32px}.Book-module--body--Hy0rr h3{font-size:20px;font-weight:600;line-height:32px}.Book-module--body--Hy0rr h4,.Book-module--body--Hy0rr h5,.Book-module--body--Hy0rr h6{font-size:1rem}.Book-module--body--Hy0rr h1,.Book-module--body--Hy0rr h2,.Book-module--body--Hy0rr h3,.Book-module--body--Hy0rr h4,.Book-module--body--Hy0rr h5,.Book-module--body--Hy0rr h6{margin-bottom:16px;margin-top:24px}.Book-module--body--Hy0rr ol,.Book-module--body--Hy0rr p,.Book-module--body--Hy0rr table,.Book-module--body--Hy0rr ul{margin-bottom:16px}.Book-module--body--Hy0rr a{color:var(--color-primary)}.Book-module--body--Hy0rr a:hover{color:var(--color-primary-hover)}.Book-module--body--Hy0rr a:focus{color:var(--color-primary-pressed)}.Book-module--body--Hy0rr ul{list-style:initial}.Book-module--body--Hy0rr ul ul{list-style:circle}.Book-module--body--Hy0rr ul ul ul{list-style-type:square}.Book-module--body--Hy0rr ol{list-style:initial}.Book-module--body--Hy0rr ol,.Book-module--body--Hy0rr ul{padding-left:1.5em}.Book-module--body--Hy0rr hr{margin:8px 0}.Book-module--body--Hy0rr pre{background-color:var(--color-background-primary);margin-bottom:8px;padding:24px 32px;white-space:pre-wrap}.Book-module--body--Hy0rr code,.Book-module--body--Hy0rr tt{background-color:var(--color-background-primary);padding:0 .2em}.Book-module--body--Hy0rr pre code,.Book-module--body--Hy0rr pre tt{background-color:transparent}.Book-module--body--Hy0rr iframe,.Book-module--body--Hy0rr img,.Book-module--body--Hy0rr video{margin-bottom:8px;max-width:100%}.Book-module--body--Hy0rr blockquote{border-left:.25em solid var(--color-tertiary);color:var(--color-text-secondary);padding:0 1em}.Book-module--body--Hy0rr table{border-collapse:collapse;border-spacing:0;overflow:auto;width:100%;word-break:keep-all}.Book-module--body--Hy0rr table tr{background-color:var(--color-background);border-top:1px solid var(--color-tertiary)}.Book-module--body--Hy0rr table th{font-weight:700;text-align:left}.Book-module--body--Hy0rr table td,.Book-module--body--Hy0rr table th{border:1px solid var(--color-tertiary);padding:4px 8px}@media print,screen and (max-width:768px){.Book-module--meta--2P1gP{grid-row:1}}@media print{.Book-module--meta--2P1gP{grid-column:span 3}}.Book-module--metaTitle--1KE11{margin-bottom:16px}@media screen and (max-width:768px){.Book-module--metaTitle--1KE11{display:none}}@media print{.Book-module--metaTitle--1KE11{flex-shrink:0;margin-bottom:0}.Book-module--metaTitle--1KE11:after{content:": ";padding-right:1em}}.Book-module--metaContent--1z1bA{align-items:flex-start;display:flex;flex-direction:column;margin-bottom:40px;word-break:break-word}@media print,screen and (max-width:768px){.Book-module--metaContent--1z1bA{margin-bottom:24px}}@media print{.Book-module--metaContent--1z1bA{align-items:baseline;flex-direction:row;margin-bottom:8px}}.Book-module--version--161Eu{display:none}@media print,screen and (max-width:768px){.Book-module--version--161Eu{color:var(--color-text-secondary);display:inline;margin-left:8px}}.Pagination-module--pagination--3KtNE{grid-column-gap:24px;display:grid;grid-template-columns:repeat(3,-webkit-min-content);grid-template-columns:repeat(3,min-content);margin-top:48px}@media screen and (max-width:768px){.Pagination-module--pagination--3KtNE{grid-row-gap:16px;grid-template-columns:auto auto}}.Pagination-module--pages--1Bqv1{grid-column-gap:8px;display:grid;grid-template-columns:repeat(5,42px)}.Pagination-module--page--1qgQC{background-color:var(--color-background);height:48px;width:100%}.Pagination-module--page--1qgQC:focus,.Pagination-module--page--1qgQC:hover{background-color:var(--color-background-secondary)}.Pagination-module--page--1qgQC:disabled{color:var(--color-text)}.Pagination-module--next--PX9hj{background-color:var(--color-background);padding:12px 24px}@media screen and (max-width:768px){.Pagination-module--next--PX9hj{grid-column:span 2}}.Pagination-module--current--2kpSb,.Pagination-module--next--PX9hj:focus,.Pagination-module--next--PX9hj:hover{background-color:var(--color-background-secondary)}.Pagination-module--current--2kpSb{box-shadow:0 12px 12px rgba(0,0,0,.03),0 8px 16px rgba(0,0,0,.03),0 1px 24px rgba(0,0,0,.03);pointer-events:none}.Pagination-module--ellipsis--1_1fQ{align-items:center;display:flex;justify-content:center}.Status-module--status--1dG8s{border-radius:4px;font-size:12px;font-weight:400;line-height:16px;padding:4px 8px}@media print{.Status-module--status--1dG8s{background:transparent!important;color:var(--color-text-primary)!important;padding:0!important}}.Status-module--proposed--3zY0z{background-color:var(--color-background-proposed);color:var(--color-proposed)}.Status-module--production--6xwxX{background-color:var(--color-background-production);color:var(--color-production)}.Status-module--demonstrated--2VaNN{background-color:var(--color-background-demonstrated);color:var(--color-demonstrated)}.Avatar-module--avatar--2HGSY{align-items:center;display:flex}.Avatar-module--img--3CeLS{background-color:var(--color-text-secondary);background-size:cover;border-radius:50%;height:24px;margin-right:8px;width:24px}@media print{.Avatar-module--img--3CeLS{display:none}}.Avatar-module--publisher--ktcuv{color:var(--color-primary)}.Avatar-module--avatar--2HGSY:hover .Avatar-module--publisher--ktcuv{color:var(--color-primary-hover)}.Avatar-module--avatar--2HGSY:focus .Avatar-module--publisher--ktcuv{color:var(--color-primary-pressed)}.Tags-module--tags--11-St{display:flex;flex-wrap:wrap;margin-top:-8px}.Tags-module--tags--11-St>*{margin-top:8px}.Tags-module--tags--11-St>:not(:last-child){margin-right:16px}.Tags-module--tag--14doh{border:2px solid var(--color-text-primary);border-radius:4px;color:var(--color-text-primary);font-size:12px;font-weight:400;line-height:16px;padding:4px 8px}.Tags-module--tag--14doh:hover{color:var(--color-primary-hover)}.Tags-module--tag--14doh:focus-visible{color:var(--color-primary-pressed)}@media print{.Tags-module--tag--14doh{border:none;padding:0}}.ProtocolsListItem-module--item--DycmU{background-color:var(--color-background);padding:24px 32px;width:100%;word-break:break-word}.ProtocolsListItem-module--header--17jzv{align-items:center;display:flex;flex-wrap:wrap;justify-content:space-between}@media screen and (max-width:768px){.ProtocolsListItem-module--header--17jzv{align-items:flex-start;flex-direction:column}}.ProtocolsListItem-module--title--1k0xw{color:var(--color-primary)}.ProtocolsListItem-module--title--1k0xw:hover{color:var(--color-primary-hover)}.ProtocolsListItem-module--title--1k0xw:focus{color:var(--color-primary-pressed)}@media screen and (max-width:768px){.ProtocolsListItem-module--title--1k0xw{margin-bottom:12px}}.ProtocolsListItem-module--version--1_-CI{color:var(--color-text-secondary);margin-left:8px}.ProtocolsListItem-module--summary--28MAv{margin:12px 0}.ProtocolsListItem-module--avatar--57tBG,.ProtocolsListItem-module--lastModified--3Yt0s{margin-right:16px}@media screen and (max-width:768px){.ProtocolsListItem-module--avatar--57tBG{margin-top:12px;width:100%}}.ProtocolsListItem-module--footer--35Vqh{align-items:center;display:flex;flex-direction:row-reverse;flex-wrap:wrap;justify-content:flex-end;margin-top:24px}.ProtocolsListItem-module--footer--35Vqh>:nth-child(0){order:2}.ProtocolsListItem-module--footer--35Vqh>:first-child{order:1}.ProtocolsList-module--list--1Ndxz{grid-row-gap:16px;display:grid}.Search-module--search--3XfRF{align-items:center;display:flex;max-width:514px;position:relative;width:100%}.Search-module--input--1o6QO{background-color:var(--color-background);border:1px solid transparent;box-shadow:0 12px 12px rgba(0,0,0,.03),0 8px 16px rgba(0,0,0,.03),0 1px 24px rgba(0,0,0,.03);flex-shrink:0;font-size:17px;font-weight:400;line-height:24px;padding:12px 72px 12px 16px;width:100%}.Search-module--input--1o6QO:focus,.Search-module--input--1o6QO:hover{border-color:var(--color-tertiary);box-shadow:0 12px 24px rgba(0,0,0,.06),0 8px 32px rgba(0,0,0,.06),0 4px 48px rgba(0,0,0,.06);outline:none}.Search-module--bordered--34QxG{border-color:var(--color-tertiary)}.Search-module--input--1o6QO:not(:-moz-placeholder-shown)+.Search-module--placeholder--97f4S{display:none}.Search-module--input--1o6QO:not(:placeholder-shown)+.Search-module--placeholder--97f4S{display:none}@media screen and (max-width:920px){.Search-module--placeholderExtraText--3R9o1{display:none}}.Search-module--placeholder--97f4S{color:var(--color-text-secondary);cursor:text;left:16px;position:absolute;-webkit-user-select:none;-moz-user-select:none;user-select:none}.Search-module--button--xD1TT{color:var(--color-tertiary);position:absolute;right:16px}.Search-module--button--xD1TT:focus,.Search-module--button--xD1TT:hover{color:var(--color-secondary-hover)}.Search-module--iconMagnify--j1Q9O{color:currentColor;height:24px;width:24px}.Search-module--clearButton--3MgzD{color:var(--color-text-primary);height:24px;position:absolute;right:48px;width:24px}.Search-module--clearButton--3MgzD:focus,.Search-module--clearButton--3MgzD:hover{color:var(--color-secondary-hover)}.Search-module--input--1o6QO:-moz-placeholder-shown+.Search-module--placeholder--97f4S+.Search-module--clearButton--3MgzD{display:none}.Search-module--input--1o6QO:placeholder-shown+.Search-module--placeholder--97f4S+.Search-module--clearButton--3MgzD{display:none}.Search-module--iconCross--3dnWa{color:inherit;height:24px;width:24px}._404-module--main--1taou{margin:auto;max-width:620px;width:100%}._404-module--oops--3prb5{-webkit-text-stroke:2px var(--color-secondary);color:transparent;font-size:90px;font-style:normal;font-weight:900;line-height:90px;margin-bottom:48px;text-align:center}._404-module--title--2sRC_{color:var(--color-background);margin-bottom:24px;text-align:center}._404-module--subtitle--IEi-H{color:var(--color-secondary);margin-bottom:32px;text-align:center}._404-module--search--3zs_3{display:flex;justify-content:center}@media screen and (max-width:768px){._404-module--search--3zs_3{align-items:center;bottom:16px;left:0;padding:0 16px;position:absolute;width:100%}}.Hero-module--hero--1iQtF{align-items:center;background-color:var(--color-primary);color:var(--color-background);display:flex;flex-direction:column;height:50%;padding:72px 32px;text-align:center}.Hero-module--subtitle--2Ew33{margin:16px 0 48px}@media screen and (max-width:768px){.Hero-module--subtitle--2Ew33{margin-bottom:32px}}.Hero-module--browseAll--2HlV5{margin-top:16px}.Hero-module--browseAllLink--2T_ua{color:inherit;text-decoration:underline}.Hero-module--browseAllLink--2T_ua:hover{color:var(--color-secondary-hover)}.Hero-module--browseAllLink--2T_ua:focus{color:var(--color-secondary-pressed)}.Protocol-module--title--1yzjp{margin-bottom:72px;word-break:break-word}@media screen and (max-width:768px){.Protocol-module--title--1yzjp{font-size:28px;font-weight:800;line-height:32px;margin-bottom:24px}}@media print{.Protocol-module--title--1yzjp{margin-bottom:40px}}.Protocol-module--body--3yTdm{grid-column:span 2;overflow:hidden;word-break:break-word}@media screen and (max-width:768px){.Protocol-module--body--3yTdm{grid-column:1}}@media print{.Protocol-module--body--3yTdm{grid-column:span 3;overflow:visible}}.Protocol-module--body--3yTdm>:first-child{margin-top:0}.Protocol-module--body--3yTdm h1,.Protocol-module--body--3yTdm h2{font-size:22px;font-weight:700;line-height:32px}.Protocol-module--body--3yTdm h3{font-size:20px;font-weight:600;line-height:32px}.Protocol-module--body--3yTdm h4,.Protocol-module--body--3yTdm h5,.Protocol-module--body--3yTdm h6{font-size:1rem}.Protocol-module--body--3yTdm h1,.Protocol-module--body--3yTdm h2,.Protocol-module--body--3yTdm h3,.Protocol-module--body--3yTdm h4,.Protocol-module--body--3yTdm h5,.Protocol-module--body--3yTdm h6{margin-bottom:16px;margin-top:24px}.Protocol-module--body--3yTdm ol,.Protocol-module--body--3yTdm p,.Protocol-module--body--3yTdm table,.Protocol-module--body--3yTdm ul{margin-bottom:16px}.Protocol-module--body--3yTdm a{color:var(--color-primary)}.Protocol-module--body--3yTdm a:hover{color:var(--color-primary-hover)}.Protocol-module--body--3yTdm a:focus{color:var(--color-primary-pressed)}.Protocol-module--body--3yTdm ul{list-style:initial}.Protocol-module--body--3yTdm ul ul{list-style:circle}.Protocol-module--body--3yTdm ul ul ul{list-style-type:square}.Protocol-module--body--3yTdm ol{list-style:initial}.Protocol-module--body--3yTdm ol,.Protocol-module--body--3yTdm ul{padding-left:1.5em}.Protocol-module--body--3yTdm hr{margin:8px 0}.Protocol-module--body--3yTdm pre{background-color:var(--color-background-primary);margin-bottom:8px;padding:24px 32px;white-space:pre-wrap}.Protocol-module--body--3yTdm code,.Protocol-module--body--3yTdm tt{background-color:var(--color-background-primary);padding:0 .2em}.Protocol-module--body--3yTdm pre code,.Protocol-module--body--3yTdm pre tt{background-color:transparent}.Protocol-module--body--3yTdm iframe,.Protocol-module--body--3yTdm img,.Protocol-module--body--3yTdm video{margin-bottom:8px;max-width:100%}.Protocol-module--body--3yTdm blockquote{border-left:.25em solid var(--color-tertiary);color:var(--color-text-secondary);padding:0 1em}.Protocol-module--body--3yTdm table{border-collapse:collapse;border-spacing:0;overflow:auto;width:100%;word-break:keep-all}.Protocol-module--body--3yTdm table tr{background-color:var(--color-background);border-top:1px solid var(--color-tertiary)}.Protocol-module--body--3yTdm table th{font-weight:700;text-align:left}.Protocol-module--body--3yTdm table td,.Protocol-module--body--3yTdm table th{border:1px solid var(--color-tertiary);padding:4px 8px}@media print,screen and (max-width:768px){.Protocol-module--meta--1e1pP{grid-row:1}}@media print{.Protocol-module--meta--1e1pP{grid-column:span 3}}.Protocol-module--metaTitle--PGKpJ{margin-bottom:16px}@media screen and (max-width:768px){.Protocol-module--metaTitle--PGKpJ{display:none}}@media print{.Protocol-module--metaTitle--PGKpJ{flex-shrink:0;margin-bottom:0}.Protocol-module--metaTitle--PGKpJ:after{content:": ";padding-right:1em}}.Protocol-module--metaContent--1hPYi{align-items:flex-start;display:flex;flex-direction:column;margin-bottom:40px;word-break:break-word}@media print,screen and (max-width:768px){.Protocol-module--metaContent--1hPYi{margin-bottom:24px}}@media print{.Protocol-module--metaContent--1hPYi{align-items:baseline;flex-direction:row;margin-bottom:8px}}.Protocol-module--version--vKpW5{display:none}@media print,screen and (max-width:768px){.Protocol-module--version--vKpW5{color:var(--color-text-secondary);display:inline;margin-left:8px}}.Authors-module--authors--fKUTX{display:flex;flex-wrap:wrap;margin-top:-8px}.Authors-module--authors--fKUTX>*{margin-top:8px}.Authors-module--authors--fKUTX>:not(:last-child){margin-right:16px}.Authors-module--link--2M7F6{color:var(--color-primary)}.Authors-module--link--2M7F6:hover{color:var(--color-primary-hover)}.Authors-module--link--2M7F6:focus{color:var(--color-primary-pressed)}.Checkbox-module--check--15cne{grid-column-gap:16px;align-items:center;cursor:pointer;display:grid;grid-template-columns:auto 1fr;word-break:break-word}.Checkbox-module--checkbox--2mZlv{align-items:center;display:flex;height:32px;justify-content:center;width:32px}.Checkbox-module--checkbox--2mZlv:before{border:2px solid var(--color-text-primary);border-radius:4px;content:"";display:block;height:18px;width:18px}.Checkbox-module--input--3BKOi:focus-visible+.Checkbox-module--checkbox--2mZlv,.Checkbox-module--input--3BKOi:hover+.Checkbox-module--checkbox--2mZlv{background-color:var(--color-background-primary)}.Checkbox-module--input--3BKOi:focus-visible+.Checkbox-module--checkbox--2mZlv:before,.Checkbox-module--input--3BKOi:hover+.Checkbox-module--checkbox--2mZlv:before{border-color:var(--color-primary)}.Checkbox-module--input--3BKOi:checked+.Checkbox-module--checkbox--2mZlv:before{background-color:var(--color-primary);background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='13' height='10' fill='none' viewBox='0 0 13 10'%3E%3Cpath fill='%23fff' d='M12.99 2 11.58.58 4.99 7.17 2.41 4.6.99 6.01l4 3.99 8-8z'/%3E%3C/svg%3E");background-position-y:50%;background-repeat:no-repeat;border-color:var(--color-primary)}.Button-module--button--2t432{align-items:center;display:flex;justify-content:center;padding:12px 24px}.Button-module--button--2t432:focus,.Button-module--button--2t432:hover{box-shadow:0 12px 24px rgba(0,0,0,.06),0 8px 32px rgba(0,0,0,.06),0 4px 48px rgba(0,0,0,.06);outline:none}.Button-module--expanded--1tS7m{max-width:400px;width:100%}.Button-module--primary--1Znlo{background-color:var(--color-background-primary);color:var(--color-primary)}.Button-module--primary--1Znlo:hover{background-color:var(--color-background-primary-hover)}.Button-module--primary--1Znlo:focus-visible{background-color:var(--color-background-primary-pressed)}.Button-module--secondary--2lup3{background-color:var(--color-secondary)}.Button-module--secondary--2lup3:hover{background-color:var(--color-secondary-hover)}.Button-module--secondary--2lup3:focus-visible{background-color:var(--color-secondary-pressed)}.Button-module--icon--ahMay{color:var(--color-primary);height:24px;margin-right:16px;width:24px}.Filters-module--title--2w9oT{margin-bottom:40px}@media screen and (max-width:768px){.Filters-module--title--2w9oT{font-size:28px;font-weight:800;line-height:32px}}.Filters-module--group--39W7Y{margin-bottom:40px}.Filters-module--groupTitle--7YFdO{margin-bottom:16px}.Filters-module--filter--FPzWd{margin-bottom:8px}.Radio-module--label--3mVdI{margin-left:8px;word-break:break-word}.Radio-module--radio--1Zv1U{align-items:center;cursor:pointer;display:flex}.Radio-module--control--1gBRR{align-items:center;border-radius:50%;color:var(--color-text-primary);display:flex;height:32px;justify-content:center;width:32px}.Radio-module--control--1gBRR:before{border-radius:50%;content:"";display:inline-block;height:10px;position:absolute;width:10px}.Radio-module--control--1gBRR:after{border:2px solid;border-radius:50%;content:"";display:inline-block;height:20px;position:absolute;width:20px}.Radio-module--input--1y39W:checked+.Radio-module--control--1gBRR,.Radio-module--input--1y39W:hover+.Radio-module--control--1gBRR{color:var(--color-primary-hover)}.Radio-module--input--1y39W:focus-visible+.Radio-module--control--1gBRR,.Radio-module--input--1y39W:hover+.Radio-module--control--1gBRR{background-color:var(--color-background-primary);color:var(--color-primary-hover)}.Chips-module--chips--2PD3E,.Radio-module--input--1y39W:checked+.Radio-module--control--1gBRR:before{background-color:var(--color-primary)}.Chips-module--chips--2PD3E{align-items:center;border-radius:20px;color:var(--color-background);display:flex;padding:4px 16px}.Chips-module--content--1fRc1{margin-right:8px;word-break:break-word}.Chips-module--action--18xz2{color:inherit}.Chips-module--action--18xz2:hover{color:var(--color-secondary-hover)}.Chips-module--action--18xz2:focus-visible{color:var(--color-secondary-pressed)}.Chips-module--actionIcon--3Mnic{color:inherit;height:24px;width:24px}.Search-module--title--2Sv1D{word-wrap:break-word;font-size:34px;font-weight:900;line-height:40px;margin-bottom:48px}@media screen and (max-width:768px){.Search-module--title--2Sv1D{font-size:28px;font-weight:800;line-height:32px;margin-bottom:24px}}.Search-module--mark--1mwSB{background-color:var(--color-secondary);display:inline-block;line-height:0em;padding-bottom:.5em}.Search-module--chipsContainer--Q20QU{display:flex;flex-wrap:wrap;margin-bottom:24px;margin-top:-8px}.Search-module--chips--kTcRd{margin-top:8px}.Search-module--chips--kTcRd:not(:last-child){margin-right:8px}.Search-module--main--2W9_R{grid-column:span 2}@media screen and (max-width:768px){.Search-module--filters--3UUwN{background-color:var(--color-background);display:block;left:0;max-height:100vh;max-height:-webkit-fill-available;overflow-y:auto;padding:40px 16px;position:fixed;top:0;width:100vw;z-index:1000}}.Search-module--close--2JH3A{position:absolute;right:24px;top:40px}.Search-module--close--2JH3A:hover{color:var(--color-secondary-hover)}.Search-module--close--2JH3A:focus-visible{color:var(--color-secondary-pressed)}.Search-module--close--2JH3A:focus{outline:none}.Search-module--closeIcon--1pWvM{height:24px;width:24px}.Search-module--showFilters--1l0jQ{margin-bottom:24px}</style><meta name="generator" content="Gatsby 3.14.6"/><title data-react-helmet="true">Signing | DIDComm</title><link data-react-helmet="true" rel="preconnect" href="https://fonts.googleapis.com"/><link data-react-helmet="true" rel="preconnect" href="https://fonts.gstatic.com" crossorigin=""/><link data-react-helmet="true" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&amp;display=swap" rel="stylesheet"/><meta data-react-helmet="true" name="description" content="DIDComm lets people and software use DIDs to communicate securely and privately over many channels: the web, email, mobile push notifications, QR codes, Bluetooth, message queues, sneakernet, and more."/><meta data-react-helmet="true" property="og:title" content="Signing"/><meta data-react-helmet="true" property="og:description" content="DIDComm lets people and software use DIDs to communicate securely and privately over many channels: the web, email, mobile push notifications, QR codes, Bluetooth, message queues, sneakernet, and more."/><meta data-react-helmet="true" property="og:type" content="website"/><script>
    document.addEventListener("DOMContentLoaded", function(event) {
      var hash = window.decodeURI(location.hash.replace('#', ''))
      if (hash !== '') {
        var element = document.getElementById(hash)
        if (element) {
          var scrollTop = window.pageYOffset || document.documentElement.scrollTop || document.body.scrollTop
          var clientTop = document.documentElement.clientTop || document.body.clientTop || 0
          var offset = element.getBoundingClientRect().top + scrollTop - clientTop
          // Wait for the browser to finish rendering before scrolling.
          setTimeout((function() {
            window.scrollTo(0, offset - 0)
          }), 0)
        }
      }
    })
  </script><link rel="icon" href="/favicon-32x32.png?v=b85920628d9d315a1905d4e53f7a73b6" type="image/png"/><link rel="icon" href="/favicon.svg?v=b85920628d9d315a1905d4e53f7a73b6" type="image/svg+xml"/><link rel="manifest" href="/manifest.webmanifest" crossorigin="anonymous"/><meta name="theme-color" content="#FFF"/><link rel="apple-touch-icon" sizes="48x48" href="/icons/icon-48x48.png?v=b85920628d9d315a1905d4e53f7a73b6"/><link rel="apple-touch-icon" sizes="72x72" href="/icons/icon-72x72.png?v=b85920628d9d315a1905d4e53f7a73b6"/><link rel="apple-touch-icon" sizes="96x96" href="/icons/icon-96x96.png?v=b85920628d9d315a1905d4e53f7a73b6"/><link rel="apple-touch-icon" sizes="144x144" href="/icons/icon-144x144.png?v=b85920628d9d315a1905d4e53f7a73b6"/><link rel="apple-touch-icon" sizes="192x192" href="/icons/icon-192x192.png?v=b85920628d9d315a1905d4e53f7a73b6"/><link rel="apple-touch-icon" sizes="256x256" href="/icons/icon-256x256.png?v=b85920628d9d315a1905d4e53f7a73b6"/><link rel="apple-touch-icon" sizes="384x384" href="/icons/icon-384x384.png?v=b85920628d9d315a1905d4e53f7a73b6"/><link rel="apple-touch-icon" sizes="512x512" href="/icons/icon-512x512.png?v=b85920628d9d315a1905d4e53f7a73b6"/><link as="script" rel="preload" href="/webpack-runtime-7b527356047a9787095f.js"/><link as="script" rel="preload" href="/framework-0993f47ffebd3bbb5409.js"/><link as="script" rel="preload" href="/app-2258e9ff8c9279fe5507.js"/><link as="script" rel="preload" href="/commons-ceb25d5ebe4b77987b3b.js"/><link as="script" rel="preload" href="/component---src-templates-protocol-protocol-tsx-3391b2f00d0a4ae5a5c3.js"/><link as="fetch" rel="preload" href="/page-data/signing/1.0/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/3000541721.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/3766577012.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/app-data.json" crossorigin="anonymous"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><div class="Layout-module--layout--36KWw"><header class="Header-module--header--1Qt4T hide-print"><div class="Header-module--container--3KhaC"><a title="Link to home" class="Header-module--logo--RPmCm" aria-label="Link to home" href="/"><svg class="Header-module--logoImg--f8A17"><use href="/static/33a1b05c5807b13800487409ee2ac2cd/icons.svg#logo"></use></svg><span class="Header-module--logoText--EwM4- hide-mobile">DIDComm</span></a><div class="Header-module--search--ucYp8"><form class="Search-module--search--3XfRF" role="search"><input type="text" class="Search-module--input--1o6QO rounded Search-module--bordered--34QxG" value="" autoCorrect="off" placeholder=" " autoComplete="off" id="search"/><label class="Search-module--placeholder--97f4S" for="search">Search protocols<span class="Search-module--placeholderExtraText--3R9o1"> to use in your own software</span></label><button class="Search-module--clearButton--3MgzD" aria-label="Clear search text" type="button"><svg class="Search-module--iconCross--3dnWa"><use href="/static/33a1b05c5807b13800487409ee2ac2cd/icons.svg#cross"></use></svg></button><button class="Search-module--button--xD1TT" type="submit" aria-label="Search for protocols"><svg class="Search-module--iconMagnify--j1Q9O"><use href="/static/33a1b05c5807b13800487409ee2ac2cd/icons.svg#magnify"></use></svg></button></form></div><nav class="hide-mobile font-footnote Header-module--linksContainer--WRDuP"><ul class="Header-module--links--3cZB-"><li><a class="Header-module--link--4ebYS" rel="noreferrer noopener nofollow" href="https://github.com/decentralized-identity/didcomm.org" target="_blank">GitHub repo</a></li><li><a class="Header-module--link--4ebYS" rel="noreferrer noopener nofollow" href="https://identity.foundation/didcomm-messaging/spec/v2.1/" target="_blank">Specification</a></li><li><a class="Header-module--link--4ebYS" href="mailto:security@didcomm.org">Security</a></li></ul></nav></div></header><div class="content"><main><h1 class="font-title-1 Protocol-module--title--1yzjp">Signing<!-- --> <span class="font-footnote Protocol-module--version--vKpW5">1.0</span></h1><div class="grid-3"><article class="Protocol-module--body--3yTdm"><h2>Summary</h2><p>A modular, transport-agnostic protocol for requesting, producing, coordinating, and verifying digital signatures over arbitrary payloads (documents, transactions, packages, attestations) with single-signer and multi-party modes, plus replay-proof sealed secret delivery using HPKE envelopes and authorization tokens.</p><div><h2 id="Summary">Summary</h2>
<p>The <strong>Signing Protocol</strong> provides a unified DIDComm-based approach to digital signature orchestration across heterogeneous media types including PDF documents, blockchain transactions, software packages, and cryptographic attestations. It supports single-signer workflows, threshold signatures (N-of-M), cryptographic aggregation (MuSig2, FROST, BLS), and contract-based multisig (e.g., Gnosis Safe, ERC-1271).</p>
<p>Beyond traditional signatures, the protocol includes <strong>sealed secret delivery</strong> using HPKE envelopes with replay-proof authorization tokens, enabling secure use cases like database password unlock, API key rotation, and ephemeral credential delivery with device binding and monotonic counter protection.</p>
<h3 id="Goals">Goals</h3>
<ul>
<li><strong>Unified</strong>: One protocol to drive signing across heterogeneous media (PDF, CMS, JWT, EVM, PSBT, OCI, etc.) and sealed secret delivery</li>
<li><strong>Modular</strong>: Pluggable canonicalizers, signature suites, aggregators, envelopes, and policies</li>
<li><strong>Multisig</strong>: Support signature collection (N independent sigs), cryptographic aggregation (e.g., MuSig2/FROST/BLS), and contract/account-based multisig (e.g., Gnosis Safe, ERC-1271)</li>
<li><strong>Auditable</strong>: Strong consent mechanisms, digest pinning (WYSIWYS - What You See Is What You Sign), idempotency, receipts, and authorization tokens</li>
<li><strong>Replay-Proof</strong>: Monotonic counter-based replay protection for authorization tokens and sealed secrets</li>
<li><strong>Transport-agnostic</strong>: Works seamlessly over DIDComm v2 message routing and pickup</li>
</ul>
<h3 id="Non-Goals">Non-Goals</h3>
<p>This protocol does not define the cryptographic primitives themselves (e.g., ECDSA, EdDSA algorithms), nor does it replace existing signature standards. Instead, it orchestrates signature workflows using those standards as pluggable modules.</p>
<h2 id="Motivation">Motivation</h2>
<p>Digital signature workflows today are fragmented across domains:</p>
<ul>
<li><strong>Documents</strong>: Adobe PDF signatures, CAdES/PAdES standards</li>
<li><strong>Blockchain</strong>: Ethereum transaction signing, Bitcoin PSBT coordination, Safe multisig</li>
<li><strong>Supply Chain</strong>: Sigstore/cosign for container images</li>
<li><strong>Identity</strong>: Verifiable Credentials and DID authentication</li>
</ul>
<p>Each domain uses proprietary APIs and coordination mechanisms. This protocol provides a <strong>universal coordination layer</strong> that:</p>
<ol>
<li><strong>Abstracts signature mechanics</strong> behind pluggable modules (canonicalizers, suites, aggregators)</li>
<li><strong>Provides multisig orchestration</strong> for threshold and aggregated signatures</li>
<li><strong>Enforces security invariants</strong> like digest pinning and consent flows</li>
<li><strong>Enables auditability</strong> through receipts and idempotency</li>
<li><strong>Works offline-first</strong> via DIDComm message routing and pickup</li>
</ol>
<h2 id="Roles">Roles</h2>
<ul>
<li><strong><code>requester</code></strong>: Party initiating a signing request. May be a document management system, blockchain application, or any service requiring signatures.</li>
<li><strong><code>signer</code></strong>: Party controlling a private key or smart account. The signer provides consent and produces signatures.</li>
<li><strong><code>coordinator</code></strong>: Orchestrates multi-signer sessions, collecting partial signatures and triggering aggregation. May be the same party as the requester or a separate orchestration service.</li>
<li><strong><code>observer</code></strong>: Read-only recipient for audit trails or UX mirroring. Observers receive session updates but do not participate in signing.</li>
</ul>
<h3 id="Role-Cardinality">Role Cardinality</h3>
<ul>
<li>A session MUST have exactly one <code>requester</code></li>
<li>A session MUST have at least one <code>signer</code></li>
<li>For multisig sessions (<code>mode.type</code> = <code>threshold</code>), there MUST be a <code>coordinator</code> (may be same as requester)</li>
<li>A session MAY have zero or more <code>observer</code> roles</li>
</ul>
<h2 id="Terminology">Terminology</h2>
<ul>
<li><strong>Canonicalizer</strong>: Module that converts an input to canonical bytes and provides a digest method</li>
<li><strong>Signature Suite</strong>: Module that produces/verifies signatures for a class of payloads/keys</li>
<li><strong>Aggregator</strong>: Module that combines partial signatures and/or executes on-chain submissions to produce a final artifact</li>
<li><strong>Envelope</strong>: Module that seals secrets using KEM+KDF+AEAD (e.g., HPKE) with cryptographic binding to authorization tokens</li>
<li><strong>Policy</strong>: Module that enforces business/authorization constraints</li>
<li><strong>Session</strong>: A scoped interaction for signing a specific object (or set of objects)</li>
<li><strong>WYSIWYS</strong>: "What You See Is What You Sign" - the principle that signers must view content derived from the same canonical bytes they are signing</li>
<li><strong>Authorization Token</strong>: Server-signed ticket with replay protection (monotonic counter), device binding, and expiration</li>
<li><strong>Device Binding</strong>: Cryptographic binding of tokens/envelopes to a specific device key or DID</li>
</ul>
<p>Normative keywords (MUST, SHOULD, MAY) are to be interpreted as in RFC 2119.</p>
<h2 id="States">States</h2>
<h3 id="Single-Signer-State-Machine">Single-Signer State Machine</h3>
<pre><code>[idle] → propose-signing (optional) → request-signing → consent (optional) →
partial-signature → provide-artifacts → ack → [completed]
                                    ↓
                                 decline/problem-report → [failed]
</code></pre>
<p><strong>States:</strong></p>
<ul>
<li><code>idle</code>: No active signing session</li>
<li><code>proposed</code>: Capabilities exchanged, session parameters negotiated</li>
<li><code>requested</code>: Signing request received by signer</li>
<li><code>consented</code>: Signer has approved and provided key binding proof</li>
<li><code>signed</code>: Signature produced</li>
<li><code>artifacts-provided</code>: Final signed artifacts delivered</li>
<li><code>completed</code>: Session acknowledged and finalized</li>
<li><code>failed</code>: Session declined or encountered errors</li>
</ul>
<p><strong>Events (Messages):</strong></p>
<ul>
<li><code>propose-signing</code>: Capability discovery and negotiation</li>
<li><code>request-signing</code>: Initiate signing with object descriptor, suite, and constraints</li>
<li><code>consent</code>: Human approval with key binding proof</li>
<li><code>partial-signature</code>: Submit signature (or signature fragment)</li>
<li><code>provide-artifacts</code>: Deliver final signed artifacts</li>
<li><code>ack</code>: Receipt acknowledgment</li>
<li><code>decline</code>: Reject signing request</li>
<li><code>problem-report</code>: Error reporting</li>
</ul>
<h3 id="Threshold-State-Machine-N-of-M-Collection">Threshold State Machine (N-of-M Collection)</h3>
<pre><code>[idle] → propose-signing (optional) → request-signing →
[consent x M (optional)] → [partial-signature x M] →
combine (threshold_met) → provide-artifacts → ack → [completed]
</code></pre>
<p><strong>Additional States:</strong></p>
<ul>
<li><code>collecting</code>: Gathering partial signatures from M signers</li>
<li><code>threshold-met</code>: N of M required signatures collected</li>
<li><code>aggregating</code>: Coordinator combining signatures</li>
</ul>
<p><strong>Additional Events:</strong></p>
<ul>
<li><code>combine</code>: Announce aggregation status or trigger on-chain submission</li>
</ul>
<h3 id="Cryptographic-Aggregation-FROSTMuSig2">Cryptographic Aggregation (FROST/MuSig2)</h3>
<p>Similar to threshold state, but with <strong>multi-round</strong> partial-signature messages carrying commitments, nonces, and signature shares across multiple rounds until combine can aggregate to a single signature.</p>
<p><strong>Rounds:</strong></p>
<ul>
<li>Round 1: Commitment/nonce exchange</li>
<li>Round 2+: Signature share computation</li>
<li>Final: Aggregation to single signature</li>
</ul>
<h3 id="ContractAccount-based-Multisig-eg-Safe">Contract/Account-based Multisig (e.g., Safe)</h3>
<pre><code>request-signing (includes tx descriptor/hash) →
[confirmations as partial-signature x N] →
combine (submit/execution) → provide-artifacts (txid/receipt) → ack
</code></pre>
<p><strong>Smart Contract States:</strong></p>
<ul>
<li><code>pending</code>: Transaction proposed but not confirmed</li>
<li><code>confirmed</code>: Sufficient confirmations collected</li>
<li><code>executed</code>: Transaction submitted to blockchain</li>
<li><code>finalized</code>: Transaction included in block</li>
</ul>
<h2 id="Data-Model">Data Model</h2>
<h3 id="Signable-Object-Descriptor">Signable Object Descriptor</h3>
<p>A <code>SignableObject</code> describes what is being signed:</p>
<pre><code class="language-json">{
  "id": "so_7c9b...",
  "media_type": "application/pdf",
  "canonicalization": {
    "method": "pdf-incremental-update@1",
    "parameters": {
      "byte_range": [0, 123, 456, 789]
    }
  },
  "digest": {
    "alg": "sha-256",
    "value": "mVxT...=="
  },
  "display_hints": {
    "title": "NDA v3.1",
    "preview_links": ["https://.../nda.pdf"],
    "summary": "Non-Disclosure Agreement"
  }
}
</code></pre>
<p><strong>Required Fields:</strong></p>
<ul>
<li><code>id</code>: Unique identifier for this signable object</li>
<li><code>media_type</code>: MIME type of the payload</li>
<li><code>canonicalization</code>: Method and parameters for canonical byte representation</li>
<li><code>digest</code>: Cryptographic digest over canonical bytes</li>
</ul>
<p><strong>Optional Fields:</strong></p>
<ul>
<li><code>display_hints</code>: Human-readable metadata for consent UX</li>
</ul>
<p><strong>Invariants:</strong></p>
<ul>
<li><code>digest</code> MUST be computed over canonical bytes as specified by <code>canonicalization</code></li>
<li>Signers MUST verify digest matches their local canonicalization before signing</li>
</ul>
<h3 id="Session">Session</h3>
<p>A <code>Session</code> describes the coordination mode and participants:</p>
<pre><code class="language-json">{
  "session_id": "sess_b5f1...",
  "mode": {
    "type": "single"
  }
}
</code></pre>
<p>For threshold/multisig:</p>
<pre><code class="language-json">{
  "session_id": "sess_b5f1...",
  "mode": {
    "type": "threshold"
  },
  "threshold": {
    "scheme": "n-of-m",
    "n": 2,
    "m": 3,
    "signers": ["did:ex:s1", "did:ex:s2", "did:ex:s3"],
    "aggregation": "none"
  }
}
</code></pre>
<p><strong>Mode Types:</strong></p>
<ul>
<li><code>single</code>: One signer produces one signature</li>
<li><code>threshold</code>: N-of-M signature collection or aggregation</li>
</ul>
<p><strong>Threshold Schemes:</strong></p>
<ul>
<li><code>n-of-m</code>: Collect N signatures from M designated signers</li>
<li><code>cryptographic</code>: MuSig2, FROST, BLS aggregation</li>
<li><code>contract</code>: On-chain multisig (Safe, multi-owner accounts)</li>
</ul>
<h3 id="Suite--Constraints">Suite &amp; Constraints</h3>
<p>The <code>Suite</code> specifies the signature algorithm and constraints:</p>
<pre><code class="language-json">{
  "suite": "evm-eip712@1",
  "key_binding": {
    "controller": "eip155:1:0xAbC...",
    "proof_purpose": "assertionMethod"
  },
  "constraints": {
    "not_before": "2025-09-20T16:00:00Z",
    "expires_time": "2025-10-20T16:00:00Z",
    "intended_audience": ["did:example:acme"],
    "use_limit": 1,
    "policy_uri": "https://.../policies/pci"
  }
}
</code></pre>
<p><strong>Required Fields:</strong></p>
<ul>
<li><code>suite</code>: Signature suite identifier from registry (§7.2)</li>
<li><code>key_binding.controller</code>: DID or blockchain address of signing key</li>
</ul>
<p><strong>Optional Constraints:</strong></p>
<ul>
<li><code>not_before</code>: Signature not valid before this time</li>
<li><code>expires_time</code>: Signature expires after this time</li>
<li><code>intended_audience</code>: DIDs for which signature is intended</li>
<li><code>use_limit</code>: Maximum number of times signature can be used</li>
<li><code>policy_uri</code>: Reference to external policy document</li>
</ul>
<h3 id="Idempotency--Receipts">Idempotency &amp; Receipts</h3>
<ul>
<li><code>idempotency_key</code> SHOULD be present in <code>request-signing</code> to prevent duplicate processing</li>
<li><code>ack</code> SHOULD be a compact JWS over <code>{received, session_id, receipt_jti, step_hash}</code> for non-repudiation</li>
</ul>
<h3 id="Authorization-Token">Authorization Token</h3>
<p>An <code>Authorization Token</code> is a server-signed ticket providing replay-proof authorization for sealed secrets, signing operations, or other constrained actions. It includes device binding and monotonic counter semantics.</p>
<pre><code class="language-json">{
  "token": {
    "typ": "signing-ticket",
    "session_id": "sess_b5f1...",
    "scope": "unlock",
    "device": "did:example:device123",
    "ctr": 42,
    "exp": "2025-10-19T16:00:00Z",
    "aud": ["did:example:agentA"],
    "policy_hash": "sha-256:GW...",
    "nonce": "b64...",
    "cap": 1
  },
  "sig": {
    "suite": "jws-ed25519@1",
    "kid": "did:ex:coordinator#k1",
    "value": "eyJ...sig..."
  }
}
</code></pre>
<p><strong>Required Fields:</strong></p>
<ul>
<li><code>typ</code>: Token type (e.g., <code>signing-ticket</code>)</li>
<li><code>session_id</code>: Session identifier</li>
<li><code>scope</code>: Authorization scope (<code>unlock</code>, <code>sign</code>, <code>submit</code>)</li>
<li><code>device</code>: Device DID or key identifier</li>
<li><code>ctr</code>: Monotonic counter (per device)</li>
<li><code>exp</code>: Expiration timestamp (ISO 8601)</li>
<li><code>cap</code>: Capability/use limit (default 1)</li>
</ul>
<p><strong>Optional Fields:</strong></p>
<ul>
<li><code>aud</code>: Intended audience DIDs</li>
<li><code>policy_hash</code>: Cryptographic commitment to applied policy</li>
<li><code>nonce</code>: Client-provided or server-generated nonce</li>
</ul>
<p><strong>Signature:</strong></p>
<ul>
<li><code>sig.suite</code>: Signature suite identifier</li>
<li><code>sig.kid</code>: Key identifier (DID URL)</li>
<li><code>sig.value</code>: Signature over canonical serialization of <code>token</code></li>
</ul>
<p><strong>Normative Rules:</strong></p>
<ul>
<li>The tuple <code>(device, ctr)</code> MUST be strictly monotonically increasing on both server and client</li>
<li><code>exp</code> MUST be enforced by both parties; expired tokens MUST be rejected</li>
<li><code>token</code> MUST be integrity-protected by <code>sig</code> (JWS or equivalent)</li>
<li>Clients MUST persist <code>last_seen_ctr(device)</code> before consuming the token</li>
<li>Tokens with <code>ctr ≤ last_seen_ctr</code> MUST be rejected (replay protection)</li>
</ul>
<h2 id="Message-Reference">Message Reference</h2>
<p>All messages are DIDComm v2 JWM (JSON Web Messages) envelopes. Threading uses <code>thid</code> (thread ID) and <code>pthid</code> (parent thread ID). Large payloads use DIDComm attachments with <code>data.links</code> + <code>hash</code> for integrity verification.</p>
<h3 id="propose-signing">propose-signing</h3>
<p><strong>Purpose:</strong> Capability discovery and negotiation before initiating a signing session.</p>
<p><strong>Sender:</strong> <code>requester</code>
<strong>Receiver:</strong> <code>signer</code> or <code>coordinator</code></p>
<p><strong>Message Type URI:</strong></p>
<pre><code>https://didcomm.org/signing/1.0/propose-signing
</code></pre>
<p><strong>Body:</strong></p>
<pre><code class="language-json">{
  "session": {
    "session_id": "sess_...",
    "mode": {
      "type": "threshold"
    },
    "threshold": {
      "scheme": "n-of-m",
      "n": 2,
      "m": 3
    }
  },
  "capabilities": {
    "supported_suites": ["evm-eip712@1", "pades-b-lta@1", "psbt@2"],
    "max_attachment_size": 10485760
  }
}
</code></pre>
<p><strong>Validation:</strong></p>
<ul>
<li><code>session.session_id</code> MUST be unique and high-entropy</li>
<li><code>capabilities.supported_suites</code> SHOULD list suite identifiers from registry (§7.2)</li>
</ul>
<h3 id="request-signing">request-signing</h3>
<p><strong>Purpose:</strong> Initiate signing of an object with specified suite and constraints.</p>
<p><strong>Sender:</strong> <code>requester</code>
<strong>Receiver:</strong> <code>signer</code></p>
<p><strong>Message Type URI:</strong></p>
<pre><code>https://didcomm.org/signing/1.0/request-signing
</code></pre>
<p><strong>Body:</strong></p>
<pre><code class="language-json">{
  "session": {
    "session_id": "sess_...",
    "mode": {"type": "single"}
  },
  "object": {
    "id": "so_...",
    "media_type": "application/pdf",
    "canonicalization": {"method": "pdf-incremental-update@1", "parameters": {...}},
    "digest": {"alg": "sha-256", "value": "..."}
  },
  "suite": {
    "suite": "pades-b-lta@1",
    "key_binding": {"controller": "did:ex:signer#key1"}
  },
  "idempotency_key": "txn_9f27...",
  "ui": {
    "must_display_summary": true
  }
}
</code></pre>
<p><strong>Attachments:</strong></p>
<ul>
<li>MAY carry full payloads (e.g., EIP-712 typed data, PSBT, PDF bytes) via <code>data.json</code> or <code>data.links</code> + <code>hash</code></li>
</ul>
<p><strong>Validation:</strong></p>
<ul>
<li><code>session</code>, <code>object</code>, <code>suite</code> are REQUIRED</li>
<li><code>object.digest</code> MUST match canonicalized bytes</li>
<li><code>idempotency_key</code> SHOULD be unique per request</li>
</ul>
<h3 id="consent">consent</h3>
<p><strong>Purpose:</strong> Human approval and key binding proof before signing.</p>
<p><strong>Sender:</strong> <code>signer</code>
<strong>Receiver:</strong> <code>requester</code> or <code>coordinator</code></p>
<p><strong>Message Type URI:</strong></p>
<pre><code>https://didcomm.org/signing/1.0/consent
</code></pre>
<p><strong>Body:</strong></p>
<pre><code class="language-json">{
  "session_id": "sess_...",
  "object_id": "so_...",
  "key_binding_proof": {
    "type": "jws",
    "kid": "did:ex:signer#k1",
    "payload": "eyJpbnRlbnQiOiJzaWduIn0",
    "signature": "..."
  }
}
</code></pre>
<p><strong>Validation:</strong></p>
<ul>
<li><code>key_binding_proof</code> MUST be verifiable with <code>suite.key_binding.controller</code></li>
<li>Payload SHOULD contain intent statement (e.g., "I consent to sign object so_...")</li>
</ul>
<h3 id="partial-signature">partial-signature</h3>
<p><strong>Purpose:</strong> Submit a signature fragment, confirmation, or round data.</p>
<p><strong>Sender:</strong> <code>signer</code>
<strong>Receiver:</strong> <code>requester</code> or <code>coordinator</code></p>
<p><strong>Message Type URI:</strong></p>
<pre><code>https://didcomm.org/signing/1.0/partial-signature
</code></pre>
<p><strong>Body (Single-round):</strong></p>
<pre><code class="language-json">{
  "session_id": "sess_...",
  "object_id": "so_...",
  "signer": "did:ex:s2",
  "suite": "evm-eip712@1",
  "signature": {
    "format": "eip-712",
    "value": "0x...",
    "public_key_hint": "eip155:1:0xABC..."
  }
}
</code></pre>
<p><strong>Body (Multi-round, e.g., MuSig2/FROST):</strong></p>
<pre><code class="language-json">{
  "session_id": "sess_...",
  "object_id": "so_...",
  "signer": "did:ex:s2",
  "suite": "schnorr-musig2@1",
  "round": 1,
  "data": {
    "nonceCommitment": "..."
  }
}
</code></pre>
<p><strong>Validation:</strong></p>
<ul>
<li>For single-round: <code>signature</code> MUST be present and verifiable</li>
<li>For multi-round: <code>round</code> and <code>data</code> specify current round state</li>
<li><code>signer</code> MUST be in <code>session.threshold.signers</code> (if applicable)</li>
</ul>
<h3 id="combine">combine</h3>
<p><strong>Purpose:</strong> Announce aggregation status, threshold satisfaction, or on-chain submission.</p>
<p><strong>Sender:</strong> <code>coordinator</code>
<strong>Receiver:</strong> <code>requester</code>, <code>signer</code>(s), <code>observer</code>(s)</p>
<p><strong>Message Type URI:</strong></p>
<pre><code>https://didcomm.org/signing/1.0/combine
</code></pre>
<p><strong>Body:</strong></p>
<pre><code class="language-json">{
  "session_id": "sess_...",
  "status": "threshold_met",
  "aggregation_result": {
    "type": "none",
    "artifact_link": "https://...",
    "digest": "sha-256:..."
  }
}
</code></pre>
<p>For on-chain execution:</p>
<pre><code class="language-json">{
  "session_id": "sess_...",
  "status": "executed",
  "aggregation_result": {
    "type": "contract",
    "txid": "0x...",
    "chain_id": "eip155:1"
  }
}
</code></pre>
<p><strong>Aggregation Types:</strong></p>
<ul>
<li><code>none</code>: Simple collection (bundle of N signatures)</li>
<li><code>math</code>: Cryptographic aggregation (MuSig2/FROST/BLS)</li>
<li><code>contract</code>: Smart contract multisig execution</li>
</ul>
<h3 id="provide-artifacts">provide-artifacts</h3>
<p><strong>Purpose:</strong> Deliver final signed artifacts (signed PDF, CMS, transaction receipts, finalized PSBT, OCI signatures) or sealed secrets with authorization tokens.</p>
<p><strong>Sender:</strong> <code>coordinator</code> or <code>signer</code> (single-signer mode)
<strong>Receiver:</strong> <code>requester</code></p>
<p><strong>Message Type URI:</strong></p>
<pre><code>https://didcomm.org/signing/1.0/provide-artifacts
</code></pre>
<p><strong>Body (Standard Artifacts):</strong></p>
<pre><code class="language-json">{
  "session_id": "sess_...",
  "artifacts": [
    {
      "type": "pades-b-lta",
      "digest": "sha-256:mVxT...",
      "links": ["https://.../nda-signed.pdf"]
    }
  ]
}
</code></pre>
<p><strong>Body (Sealed Secret with Authorization Token):</strong></p>
<pre><code class="language-json">{
  "session_id": "sess_...",
  "artifacts": [
    {
      "type": "sealed-secret@1",
      "suite": "envelope-hpke@1",
      "aad": {
        "ticket_digest": "sha-256:..."
      },
      "ciphertext": "b64...",
      "enc": {
        "kem": "X25519",
        "kdf": "HKDF-SHA256",
        "aead": "AES-256-GCM",
        "ek_pub": "b64..."
      }
    }
  ],
  "token": {
    "token": {
      "typ": "signing-ticket",
      "session_id": "sess_...",
      "scope": "unlock",
      "device": "did:example:device123",
      "ctr": 42,
      "exp": "2025-10-19T16:00:00Z",
      "cap": 1
    },
    "sig": {
      "suite": "jws-ed25519@1",
      "kid": "did:ex:coordinator#k1",
      "value": "eyJ...sig..."
    }
  }
}
</code></pre>
<p><strong>Sealed Secret Fields:</strong></p>
<ul>
<li><code>type</code>: MUST be <code>sealed-secret@1</code> for envelope artifacts</li>
<li><code>suite</code>: Envelope suite identifier (e.g., <code>envelope-hpke@1</code>)</li>
<li><code>aad</code>: Additional authenticated data MUST include <code>ticket_digest</code></li>
<li><code>ciphertext</code>: Base64-encoded encrypted payload</li>
<li><code>enc</code>: Encryption metadata (KEM, KDF, AEAD, ephemeral public key)</li>
</ul>
<p><strong>Token Field:</strong></p>
<ul>
<li><code>token</code>: Authorization token structure (see Data Model §Authorization Token)</li>
<li>MUST be present when <code>type</code> is <code>sealed-secret@1</code></li>
</ul>
<p><strong>Attachments:</strong></p>
<ul>
<li>Artifacts MAY be attached directly or referenced via <code>links</code></li>
</ul>
<p><strong>Validation:</strong></p>
<ul>
<li>Each artifact MUST include <code>type</code>, <code>digest</code>, and <code>links</code> or inline data</li>
<li><code>digest</code> SHOULD be verified by requester</li>
<li>For <code>sealed-secret@1</code>: <code>aad.ticket_digest</code> MUST match <code>sha-256(serialize(token.token))</code></li>
<li>Receiver MUST verify <code>token.sig</code> before attempting decryption</li>
<li>Receiver MUST enforce counter monotonicity (<code>ctr &gt; last_seen_ctr</code>)</li>
</ul>
<h3 id="issue-token">issue-token</h3>
<p><strong>Purpose:</strong> Issue an authorization token with sealed secret (optional message type; can use <code>provide-artifacts</code> instead).</p>
<p><strong>Sender:</strong> <code>coordinator</code>
<strong>Receiver:</strong> <code>signer</code> or <code>requester</code></p>
<p><strong>Message Type URI:</strong></p>
<pre><code>https://didcomm.org/signing/1.0/issue-token
</code></pre>
<p><strong>Body:</strong>
Same structure as <code>provide-artifacts</code> with sealed secret. This message type exists to semantically separate authorization token issuance from artifact delivery in workflows where that distinction is important.</p>
<p><strong>Usage Note:</strong></p>
<ul>
<li>Use <code>issue-token</code> when the primary purpose is delivering authorization credentials</li>
<li>Use <code>provide-artifacts</code> with <code>type: sealed-secret@1</code> when sealed secrets are one of multiple artifact types</li>
<li>Both are functionally equivalent for sealed secret delivery</li>
</ul>
<h3 id="ack">ack</h3>
<p><strong>Purpose:</strong> Receipt and non-repudiation acknowledgment.</p>
<p><strong>Sender:</strong> <code>requester</code>
<strong>Receiver:</strong> <code>signer</code>, <code>coordinator</code></p>
<p><strong>Message Type URI:</strong></p>
<pre><code>https://didcomm.org/signing/1.0/ack
</code></pre>
<p><strong>Body:</strong></p>
<pre><code class="language-json">{
  "received": "provide-artifacts",
  "session_id": "sess_...",
  "receipt_jti": "rcpt_22a8..."
}
</code></pre>
<p><strong>Receipt:</strong></p>
<ul>
<li>MAY be a compact JWS over <code>{received, session_id, receipt_jti, step_hash}</code></li>
<li>Provides non-repudiation proof of delivery</li>
</ul>
<h3 id="decline">decline</h3>
<p><strong>Purpose:</strong> Reject a signing request.</p>
<p><strong>Sender:</strong> <code>signer</code>
<strong>Receiver:</strong> <code>requester</code></p>
<p><strong>Message Type URI:</strong></p>
<pre><code>https://didcomm.org/signing/1.0/decline
</code></pre>
<p><strong>Body:</strong></p>
<pre><code class="language-json">{
  "session_id": "sess_...",
  "reason": "User declined to sign"
}
</code></pre>
<h3 id="problem-report">problem-report</h3>
<p><strong>Purpose:</strong> Error reporting per DIDComm conventions.</p>
<p><strong>Sender:</strong> Any role
<strong>Receiver:</strong> Any role</p>
<p><strong>Message Type URI:</strong></p>
<pre><code>https://didcomm.org/signing/1.0/problem-report
</code></pre>
<p><strong>Body:</strong></p>
<pre><code class="language-json">{
  "code": "unsupported-suite",
  "explain": "Signer does not support PAdES LTA."
}
</code></pre>
<p><strong>Error Codes:</strong> See Design By Contract section.</p>
<h2 id="Pluggable-Modules">Pluggable Modules</h2>
<p>The protocol defines <strong>registries</strong> for canonicalizers, signature suites, aggregators, and policies. Implementations MUST reject unknown registry keys unless operating in permissive mode.</p>
<h3 id="Canonicalizers">Canonicalizers</h3>
<p>Canonicalizers convert inputs to canonical bytes and compute digests.</p>
<table>
<thead>
<tr>
<th>Registry Key</th>
<th>Description</th>
<th>Parameters</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>raw-bytes@1</code></td>
<td>Identity canonicalization; signs raw bytes</td>
<td>None</td>
</tr>
<tr>
<td><code>pdf-incremental-update@1</code></td>
<td>PAdES byte ranges for incremental updates</td>
<td><code>byte_range</code>: array of integers</td>
</tr>
<tr>
<td><code>cms-detached@1</code></td>
<td>Detached CMS for CAdES</td>
<td>Digest context</td>
</tr>
<tr>
<td><code>eip-712@1</code></td>
<td>EIP-712 typed data canonicalization</td>
<td><code>domain</code>, <code>types</code>, <code>message</code></td>
</tr>
<tr>
<td><code>psbt@2</code></td>
<td>PSBT (BIP-174/370) as base64 bytes</td>
<td>None</td>
</tr>
<tr>
<td><code>oci-manifest@1</code></td>
<td>OCI manifest for Sigstore/cosign</td>
<td>None</td>
</tr>
</tbody>
</table>
<h3 id="Signature-Suites">Signature Suites</h3>
<p>Signature suites produce and verify signatures.</p>
<table>
<thead>
<tr>
<th>Registry Key</th>
<th>Description</th>
<th>Output Format</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>jws-ed25519@1</code></td>
<td>Detached JWS with Ed25519</td>
<td>JWS compact</td>
</tr>
<tr>
<td><code>jws-secp256k1@1</code></td>
<td>Detached JWS with secp256k1</td>
<td>JWS compact</td>
</tr>
<tr>
<td><code>pades-b-b@1</code></td>
<td>PDF Advanced Electronic Signature (basic)</td>
<td>CMS blob</td>
</tr>
<tr>
<td><code>pades-b-lta@1</code></td>
<td>PAdES with Long-Term Archival (timestamp/OCSP)</td>
<td>CMS blob + evidence</td>
</tr>
<tr>
<td><code>cades-bes@1</code></td>
<td>CMS/CAdES Basic Electronic Signature</td>
<td>CMS blob</td>
</tr>
<tr>
<td><code>evm-eth_sign@1</code></td>
<td>EVM eth_sign (deprecated)</td>
<td>65-byte hex</td>
</tr>
<tr>
<td><code>evm-personal_sign@1</code></td>
<td>EVM personal_sign</td>
<td>65-byte hex</td>
</tr>
<tr>
<td><code>evm-eip712@1</code></td>
<td>EVM EIP-712 structured data signing</td>
<td>65-byte hex</td>
</tr>
<tr>
<td><code>evm-safe-tx@1</code></td>
<td>Gnosis Safe transaction confirmation</td>
<td>Confirmation data</td>
</tr>
<tr>
<td><code>erc-1271-check@1</code></td>
<td>ERC-1271 contract signature verification</td>
<td>Boolean verification</td>
</tr>
<tr>
<td><code>psbt@2</code></td>
<td>PSBT input signing</td>
<td>Updated PSBT fragment</td>
</tr>
<tr>
<td><code>schnorr-musig2@1</code></td>
<td>MuSig2 aggregated Schnorr (multi-round)</td>
<td>Aggregated signature</td>
</tr>
<tr>
<td><code>frost-ed25519@1</code></td>
<td>FROST threshold EdDSA (multi-round)</td>
<td>Aggregated signature</td>
</tr>
<tr>
<td><code>bls-aggregate@1</code></td>
<td>BLS signature aggregation</td>
<td>Aggregated signature</td>
</tr>
<tr>
<td><code>sigstore-fulcio@1</code></td>
<td>Fulcio/OIDC key material + Rekor witness</td>
<td>Transparency log entry</td>
</tr>
</tbody>
</table>
<h3 id="Aggregators">Aggregators</h3>
<p>Aggregators combine partial signatures or execute on-chain submissions.</p>
<table>
<thead>
<tr>
<th>Registry Key</th>
<th>Description</th>
<th>Output</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>bundle-none@1</code></td>
<td>Bundle N detached signatures (co-sign)</td>
<td>Array of signatures</td>
</tr>
<tr>
<td><code>pdf-co-sign@1</code></td>
<td>Merge incremental updates into final PAdES PDF</td>
<td>Signed PDF</td>
</tr>
<tr>
<td><code>safe-exec@1</code></td>
<td>Verify Safe confirmations and execute</td>
<td>Transaction ID</td>
</tr>
<tr>
<td><code>psbt-finalize@2</code></td>
<td>Finalize PSBT to hex transaction; optionally broadcast</td>
<td>Transaction hex + txid</td>
</tr>
<tr>
<td><code>math-aggregate@1</code></td>
<td>Combine MuSig2/FROST/BLS partials to one signature</td>
<td>Single signature</td>
</tr>
<tr>
<td><code>oci-multi-sign@1</code></td>
<td>Attach multiple signatures to OCI manifest</td>
<td>OCI signature bundle</td>
</tr>
</tbody>
</table>
<h3 id="Policies">Policies</h3>
<p>Policies enforce business/authorization constraints.</p>
<table>
<thead>
<tr>
<th>Registry Key</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>time-window@1</code></td>
<td>Enforce <code>not_before</code> and <code>expires_time</code></td>
</tr>
<tr>
<td><code>audience@1</code></td>
<td>Enforce <code>intended_audience</code></td>
</tr>
<tr>
<td><code>usage-limit@1</code></td>
<td>Enforce <code>use_limit</code></td>
</tr>
<tr>
<td><code>vp-gate@1</code></td>
<td>Require Verifiable Presentation proving role/entitlement</td>
</tr>
<tr>
<td><code>spend-limit@1</code></td>
<td>EVM field checks: token, amount, chainId</td>
</tr>
</tbody>
</table>
<h3 id="Envelopes">Envelopes</h3>
<p>Envelopes seal secrets using Key Encapsulation Mechanisms (KEM) + Key Derivation Functions (KDF) + Authenticated Encryption with Associated Data (AEAD).</p>
<table>
<thead>
<tr>
<th>Registry Key</th>
<th>Description</th>
<th>Cryptographic Primitives</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>envelope-hpke@1</code></td>
<td>RFC 9180 HPKE Base/Auth mode</td>
<td>KEM: X25519 (MUST), KDF: HKDF-SHA256 (MUST), AEAD: AES-256-GCM or ChaCha20-Poly1305 (MUST support ≥1)</td>
</tr>
<tr>
<td><code>envelope-didcomm-auth@1</code></td>
<td>DIDComm v2 authenticated encryption as envelope</td>
<td>Uses DIDComm JWM authcrypt with AAD binding</td>
</tr>
</tbody>
</table>
<p><strong>envelope-hpke@1 Specification:</strong></p>
<ul>
<li><strong>Modes</strong>: Base mode (MUST), Auth mode (MAY)</li>
<li><strong>Inputs</strong>:
<ul>
<li>Recipient public key (X25519)</li>
<li>Plaintext (secret to seal)</li>
<li>AAD (additional authenticated data)</li>
</ul>
</li>
<li><strong>AAD Requirements (MUST include)</strong>:
<ul>
<li><code>ticket_digest</code>: <code>sha-256(serialize(token))</code></li>
<li><code>session_id</code>: Session identifier</li>
<li><code>device</code>: Device identifier (optional but recommended)</li>
</ul>
</li>
<li><strong>Outputs</strong>:
<ul>
<li><code>ciphertext</code>: Encrypted payload</li>
<li><code>ek_pub</code>: Encapsulated key (ephemeral public key)</li>
</ul>
</li>
<li><strong>Metadata</strong>: Include <code>enc</code> object with <code>{kem, kdf, aead, ek_pub}</code> for interoperability</li>
</ul>
<p><strong>envelope-didcomm-auth@1 Specification:</strong></p>
<ul>
<li>Uses DIDComm v2 authenticated encryption (JWM authcrypt)</li>
<li>AAD MUST include the same fields as <code>envelope-hpke@1</code></li>
<li>Suitable for implementations that already have DIDComm crypto stack</li>
</ul>
<p><strong>Discovery:</strong></p>
<p>Agents advertise supported envelopes in <code>capabilities.supported_envelopes</code> during <code>propose-signing</code>.</p>
<p><strong>Security Requirements:</strong></p>
<ul>
<li>Envelope AAD MUST cryptographically bind to the authorization token digest</li>
<li>Implementations MUST reject envelopes where <code>aad.ticket_digest ≠ sha-256(serialize(token))</code></li>
<li>Recipient MUST verify token signature before attempting decryption</li>
<li>Plaintext secrets MUST be zeroized immediately after use</li>
</ul>
<h2 id="Basic-Walkthrough">Basic Walkthrough</h2>
<h3 id="Scenario-Single-Signer-PDF-Signing">Scenario: Single-Signer PDF Signing</h3>
<p><strong>Participants:</strong></p>
<ul>
<li><strong>Requester:</strong> Document management system (<code>did:ex:dms</code>)</li>
<li><strong>Signer:</strong> Alice (<code>did:ex:alice</code>)</li>
</ul>
<p><strong>Flow:</strong></p>
<ol>
<li><strong>Request</strong></li>
</ol>
<p>Requester sends <code>request-signing</code> to Alice:</p>
<pre><code class="language-json">{
  "type": "https://didcomm.org/signing/1.0/request-signing",
  "id": "msg1",
  "from": "did:ex:dms",
  "to": ["did:ex:alice"],
  "thid": "thread1",
  "body": {
    "session": {
      "session_id": "sess_abc123",
      "mode": {"type": "single"}
    },
    "object": {
      "id": "so_nda_v3",
      "media_type": "application/pdf",
      "canonicalization": {
        "method": "pdf-incremental-update@1",
        "parameters": {"byte_range": [0, 1234, 5678, 9012]}
      },
      "digest": {
        "alg": "sha-256",
        "value": "mVxT3jQ...=="
      },
      "display_hints": {
        "title": "NDA v3.1",
        "preview_links": ["https://dms.example/nda.pdf"]
      }
    },
    "suite": {
      "suite": "pades-b-lta@1",
      "key_binding": {
        "controller": "did:ex:alice#key1"
      }
    },
    "idempotency_key": "txn_nda_001"
  }
}
</code></pre>
<ol start="2">
<li><strong>Consent</strong> (Optional but Recommended)</li>
</ol>
<p>Alice reviews the PDF preview, verifies the digest, and sends <code>consent</code>:</p>
<pre><code class="language-json">{
  "type": "https://didcomm.org/signing/1.0/consent",
  "id": "msg2",
  "from": "did:ex:alice",
  "to": ["did:ex:dms"],
  "thid": "thread1",
  "body": {
    "session_id": "sess_abc123",
    "object_id": "so_nda_v3",
    "key_binding_proof": {
      "type": "jws",
      "kid": "did:ex:alice#key1",
      "payload": "eyJpbnRlbnQiOiJzaWduIiwib2JqZWN0X2lkIjoic29fbmRhX3YzIn0",
      "signature": "..."
    }
  }
}
</code></pre>
<ol start="3">
<li><strong>Sign</strong></li>
</ol>
<p>Alice's agent produces the PAdES-B-LTA signature and sends <code>partial-signature</code>:</p>
<pre><code class="language-json">{
  "type": "https://didcomm.org/signing/1.0/partial-signature",
  "id": "msg3",
  "from": "did:ex:alice",
  "to": ["did:ex:dms"],
  "thid": "thread1",
  "body": {
    "session_id": "sess_abc123",
    "object_id": "so_nda_v3",
    "signer": "did:ex:alice",
    "suite": "pades-b-lta@1",
    "signature": {
      "format": "pades-b-lta",
      "value": "&lt;base64-encoded CMS blob&gt;",
      "timestamp_token": "&lt;RFC3161 timestamp&gt;",
      "ocsp_response": "&lt;OCSP stapling&gt;"
    }
  }
}
</code></pre>
<ol start="4">
<li><strong>Provide Artifacts</strong></li>
</ol>
<p>Requester (or Alice's agent) sends the final signed PDF:</p>
<pre><code class="language-json">{
  "type": "https://didcomm.org/signing/1.0/provide-artifacts",
  "id": "msg4",
  "from": "did:ex:dms",
  "to": ["did:ex:alice"],
  "thid": "thread1",
  "body": {
    "session_id": "sess_abc123",
    "artifacts": [
      {
        "type": "pades-b-lta",
        "digest": "sha-256:9fX2...",
        "links": ["https://dms.example/nda-signed.pdf"]
      }
    ]
  }
}
</code></pre>
<ol start="5">
<li><strong>Acknowledge</strong></li>
</ol>
<p>Alice's agent acknowledges receipt:</p>
<pre><code class="language-json">{
  "type": "https://didcomm.org/signing/1.0/ack",
  "id": "msg5",
  "from": "did:ex:alice",
  "to": ["did:ex:dms"],
  "thid": "thread1",
  "body": {
    "received": "provide-artifacts",
    "session_id": "sess_abc123",
    "receipt_jti": "rcpt_xyz789"
  }
}
</code></pre>
<h2 id="Advanced-Walkthroughs">Advanced Walkthroughs</h2>
<h3 id="Scenario-1-EIP-712-Single-Signer">Scenario 1: EIP-712 Single-Signer</h3>
<p><strong>Use Case:</strong> Web3 app requests user to sign an EIP-712 order</p>
<p><strong>Key Differences:</strong></p>
<ul>
<li><code>object.media_type</code>: <code>application/eip-712</code></li>
<li><code>canonicalization.method</code>: <code>eip-712@1</code></li>
<li><code>suite</code>: <code>evm-eip712@1</code></li>
<li>Attachment <code>data.json</code> carries <code>{types, domain, message}</code></li>
<li><code>partial-signature.signature.value</code>: 65-byte hex <code>0x...</code></li>
</ul>
<h3 id="Scenario-2-PDF-PAdES-2-of-3-Threshold">Scenario 2: PDF PAdES 2-of-3 Threshold</h3>
<p><strong>Participants:</strong></p>
<ul>
<li>Requester: HR system</li>
<li>Signers: Alice, Bob, Carol (need 2 of 3)</li>
<li>Coordinator: HR system</li>
</ul>
<p><strong>Flow:</strong></p>
<ol>
<li>Requester sends <code>request-signing</code> to Alice, Bob, Carol with <code>mode.type: "threshold"</code> and <code>threshold: {scheme: "n-of-m", n: 2, m: 3, signers: [...], aggregation: "pdf-co-sign@1"}</code></li>
<li>Alice and Bob each send <code>partial-signature</code> with their CMS blobs</li>
<li>Coordinator sends <code>combine</code> with <code>status: "threshold_met"</code> and <code>aggregation_result.type: "pdf"</code></li>
<li>Coordinator sends <code>provide-artifacts</code> with final co-signed PDF</li>
<li>All parties send <code>ack</code></li>
</ol>
<h3 id="Scenario-3-Gnosis-Safe-2-of-3-Multisig">Scenario 3: Gnosis Safe 2-of-3 Multisig</h3>
<p><strong>Use Case:</strong> Execute a Safe transaction requiring 2 confirmations</p>
<p><strong>Key Differences:</strong></p>
<ul>
<li><code>suite</code>: <code>evm-safe-tx@1</code></li>
<li><code>object</code> includes <code>safeTxHash</code> and transaction details</li>
<li><code>partial-signature</code> represents Safe confirmations</li>
<li><code>combine</code> executes the transaction via <code>safe-exec@1</code> aggregator</li>
<li><code>provide-artifacts.artifacts[0].type</code>: <code>safe-execution</code> with <code>txid</code></li>
</ul>
<h3 id="Scenario-4-Bitcoin-PSBT-Multi-Party">Scenario 4: Bitcoin PSBT Multi-Party</h3>
<p><strong>Use Case:</strong> Coordinate a 2-of-3 multisig Bitcoin transaction</p>
<p><strong>Key Differences:</strong></p>
<ul>
<li><code>object.media_type</code>: <code>application/psbt</code></li>
<li><code>canonicalization.method</code>: <code>psbt@2</code></li>
<li><code>suite</code>: <code>psbt@2</code></li>
<li>Each <code>partial-signature</code> carries an updated PSBT fragment</li>
<li><code>combine</code> runs <code>psbt-finalize@2</code> aggregator</li>
<li><code>provide-artifacts</code> includes hex transaction + txid</li>
</ul>
<h3 id="Scenario-5-Database-Password-Unlock-Sealed-Secret">Scenario 5: Database Password Unlock (Sealed Secret)</h3>
<p><strong>Use Case:</strong> Secure, replay-proof delivery of database password to authorized device</p>
<p><strong>Participants:</strong></p>
<ul>
<li><strong>Client Device:</strong> Database application (<code>did:ex:db-client</code>, device counter <code>ctr=41</code>)</li>
<li><strong>Coordinator:</strong> Credential vault service (<code>did:ex:vault</code>)</li>
</ul>
<p><strong>Flow:</strong></p>
<ol>
<li><strong>Request Authorization</strong></li>
</ol>
<p>Client sends <code>request-signing</code> requesting database password:</p>
<pre><code class="language-json">{
  "type": "https://didcomm.org/signing/1.0/request-signing",
  "from": "did:ex:db-client",
  "to": ["did:ex:vault"],
  "thid": "thread-unlock-1",
  "body": {
    "session": {
      "session_id": "sess_unlock_db_prod",
      "mode": {"type": "single"}
    },
    "object": {
      "id": "so_db_prod_pw",
      "media_type": "application/octet-stream",
      "canonicalization": {"method": "raw-bytes@1"},
      "digest": {"alg": "sha-256", "value": "placeholder"}
    },
    "suite": {
      "suite": "jws-ed25519@1",
      "key_binding": {
        "controller": "did:ex:db-client#device-key-1"
      }
    },
    "idempotency_key": "unlock_20251019_001"
  }
}
</code></pre>
<ol start="2">
<li><strong>Policy Check &amp; Token Creation</strong></li>
</ol>
<p>Coordinator:</p>
<ul>
<li>Validates client authorization (e.g., via policy or VP)</li>
<li>Increments device counter: <code>ctr = 42</code> (was 41)</li>
<li>Creates authorization token:</li>
</ul>
<pre><code class="language-json">{
  "token": {
    "typ": "signing-ticket",
    "session_id": "sess_unlock_db_prod",
    "scope": "unlock",
    "device": "did:ex:db-client#device-key-1",
    "ctr": 42,
    "exp": "2025-10-19T16:02:00Z",
    "cap": 1
  }
}
</code></pre>
<ul>
<li>Signs token with coordinator key</li>
<li>Computes <code>ticket_digest = sha-256(serialize(token))</code></li>
</ul>
<ol start="3">
<li><strong>Envelope Creation</strong></li>
</ol>
<p>Coordinator encrypts database password using HPKE:</p>
<pre><code class="language-python"># Pseudocode
AAD = {
  "ticket_digest": "sha-256:9f2a...",
  "session_id": "sess_unlock_db_prod",
  "device": "did:ex:db-client#device-key-1"
}
recipient_pk = resolve_public_key("did:ex:db-client#device-key-1")
plaintext = "MySecureDBPassword123!"
(ciphertext, ek_pub) = HPKE.Seal(recipient_pk, plaintext, serialize(AAD))
</code></pre>
<ol start="4">
<li><strong>Deliver Sealed Secret</strong></li>
</ol>
<p>Coordinator sends <code>provide-artifacts</code>:</p>
<pre><code class="language-json">{
  "type": "https://didcomm.org/signing/1.0/provide-artifacts",
  "from": "did:ex:vault",
  "to": ["did:ex:db-client"],
  "thid": "thread-unlock-1",
  "body": {
    "session_id": "sess_unlock_db_prod",
    "artifacts": [
      {
        "type": "sealed-secret@1",
        "suite": "envelope-hpke@1",
        "aad": {
          "ticket_digest": "sha-256:9f2a..."
        },
        "ciphertext": "YjY0LWVuY29kZWQtY2lwaGVydGV4dA==",
        "enc": {
          "kem": "X25519",
          "kdf": "HKDF-SHA256",
          "aead": "AES-256-GCM",
          "ek_pub": "ZXBoZW1lcmFsLXB1YmxpYy1rZXk="
        }
      }
    ],
    "token": {
      "token": {
        "typ": "signing-ticket",
        "session_id": "sess_unlock_db_prod",
        "scope": "unlock",
        "device": "did:ex:db-client#device-key-1",
        "ctr": 42,
        "exp": "2025-10-19T16:02:00Z",
        "cap": 1
      },
      "sig": {
        "suite": "jws-ed25519@1",
        "kid": "did:ex:vault#signing-key",
        "value": "c2lnbmF0dXJlLWRhdGE="
      }
    }
  }
}
</code></pre>
<ol start="5">
<li><strong>Client Consumption</strong></li>
</ol>
<p>Client receives artifact and:</p>
<p>a. <strong>Verify token signature</strong>:</p>
<pre><code class="language-python">verify_jws(token.sig, coordinator_public_key)  # MUST pass
</code></pre>
<p>b. <strong>Check expiration</strong>:</p>
<pre><code class="language-python">assert token.exp &gt; now()  # MUST be true
</code></pre>
<p>c. <strong>Check counter</strong> (replay protection):</p>
<pre><code class="language-python">last_seen_ctr = load_from_persistent_storage("did:ex:db-client#device-key-1")
# last_seen_ctr = 41
assert token.ctr &gt; last_seen_ctr  # 42 &gt; 41 ✓
</code></pre>
<p>d. <strong>Verify envelope binding</strong>:</p>
<pre><code class="language-python">computed_digest = sha256(serialize(token.token))
assert artifacts[0].aad.ticket_digest == "sha-256:" + computed_digest  # MUST match
</code></pre>
<p>e. <strong>Persist counter BEFORE decryption</strong> (critical!):</p>
<pre><code class="language-python">save_to_persistent_storage("did:ex:db-client#device-key-1", ctr=42)
</code></pre>
<p>f. <strong>Decrypt secret</strong>:</p>
<pre><code class="language-python">AAD = {
  "ticket_digest": artifacts[0].aad.ticket_digest,
  "session_id": token.session_id,
  "device": token.device
}
device_sk = load_private_key("did:ex:db-client#device-key-1")
password = HPKE.Open(device_sk, artifacts[0].ciphertext, serialize(AAD), artifacts[0].enc.ek_pub)
# password = "MySecureDBPassword123!"
</code></pre>
<p>g. <strong>Use and zeroize</strong>:</p>
<pre><code class="language-python">db_connection = connect_to_database(username, password)
zeroize(password)  # Clear from memory
</code></pre>
<p>h. <strong>Acknowledge receipt</strong>:</p>
<pre><code class="language-json">{
  "type": "https://didcomm.org/signing/1.0/ack",
  "from": "did:ex:db-client",
  "to": ["did:ex:vault"],
  "thid": "thread-unlock-1",
  "body": {
    "received": "provide-artifacts",
    "session_id": "sess_unlock_db_prod",
    "receipt_jti": "rcpt_unlock_42"
  }
}
</code></pre>
<p><strong>Security Analysis:</strong></p>
<ul>
<li><strong>Replay Attempt</strong>: If attacker intercepts and replays message, client rejects because <code>ctr=42 ≤ last_seen_ctr=42</code></li>
<li><strong>Envelope Transplant</strong>: If attacker tries to use envelope with different token, AAD verification fails</li>
<li><strong>Token Forgery</strong>: Cannot forge token without coordinator's private key</li>
<li><strong>Device Binding</strong>: Only device with correct HPKE private key can decrypt</li>
<li><strong>Short-Lived</strong>: Token expires in 2 minutes, limiting exposure window</li>
<li><strong>Single-Use</strong>: Counter + <code>cap:1</code> enforce one-time use</li>
</ul>
<p><strong>Key Differences from Standard Signing:</strong></p>
<ul>
<li>No traditional signature produced; authorization token is the "signature"</li>
<li>Envelope (HPKE) used instead of signature suite</li>
<li>Counter-based replay protection instead of time-only</li>
<li>Secret delivered encrypted, not in plaintext artifacts</li>
</ul>
<h2 id="Profiles">Profiles</h2>
<h3 id="Profile-PDF--PAdES">Profile: PDF / PAdES</h3>
<ul>
<li><strong>Media Type:</strong> <code>application/pdf</code></li>
<li><strong>Canonicalization:</strong> <code>pdf-incremental-update@1</code> with <code>byte_range</code> parameter</li>
<li><strong>Suite:</strong> <code>pades-b-b@1</code> (basic) or <code>pades-b-lta@1</code> (long-term archival with timestamps/OCSP)</li>
<li><strong>Artifacts:</strong> Final PDF link + SHA-256 digest; optionally RFC3161 timestamp and OCSP/CRL evidence</li>
</ul>
<h3 id="Profile-EVM--EIP-712">Profile: EVM — EIP-712</h3>
<ul>
<li><strong>Media Type:</strong> <code>application/eip-712</code></li>
<li><strong>Canonicalization:</strong> <code>eip-712@1</code></li>
<li><strong>Suite:</strong> <code>evm-eip712@1</code></li>
<li><strong>Attachment:</strong> <code>data.json</code> MUST carry <code>{types, domain, message}</code> per EIP-712 spec</li>
<li><strong>Signature Output:</strong> 65-byte hex <code>0x...</code> (r, s, v)</li>
</ul>
<h3 id="Profile-EVM--Safe-Multisig">Profile: EVM — Safe Multisig</h3>
<ul>
<li><strong>Suite:</strong> <code>evm-safe-tx@1</code></li>
<li><strong>Object:</strong> Describes <code>safeTxData</code> and/or <code>safeTxHash</code></li>
<li><strong>Partial Signatures:</strong> Safe owner confirmations</li>
<li><strong>Combine:</strong> MAY execute transaction and return <code>txid</code> in <code>aggregation_result</code></li>
</ul>
<h3 id="Profile-Bitcoin--PSBT">Profile: Bitcoin — PSBT</h3>
<ul>
<li><strong>Media Type:</strong> <code>application/psbt</code></li>
<li><strong>Canonicalization:</strong> <code>psbt@2</code></li>
<li><strong>Suite:</strong> <code>psbt@2</code></li>
<li><strong>Partial Signatures:</strong> Updated PSBT fragments</li>
<li><strong>Combine:</strong> <code>psbt-finalize@2</code> aggregator produces finalized hex transaction</li>
<li><strong>Artifacts:</strong> Transaction hex + txid (if broadcast)</li>
</ul>
<h3 id="Profile-Supply-Chain--OCI-Sigstore">Profile: Supply Chain — OCI (Sigstore)</h3>
<ul>
<li><strong>Media Type:</strong> <code>application/vnd.oci.image.manifest.v1+json</code></li>
<li><strong>Canonicalization:</strong> <code>oci-manifest@1</code></li>
<li><strong>Suite:</strong> <code>sigstore-fulcio@1</code></li>
<li><strong>Combine:</strong> <code>oci-multi-sign@1</code> aggregator</li>
<li><strong>Artifacts:</strong> Signature references (e.g., Rekor transparency log entries)</li>
</ul>
<h3 id="Profile-Sealed-Secret-DB-Unlock--Credential-Delivery">Profile: Sealed Secret (DB Unlock &amp; Credential Delivery)</h3>
<p>This profile enables replay-proof, device-bound delivery of secrets such as database passwords, API keys, or ephemeral credentials.</p>
<ul>
<li><strong>Media Type:</strong> <code>application/octet-stream</code> (or custom, e.g., <code>application/x-db-credential</code>)</li>
<li><strong>Canonicalization:</strong> <code>raw-bytes@1</code> (identity)</li>
<li><strong>Suite:</strong> Any signature suite for token signing (e.g., <code>jws-ed25519@1</code>)</li>
<li><strong>Envelope:</strong> <code>envelope-hpke@1</code> (MUST) or <code>envelope-didcomm-auth@1</code> (MAY)</li>
<li><strong>Mode:</strong> <code>single</code> (one recipient device)</li>
</ul>
<p><strong>Flow:</strong></p>
<ol>
<li>
<p><strong>Request</strong>: Client sends <code>request-signing</code> with:</p>
<ul>
<li><code>object.canonicalization.method</code>: <code>raw-bytes@1</code></li>
<li><code>object.digest</code>: Digest over placeholder or metadata (not the secret itself)</li>
<li><code>suite.key_binding.controller</code>: Client device DID/key</li>
<li>Optional: <code>idempotency_key</code>, client <code>nonce</code></li>
</ul>
</li>
<li>
<p><strong>Policy Check</strong>: Coordinator validates authorization, enforces policies</p>
</li>
<li>
<p><strong>Token Issuance</strong>: Coordinator:</p>
<ul>
<li>Increments device counter: <code>ctr = last_ctr(device) + 1</code></li>
<li>Builds authorization token with <code>{session_id, scope: "unlock", device, ctr, exp, cap: 1}</code></li>
<li>Signs token: <code>sig = sign(serialize(token), coordinator_key)</code></li>
</ul>
</li>
<li>
<p><strong>Envelope Creation</strong>: Coordinator:</p>
<ul>
<li>Computes <code>ticket_digest = sha-256(serialize(token))</code></li>
<li>Builds AAD: <code>{ticket_digest, session_id, device}</code></li>
<li>Encrypts secret <code>P</code> using <code>envelope-hpke@1</code>:
<ul>
<li><code>(ciphertext, ek_pub) = HPKE.Seal(recipient_pk, P, AAD)</code></li>
</ul>
</li>
</ul>
</li>
<li>
<p><strong>Delivery</strong>: Coordinator sends <code>provide-artifacts</code> (or <code>issue-token</code>) with:</p>
<ul>
<li><code>artifacts[0].type</code>: <code>sealed-secret@1</code></li>
<li><code>artifacts[0].suite</code>: <code>envelope-hpke@1</code></li>
<li><code>artifacts[0].aad</code>: <code>{ticket_digest}</code></li>
<li><code>artifacts[0].ciphertext</code>: encrypted secret</li>
<li><code>artifacts[0].enc</code>: <code>{kem, kdf, aead, ek_pub}</code></li>
<li><code>token</code>: signed authorization token</li>
</ul>
</li>
<li>
<p><strong>Consumption</strong>: Client:</p>
<ul>
<li>Verifies <code>token.sig</code> against coordinator's public key</li>
<li>Checks <code>token.exp &gt; now</code> (not expired)</li>
<li>Checks <code>token.ctr &gt; last_seen_ctr(device)</code> (replay protection)</li>
<li>Verifies <code>aad.ticket_digest == sha-256(serialize(token))</code> (binding)</li>
<li><strong>Persists</strong> <code>last_seen_ctr(device) = token.ctr</code> (MUST happen before decryption)</li>
<li>Decrypts: <code>P = HPKE.Open(recipient_sk, ciphertext, AAD, ek_pub)</code></li>
<li>Uses secret <code>P</code> (e.g., unlocks database)</li>
<li>Zeroizes <code>P</code> from memory</li>
<li>Sends <code>ack</code></li>
</ul>
</li>
</ol>
<p><strong>Security Properties:</strong></p>
<ul>
<li><strong>Replay Protection</strong>: Counter monotonicity enforced client-side and server-side</li>
<li><strong>Device Binding</strong>: Envelope sealed to specific device public key</li>
<li><strong>Transplant Resistance</strong>: AAD cryptographically binds envelope to specific token</li>
<li><strong>Single-Use</strong>: <code>cap: 1</code> + counter persistence prevents reuse</li>
<li><strong>Short-Lived</strong>: Typical <code>exp</code> of 30-120 seconds</li>
<li><strong>Non-Exportable</strong>: Device keys SHOULD be stored in TPM/SE/Keychain</li>
</ul>
<p><strong>Offline Batch Variant:</strong></p>
<p>Coordinator MAY pre-mint <code>K</code> tokens with sequential counters <code>{ctr, ctr+1, ..., ctr+K-1}</code> and corresponding envelopes. Client caches them offline and consumes sequentially, persisting <code>last_seen_ctr</code> after each use.</p>
<p><strong>Use Cases:</strong></p>
<ul>
<li>Database password unlock (one-time retrieval)</li>
<li>API key rotation (ephemeral credentials)</li>
<li>Secure command execution (privilege escalation tokens)</li>
<li>Hardware unlock (device-bound secrets)</li>
</ul>
<h2 id="Design-By-Contract">Design By Contract</h2>
<h3 id="Preconditions">Preconditions</h3>
<ul>
<li>Requester MUST provide valid <code>session</code>, <code>object</code>, and <code>suite</code> in <code>request-signing</code></li>
<li><code>object.digest</code> MUST match canonicalized bytes per <code>canonicalization.method</code></li>
<li>Signer MUST control the key specified in <code>suite.key_binding.controller</code></li>
</ul>
<h3 id="Postconditions">Postconditions</h3>
<ul>
<li>Upon successful <code>ack</code>, requester has non-repudiation receipt</li>
<li>Final artifacts MUST be cryptographically verifiable against <code>object.digest</code></li>
<li>For threshold sessions, <code>combine</code> MUST verify N-of-M threshold satisfaction</li>
</ul>
<h3 id="Invariants">Invariants</h3>
<ul>
<li><code>session_id</code> MUST remain constant throughout session lifecycle</li>
<li><code>object_id</code> MUST remain constant for a given signable object</li>
<li>Message threading (<code>thid</code>) MUST be consistent across all session messages</li>
</ul>
<h3 id="Side-Effects">Side Effects</h3>
<ul>
<li>Signing operations MAY trigger on-chain state changes (e.g., Safe execution, PSBT broadcast)</li>
<li>Artifacts MAY be stored in external systems (IPFS, cloud storage, transparency logs)</li>
</ul>
<h3 id="Timeout--Error-Handling">Timeout &amp; Error Handling</h3>
<table>
<thead>
<tr>
<th>Error Code</th>
<th>Description</th>
<th>Recovery</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>unsupported-suite</code></td>
<td>Signer does not support requested signature suite</td>
<td>Requester retries with different suite</td>
</tr>
<tr>
<td><code>unsupported-media-type</code></td>
<td>Media type not recognized</td>
<td>Requester provides different media type</td>
</tr>
<tr>
<td><code>unsupported-canonicalization</code></td>
<td>Canonicalization method not supported</td>
<td>Requester selects compatible method</td>
</tr>
<tr>
<td><code>policy-failed</code></td>
<td>Policy module rejected request</td>
<td>Review and adjust constraints</td>
</tr>
<tr>
<td><code>authz-insufficient</code></td>
<td>Signer lacks authorization</td>
<td>Update permissions or provide VP</td>
</tr>
<tr>
<td><code>expired</code></td>
<td>Request timestamp exceeded <code>expires_time</code></td>
<td>Requester resends with updated time</td>
</tr>
<tr>
<td><code>not-yet-valid</code></td>
<td>Current time before <code>not_before</code></td>
<td>Wait until valid time window</td>
</tr>
<tr>
<td><code>mismatch-digest</code></td>
<td>Computed digest does not match <code>object.digest</code></td>
<td>Requester recomputes and resends</td>
</tr>
<tr>
<td><code>idempotency-conflict</code></td>
<td>Duplicate <code>idempotency_key</code> with different request</td>
<td>Requester uses new idempotency key</td>
</tr>
<tr>
<td><code>threshold-not-reached</code></td>
<td>Insufficient partial signatures collected</td>
<td>Wait for more signers or timeout</td>
</tr>
<tr>
<td><code>aggregation-failed</code></td>
<td>Aggregator could not combine signatures</td>
<td>Retry or change aggregation strategy</td>
</tr>
<tr>
<td><code>attachment-too-large</code></td>
<td>Attachment exceeds <code>max_attachment_size</code></td>
<td>Use <code>data.links</code> instead of inline</td>
</tr>
<tr>
<td><code>artifact-missing</code></td>
<td>Expected artifact not found</td>
<td>Coordinator resends <code>provide-artifacts</code></td>
</tr>
<tr>
<td><code>replay-token</code></td>
<td>Token already consumed (replay attempt detected)</td>
<td>Request new token with fresh counter</td>
</tr>
<tr>
<td><code>counter-stale</code></td>
<td>Token counter ≤ last seen counter for device</td>
<td>Coordinator re-syncs device counter state</td>
</tr>
<tr>
<td><code>envelope-unsupported</code></td>
<td>Requested envelope suite not supported</td>
<td>Negotiate supported envelope via <code>propose-signing</code></td>
</tr>
<tr>
<td><code>envelope-verify-failed</code></td>
<td>AAD binding verification failed</td>
<td>Check token digest matches AAD</td>
</tr>
<tr>
<td><code>device-mismatch</code></td>
<td>Token device identifier doesn't match recipient</td>
<td>Verify correct device key in request</td>
</tr>
</tbody>
</table>
<p><strong>Timeout Recommendations:</strong></p>
<ul>
<li>Requester SHOULD set <code>expires_time</code> constraint (e.g., 24-48 hours)</li>
<li>Coordinator SHOULD timeout threshold sessions after reasonable period (e.g., 1 hour for online sessions)</li>
<li>Multi-round protocols SHOULD timeout individual rounds (e.g., 30 seconds per round)</li>
</ul>
<h2 id="Security">Security</h2>
<h3 id="Threat-Model">Threat Model</h3>
<p><strong>Threats Addressed:</strong></p>
<ol>
<li>
<p><strong>WYSIWYS Mismatch</strong>: Attacker shows signer different content than what is signed</p>
<ul>
<li><strong>Mitigation</strong>: Digest pinning; signer UI MUST render from canonical bytes</li>
</ul>
</li>
<li>
<p><strong>Signer Confusion</strong>: Signer signs unintended content or for wrong purpose</p>
<ul>
<li><strong>Mitigation</strong>: Display hints with human-readable summary; consent flow with key binding proof</li>
</ul>
</li>
<li>
<p><strong>Replay Attacks</strong>: Signature reused in different context</p>
<ul>
<li><strong>Mitigation</strong>: Time windows (<code>not_before</code>, <code>expires_time</code>), <code>use_limit</code>, <code>intended_audience</code></li>
</ul>
</li>
<li>
<p><strong>Token Replay</strong>: Authorization token reused after consumption</p>
<ul>
<li><strong>Mitigation</strong>: Monotonic counters (<code>ctr</code>) enforced client-side and server-side; client persists <code>last_seen_ctr</code> before use</li>
</ul>
</li>
<li>
<p><strong>Envelope Transplant</strong>: Attacker transplants sealed secret envelope to different token</p>
<ul>
<li><strong>Mitigation</strong>: AAD cryptographically binds envelope to token digest; verification MUST check <code>aad.ticket_digest == sha-256(token)</code></li>
</ul>
</li>
<li>
<p><strong>Double-Sign</strong>: Signer produces multiple conflicting signatures (e.g., blockchain slashing)</p>
<ul>
<li><strong>Mitigation</strong>: Idempotency keys; signer tracks previous signatures</li>
</ul>
</li>
<li>
<p><strong>Coordinator Tampering</strong>: Malicious coordinator modifies signatures or session state</p>
<ul>
<li><strong>Mitigation</strong>: All signatures include <code>session_id</code> and <code>object_id</code>; signers verify final artifacts</li>
</ul>
</li>
<li>
<p><strong>Downgrade Attacks</strong>: Attacker forces weak signature suite or envelope during negotiation</p>
<ul>
<li><strong>Mitigation</strong>: <code>propose-signing</code> capabilities discovery; signer rejects unsupported suites/envelopes</li>
</ul>
</li>
</ol>
<h3 id="Security-Requirements">Security Requirements</h3>
<ul>
<li><strong>Digest Pinning (MUST)</strong>: <code>object.digest</code> computed over canonical bytes; Signer UI MUST render preview derived from same canonicalization (or prominently display digest)</li>
<li><strong>Consent (SHOULD)</strong>: Send <code>consent</code> with <code>key_binding_proof</code> prior to signing</li>
<li><strong>Key Binding (MUST)</strong>: Include DID/key identifier; verify key control during session</li>
<li><strong>Replay Protection (MUST)</strong>: Enforce time windows and <code>use_limit</code></li>
<li><strong>Idempotency (SHOULD)</strong>: Use <code>idempotency_key</code> and constraints.<code>use_limit</code></li>
</ul>
<h3 id="Additional-Security-Requirements-Sealed-Secrets--Tokens">Additional Security Requirements (Sealed Secrets &amp; Tokens)</h3>
<ul>
<li><strong>Counter Monotonicity (MUST)</strong>: Clients MUST persist <code>last_seen_ctr(device)</code> before consuming token or decrypting envelope; tokens with <code>ctr ≤ last_seen_ctr</code> MUST be rejected</li>
<li><strong>Envelope Binding (MUST)</strong>: Envelope AAD MUST include <code>sha-256(serialize(token))</code>; receivers MUST verify binding before decryption</li>
<li><strong>Token Verification (MUST)</strong>: Verify <code>token.sig</code> against coordinator's public key before any other operations</li>
<li><strong>Expiration Enforcement (MUST)</strong>: Both server and client MUST enforce <code>token.exp</code>; expired tokens MUST be rejected</li>
<li><strong>Key Pinning (SHOULD)</strong>: Clients SHOULD pin coordinator <code>kid</code> or enforce DID Document resolution policy</li>
<li><strong>Secret Zeroization (MUST)</strong>: Plaintext secrets MUST be zeroized from memory immediately after use</li>
<li><strong>Non-Exportable Keys (SHOULD)</strong>: Device HPKE private keys SHOULD be stored in hardware security modules (TPM, Secure Enclave, Keychain, DPAPI) and marked non-exportable</li>
<li><strong>Audit Logging (SHOULD)</strong>: Coordinators SHOULD log <code>{session_id, device, ctr, exp, kid, status}</code> for all token issuance and consumption events</li>
<li><strong>Crash Hygiene (MUST)</strong>: Implementations MUST prevent secrets from appearing in logs, environment variables, or core dumps</li>
</ul>
<h3 id="Privacy--Confidentiality">Privacy &amp; Confidentiality</h3>
<ul>
<li><strong>Confidentiality</strong>: Use DIDComm authenticated encryption; avoid leaking object contents unless necessary</li>
<li><strong>Minimize Personal Data</strong>: Prefer references (<code>links</code> + <code>hash</code>) over inline payloads</li>
<li><strong>Large Artifacts</strong>: Use attachments with <code>data.links</code> to avoid inline mega-payloads</li>
<li><strong>Observer Privacy</strong>: Observers see session state but not necessarily full payload content</li>
</ul>
<h3 id="Mediation--Transport">Mediation &amp; Transport</h3>
<ul>
<li><strong>DIDComm Pickup v2</strong>: Compatible with offline-first workflows and mediation</li>
<li><strong>Message Expiration</strong>: Consider setting <code>expires_time</code> headers for pickup mediators</li>
<li><strong>Routing</strong>: Works transparently over DIDComm routing agents</li>
</ul>
<h2 id="Composition">Composition</h2>
<h3 id="Supported-Goal-Codes">Supported Goal Codes</h3>
<table>
<thead>
<tr>
<th>Goal Code</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>sign.document</code></td>
<td>Sign a document (PDF, Word, etc.)</td>
</tr>
<tr>
<td><code>sign.transaction</code></td>
<td>Sign a blockchain transaction</td>
</tr>
<tr>
<td><code>sign.credential</code></td>
<td>Sign a Verifiable Credential</td>
</tr>
<tr>
<td><code>sign.package</code></td>
<td>Sign a software package or container image</td>
</tr>
<tr>
<td><code>sign.attestation</code></td>
<td>Sign a cryptographic attestation or receipt</td>
</tr>
</tbody>
</table>
<h3 id="Co-Protocol-Support">Co-Protocol Support</h3>
<p>This protocol MAY be composed with:</p>
<ul>
<li><strong>Issue Credential v2</strong>: Signing protocol can sign Verifiable Credentials as final step</li>
<li><strong>Present Proof v2</strong>: Signers MAY be required to present VPs proving authorization (<code>vp-gate@1</code> policy)</li>
<li><strong>Workflow</strong>: Signing can be orchestrated as steps within larger workflow</li>
<li><strong>Payments</strong>: Signing sessions MAY require payment (e.g., notary services)</li>
</ul>
<h2 id="Discoverability">Discoverability</h2>
<p>Agents SHOULD advertise support using DIDComm feature discovery (similar to Aries RFC-0031):</p>
<pre><code class="language-json">{
  "protocol": "https://didcomm.org/signing/1.0",
  "roles": ["signer", "requester", "coordinator"],
  "suites": [
    "pades-b-lta@1",
    "evm-eip712@1",
    "evm-safe-tx@1",
    "psbt@2"
  ],
  "envelopes": [
    "envelope-hpke@1",
    "envelope-didcomm-auth@1"
  ],
  "max_attachment_size": 10485760
}
</code></pre>
<p><strong>Capability Fields:</strong></p>
<ul>
<li><code>protocol</code>: Protocol URI</li>
<li><code>roles</code>: Supported roles (signer, requester, coordinator, observer)</li>
<li><code>suites</code>: Supported signature suites</li>
<li><code>envelopes</code>: Supported envelope schemes (optional; required for sealed secret support)</li>
<li><code>max_attachment_size</code>: Maximum attachment size in bytes</li>
</ul>
<p><strong>Discovery Methods:</strong></p>
<ul>
<li>DIDComm <code>discover-features</code> protocol</li>
<li>DID Document service endpoints with protocol metadata</li>
<li>Out-of-band invitations with protocol capabilities</li>
</ul>
<h2 id="Implementations">Implementations</h2>
<table>
<thead>
<tr>
<th>Name / Link</th>
<th>Implementation Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td><em>To be published</em></td>
<td>Reference implementations pending</td>
</tr>
</tbody>
</table>
<h2 id="Versioning--Compatibility">Versioning &amp; Compatibility</h2>
<ul>
<li><strong>Protocol Version</strong>: Specified in message type URI (<code>…/signing/1.0/…</code>)</li>
<li><strong>Module Versions</strong>: Registry keys use suffix <code>@N</code> to denote major version (e.g., <code>eip-712@1</code>)</li>
<li><strong>Backward Compatibility</strong>:
<ul>
<li>Minor version bumps (1.0 → 1.1): Add optional features, maintain compatibility</li>
<li>Major version bumps (1.0 → 2.0): Breaking changes to message structure or semantics</li>
</ul>
</li>
</ul>
<h2 id="Conformance">Conformance</h2>
<p>An implementation is <strong>conformant</strong> if it:</p>
<ol>
<li>Produces and consumes message types in §Message Reference per schemas</li>
<li>Implements at least one Canonicalizer (e.g., <code>raw-bytes@1</code>) and one Suite (e.g., <code>jws-secp256k1@1</code>)</li>
<li>Enforces digest pinning: verifies <code>object.digest</code> matches canonicalized bytes</li>
<li>Enforces idempotency: rejects duplicate <code>idempotency_key</code> with different request</li>
<li>Supports <code>problem-report</code> with error codes from §Design By Contract</li>
</ol>
<p><strong>Optional Conformance (Sealed Secrets &amp; Authorization Tokens):</strong></p>
<p>An implementation supporting sealed secrets is <strong>conformant</strong> if it additionally:</p>
<ol>
<li>Implements at least one Envelope (e.g., <code>envelope-hpke@1</code>)</li>
<li>Enforces counter monotonicity: persists <code>last_seen_ctr(device)</code> before token consumption; rejects <code>ctr ≤ last_seen_ctr</code></li>
<li>Enforces envelope binding: verifies <code>aad.ticket_digest == sha-256(serialize(token))</code> before decryption</li>
<li>Verifies token signature before any other operations</li>
<li>Enforces token expiration on both client and server</li>
<li>Zeroizes plaintext secrets from memory after use</li>
<li>Supports error codes: <code>replay-token</code>, <code>counter-stale</code>, <code>envelope-unsupported</code>, <code>envelope-verify-failed</code>, <code>device-mismatch</code></li>
</ol>
<p><strong>Other Optional Conformance:</strong></p>
<ul>
<li>Multi-signer orchestration (coordinator role)</li>
<li>Multi-round cryptographic aggregation</li>
<li>On-chain execution (Safe, PSBT broadcast)</li>
<li>Advanced policies (VP-gate, spend limits)</li>
<li>Offline batch token issuance</li>
</ul>
<h2 id="Test-Fixtures">Test Fixtures</h2>
<p>Reference test vectors (to be published):</p>
<ul>
<li><strong>PDF Fixture</strong>: Byte ranges + expected digest + two CMS co-signatures</li>
<li><strong>EIP-712 Order</strong>: Typed data + expected signature</li>
<li><strong>Safe Transaction</strong>: Hash + two confirmations + txid on testnet</li>
<li><strong>PSBT</strong>: 2-of-3 multisig with expected final txid</li>
<li><strong>Sealed Secret (HPKE)</strong>: Authorization token + HPKE envelope + expected plaintext + counter sequence demonstrating replay rejection</li>
</ul>
<h2 id="Future-Considerations">Future Considerations</h2>
<p>Potential enhancements for v1.1+:</p>
<ul>
<li><strong>Transparency Log Witness</strong>: Optional transparency log entries for all steps/artifacts (e.g., Rekor integration)</li>
<li><strong>Observer Subscription Stream</strong>: Standardized pub/sub for observers</li>
<li><strong>Hash Agility Registry</strong>: Support for SHA-256, SHA-512, BLAKE3 in <code>digest.alg</code></li>
<li><strong>JSON-LD Profile</strong>: Support for Linked Data Proof suites (e.g., Ed25519Signature2020)</li>
<li><strong>Batch Signing</strong>: Sign multiple objects in single session</li>
<li><strong>Revocation</strong>: Protocol extension for signature revocation/invalidation</li>
</ul>
<h2 id="Endnotes">Endnotes</h2>
<ol>
<li><strong>EIP-712</strong>: Ethereum Improvement Proposal for typed structured data signing</li>
<li><strong>PAdES</strong>: PDF Advanced Electronic Signatures (ETSI EN 319 142)</li>
<li><strong>CAdES</strong>: CMS Advanced Electronic Signatures (ETSI EN 319 122)</li>
<li><strong>PSBT</strong>: Partially Signed Bitcoin Transaction (BIP-174, BIP-370)</li>
<li><strong>MuSig2</strong>: Multi-signature Schnorr protocol with two communication rounds</li>
<li><strong>FROST</strong>: Flexible Round-Optimized Schnorr Threshold signatures</li>
<li><strong>Gnosis Safe</strong>: Multi-signature smart contract wallet</li>
<li><strong>ERC-1271</strong>: Standard signature validation method for contracts</li>
<li><strong>Sigstore/Fulcio</strong>: Keyless signing with OIDC identities and transparency logs</li>
<li><strong>OCI</strong>: Open Container Initiative image format</li>
</ol></div></article><div class="Protocol-module--meta--1e1pP"><div class="Protocol-module--metaContent--1hPYi"><div class="font-subheadline Protocol-module--metaTitle--PGKpJ">PIURI</div><div class="font-footnote">https://didcomm.org/signing/1.0</div></div><div class="Protocol-module--metaContent--1hPYi"><div class="font-subheadline Protocol-module--metaTitle--PGKpJ">Status</div><div class="Status-module--status--1dG8s Status-module--demonstrated--2VaNN">Demonstrated</div></div><div class="Protocol-module--metaContent--1hPYi"><div class="font-subheadline Protocol-module--metaTitle--PGKpJ">Hashtags</div><div class="Tags-module--tags--11-St"><a class="Tags-module--tag--14doh" href="/search?tag=signing"># <!-- -->signing</a><a class="Tags-module--tag--14doh" href="/search?tag=signatures"># <!-- -->signatures</a><a class="Tags-module--tag--14doh" href="/search?tag=multisig"># <!-- -->multisig</a><a class="Tags-module--tag--14doh" href="/search?tag=cryptography"># <!-- -->cryptography</a><a class="Tags-module--tag--14doh" href="/search?tag=pdf"># <!-- -->pdf</a><a class="Tags-module--tag--14doh" href="/search?tag=evm"># <!-- -->evm</a><a class="Tags-module--tag--14doh" href="/search?tag=bitcoin"># <!-- -->bitcoin</a><a class="Tags-module--tag--14doh" href="/search?tag=hpke"># <!-- -->hpke</a><a class="Tags-module--tag--14doh" href="/search?tag=sealed-secrets"># <!-- -->sealed-secrets</a><a class="Tags-module--tag--14doh" href="/search?tag=authorization-tokens"># <!-- -->authorization-tokens</a><a class="Tags-module--tag--14doh" href="/search?tag=replay-protection"># <!-- -->replay-protection</a></div></div><div class="Protocol-module--metaContent--1hPYi"><div class="font-subheadline Protocol-module--metaTitle--PGKpJ">Publisher</div><a rel="noreferrer noopener nofollow" aria-label="GitHub profile vinaysingh8866" class="Avatar-module--avatar--2HGSY" target="_blank" href="https://github.com/vinaysingh8866"><div style="background-image:url(https://avatars.githubusercontent.com/u/12121665?v=4&amp;s=48)" class="Avatar-module--img--3CeLS font-footnote"></div><span class="font-footnote Avatar-module--publisher--ktcuv">@<!-- -->vinaysingh8866</span></a></div><div class="Protocol-module--metaContent--1hPYi"><div class="font-subheadline Protocol-module--metaTitle--PGKpJ">Authors</div><div class="Authors-module--authors--fKUTX"><a class="font-footnote Authors-module--link--2M7F6" href="mailto:vinay@verid.id">Vinay Singh</a></div></div><div class="hide-mobile hide-print"><div class="Protocol-module--metaContent--1hPYi"><div class="font-subheadline Protocol-module--metaTitle--PGKpJ">Version</div><div class="font-footnote">1.0</div></div></div><div class="Protocol-module--metaContent--1hPYi"><div class="font-subheadline Protocol-module--metaTitle--PGKpJ">License</div><div class="font-footnote">MIT</div></div><div class="Protocol-module--metaContent--1hPYi"><div class="font-subheadline Protocol-module--metaTitle--PGKpJ">Last modified</div><span class="font-footnote">2025 Nov 17, 20:11 PM</span></div></div></div></main></div></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/signing/1.0/";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"polyfill":["/polyfill-5cf53654e1a73056adc6.js"],"app":["/app-2258e9ff8c9279fe5507.js"],"component---src-pages-404-tsx":["/component---src-pages-404-tsx-06fe7db8f8c75ad21a4d.js"],"component---src-pages-index-tsx":["/component---src-pages-index-tsx-eb4a3aa53617243254eb.js"],"component---src-templates-book-book-tsx":["/component---src-templates-book-book-tsx-f87c4cd85a9942002b2d.js"],"component---src-templates-protocol-protocol-tsx":["/component---src-templates-protocol-protocol-tsx-3391b2f00d0a4ae5a5c3.js"],"component---src-templates-search-search-tsx":["/component---src-templates-search-search-tsx-e8abc6de2d7bc98ba3a7.js"]};/*]]>*/</script><script src="/polyfill-5cf53654e1a73056adc6.js" nomodule=""></script><script src="/component---src-templates-protocol-protocol-tsx-3391b2f00d0a4ae5a5c3.js" async=""></script><script src="/commons-ceb25d5ebe4b77987b3b.js" async=""></script><script src="/app-2258e9ff8c9279fe5507.js" async=""></script><script src="/framework-0993f47ffebd3bbb5409.js" async=""></script><script src="/webpack-runtime-7b527356047a9787095f.js" async=""></script></body></html>
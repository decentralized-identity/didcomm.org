{
    "componentChunkName": "component---src-templates-protocol-protocol-tsx",
    "path": "/data-disclosure-agreement/1.0/",
    "result": {"data":{"markdownRemark":{"html":"<h1 id=\"Data-Disclosure-Agreement-Protocol-Specification\">Data Disclosure Agreement Protocol Specification</h1>\n<p><strong>Specification Status:</strong> version 1.0.0 (Ready for impplementation)\nThis is reviewed and implementation has started. This spec is live and is being iterated as part of the PS-SDA project in NGI-ONTOCHAIN. The project has received funding from the European Union’s Horizon 2020 research and innovation programme under grant agreement No 957338.</p>\n<p><strong>Latest Draft:</strong> <a href=\"https://dda.igrant.io\">Avaialble here</a></p>\n<p><strong>Editors:</strong>\nMr. George Padayatti (iGrant.io, Sweden)<br>\nMr. Lal Chandran (iGrant.io, Sweden)</p>\n<p><strong>Contributors and Reviwers:</strong>\nMs. Lotta Lundin (iGrant.io, Sweden)\nDr. David Goodman (iGrant.io, Sweden)<br>\nMr. Jan Linquist (Linaltec, Sweden)</p>\n<p><strong>Participate</strong></p>\n<ul>\n<li><a href=\"https://github.com/decentralised-dataexchange/data-exchange-agreements\">GitHub repo</a></li>\n<li><a href=\"https://github.com/decentralised-dataexchange/data-exchange-agreements/issues\">File a bug</a></li>\n<li><a href=\"https://github.com/decentralised-dataexchange/data-exchange-agreements/commits/main\">Commit history</a></li>\n</ul>\n<hr>\n<h2 id=\"Abstract\">Abstract</h2>\n<p>A Data Disclosure Agreement (DDA) enables automated agreement handling for data exchange between a Data Source (DS) and Data Using Service (DUS). It helps organisations to continue leveraging their data assets while being transparent and legitimate in their data usage. Automated agreement handling is a requisite for a scalable and regulatory-compliant data marketplace.. It also provides individuals control over how their data is used and exchanged.</p>\n<h2 id=\"Protocol-flow\">Protocol flow</h2>\n<h3 id=\"Actors\">Actors</h3>\n<ol>\n<li>Data Using Service (DUS)</li>\n<li>Data Source (DS)</li>\n<li>Individual</li>\n<li>Data Intermediary</li>\n</ol>\n<h3 id=\"Pre-requisite\">Pre-requisite</h3>\n<p>The prerequisites are:</p>\n<ol>\n<li>\n<p>All the actors involved in the protocol flow are DIDComm agents. Each interaction between the actors requires a DIDComm message.</p>\n</li>\n<li>\n<p>Prior to the PS-SDA protocol flow, actors must establish connections [1] between each other and identify themselves by presenting the necessary proofs [2].</p>\n</li>\n<li>\n<p>All the actors will have a wallet (mobile or cloud-based, individual and potentially for an enterprise) address and an associated public / private key pair.</p>\n</li>\n<li>\n<p>A wallet address is an externally owned account (EOA) address. Ethereum addresses are composed of the prefix \"0x\" (hexadecimal) concatenated with the rightmost 20 bytes of the Keccak-256 hash of the ECDSA public key with the curve secp256k1.</p>\n</li>\n</ol>\n<h3 id=\"Out-of-scope\">Out of scope</h3>\n<p>The administrative and governance frameworks of the “marketplace” or “data space” is out of scope. The marketplace has performed the proof of business and onboarded DS and DUS.</p>\n<h3 id=\"Publish-DDA-offer-to-Marketplace-DS\">Publish DDA offer to Marketplace (DS)</h3>\n<p><img src=\"../images/publish-dda-to-marketplace.png\" alt=\"\"></p>\n<h4 id=\"Messages\">Messages</h4>\n<p>The <code>/dda-marketplace/1.0</code> protocol consists of these messages:</p>\n<ol>\n<li><code>/dda-marketplace/1.0/publish-request</code></li>\n<li><code>/dda-marketplace/1.0/publish-response</code></li>\n</ol>\n<h4 id=\"Sign-the-DDA-offer\">Sign the DDA offer</h4>\n<p>The DS signs the DDA offer using the secp256k1 private key. The signature is prepared by performing the proof algorithm described by W3C Data Integrity 1.0 specification [3].</p>\n<h4 id=\"Send-signed-DDA-offer-to-Data-Intermediary\">Send signed DDA offer to Data Intermediary</h4>\n<p>The DS construct a DIDComm message of type <code>/dda-marketplace/1.0/publish-request</code> and sends it to the Data Intermediary DIDComm agent. An example is provided below.</p>\n<pre><code class=\"language-json\">{\n  \"type\": \"https://didcomm.org/dda/1.0/publish-request\",\n  \"id\": \"999f6c2b-b0e5-4123-aab0-b5f7bfc780c4\",\n  \"created_time\": \"1639288911\",\n  \"from\": \"&#x3C;sender did>\",\n  \"to\": \"&#x3C;receipient did>\",\n  \"body\": {\n    \"data_disclosure_agreement\": {}\n  }\n}\n</code></pre>\n<h4 id=\"Data-Intermediary-stores-the-signed-DDA-offer-to-CAS\">Data Intermediary stores the signed DDA offer to CAS</h4>\n<p>Once the DDA is received from the DS, the Data Intermediary stores the offer in Content Addressable Storage (CAS) for e.g. IPFS and obtains the Content Identifier (CID).</p>\n<h4 id=\"Data-Intermediary-anchors-CID-to-Ethereum\">Data Intermediary anchors CID to Ethereum</h4>\n<p>The Content Identifier (CID) pointing to a specific DDA offer is anchored to Ethereum by executing the <code>publishDDACID</code> smart contract function.</p>\n<p>The Data Intermediary create a /dda-marketplace/1.0/publish-response DIDComm message and sends it to the DS. This message contains Ethereum transaction hash for the DS to verify the transaction. An example is provided below:</p>\n<pre><code class=\"language-json\">{\n  \"type\": \"https://didcomm.org/dda/1.0/publish-response\",\n  \"id\": \"53f19e0b-5be2-480a-92bc-fcdeabf69ad3\",\n  \"~thread\": {\n        \"thid\": \"999f6c2b-b0e5-4123-aab0-b5f7bfc780c4\"\n    },\n  \"created_time\": \"1639288911\",\n  \"from\": \"&#x3C;sender did>\",\n  \"to\": \"&#x3C;receipient did>\",\n  \"body\": {\n    \"txn_hash\": \"0xeba2df809e7a612a0a0d444ccfa5c839624bdc00dd29e3340d46df3870f8a30e\"\n  }\n}\n</code></pre>\n<h4 id=\"Data-intermediary-publishes-the-DDA-offer-to-a-data-marketplace\">Data intermediary publishes the DDA offer to a data marketplace</h4>\n<p>The data marketplace will subscribe to the smart contract events specific to <code>publishDDACID</code> function and list the DDA in the marketplace. [4]</p>\n<h3 id=\"Negotiate-DDA\">Negotiate DDA</h3>\n<p>The DIDComm protocol is used to facilitate interaction between DS and DUS to negotiate terms for the DDA.</p>\n<p><img src=\"../images/negotiate-dda.png\" alt=\"\"></p>\n<h4 id=\"Messages-1\">Messages</h4>\n<p>The <code>/dda-negotiation/1.0</code> protocol consists of these messages:</p>\n<ol>\n<li><code>/dda-negotiation/1.0/propose-terms</code></li>\n<li><code>/dda-negotiation/1.0/accept-terms</code></li>\n<li><code>/dda-negotiation/1.0/reject-terms</code></li>\n<li><code>/dda-negotiation/1.0/accept-dda</code></li>\n</ol>\n<h4 id=\"DUS-proposes-terms-for-DDA-Counter-offer\">DUS proposes terms for DDA (Counter offer)</h4>\n<p>Resolve CID to obtain a DDA offer from IPFS and then construct a counter proposal if the \"terms\" are not satisfactory. An example is as provided below:</p>\n<pre><code class=\"language-json\">{\n  \"type\": \"https://didcomm.org/dda-negotiation/1.0/propose-terms\",\n  \"id\": \"999f6c2b-b0e5-4123-aab0-b5f7bfc780c4\",\n  \"created_time\": \"1639288911\",\n  \"from\": \"&#x3C;sender did>\",\n  \"to\": \"&#x3C;receipient did>\",\n  \"body\": {\n    \"data_disclosure_agreement\": {}\n  }\n}\n</code></pre>\n<h4 id=\"DS-accepts-the-proposed-terms\">DS accepts the proposed terms</h4>\n<p>The DS updates the DDA to include the proposed terms and signs it. A copy of the same is sent to the DUS for counter-signing. An example is as provided below:</p>\n<pre><code class=\"language-json\">{\n  \"type\": \"https://didcomm.org/dda-negotiation/dda-negotiation/1.0/accept-terms\",\n  \"id\": \"53f19e0b-5be2-480a-92bc-fcdeabf69ad3\",\n  \"~thread\": {\n        \"thid\": \"999f6c2b-b0e5-4123-aab0-b5f7bfc780c4\"\n    },\n  \"created_time\": \"1639288911\",\n  \"from\": \"&#x3C;sender did>\",\n  \"to\": \"&#x3C;receipient did>\",\n  \"body\": {\n    \"data_disclosure_agreement\": {}\n  }\n}\n</code></pre>\n<h4 id=\"DS-rejects-the-proposed-terms\">DS rejects the proposed terms</h4>\n<p>An example is provided below.</p>\n<pre><code class=\"language-json\">{\n  \"type\": \"https://didcomm.org/dda-negotiation/dda-negotiation/1.0/reject-terms\",\n  \"id\": \"53f19e0b-5be2-480a-92bc-fcdeabf69ad3\",\n  \"~thread\": {\n        \"thid\": \"999f6c2b-b0e5-4123-aab0-b5f7bfc780c4\"\n    },\n  \"created_time\": \"1639288911\",\n  \"from\": \"&#x3C;sender did>\",\n  \"to\": \"&#x3C;receipient did>\"\n}\n</code></pre>\n<h4 id=\"DUS-accepts-the-DDA\">DUS accepts the DDA</h4>\n<p>The DUS counter signs the DDA and sends a copy to the DS. An example is as provided below:</p>\n<pre><code class=\"language-json\">{\n  \"type\": \"https://didcomm.org/dda-negotiation/dda-negotiation/1.0/accept-dda\",\n  \"id\": \"1b8381a8-5b7a-44b0-a6b6-037a4aac5609\",\n  \"created_time\": \"1639288911\",\n  \"from\": \"&#x3C;sender did>\",\n  \"to\": \"&#x3C;receipient did>\"\n  \"body\": {\n    \"data_disclosure_agreement\": {}\n  }\n}\n</code></pre>\n<h3 id=\"Exchange-personal-data-between-DS-and-DS-with-unknown-individual-identity-Eg-Anonymised-data-exchange\">Exchange personal data between DS and DS with unknown individual identity (E.g. Anonymised data exchange)</h3>\n<p>In this mode of personal data exchange, DS and DUS do not need individual identity proof before the data is exchanged e.g. in the case of a DUS using anonymous or pseudonymous data sharing to offer personalised services,</p>\n<p><img src=\"../images/exchange-without-identification.png\" alt=\"\"></p>\n<h4 id=\"DA-Negotiation\">DA Negotiation</h4>\n<p>DS and Individual agree on the terms of data usage in conformance to <a href=\"https://github.com/decentralised-dataexchange/automated-data-agreements/blob/main/docs/didcomm-protocol-spec.md#40ada-rfc-0003-data-agreement-negotiation-protocol-10\">ADA RFC 0003</a>.</p>\n<h4 id=\"Release-personal-data\">Release personal data</h4>\n<h5 id=\"Messages-2\">Messages</h5>\n<p>The <code>/data-exchange/1.0</code> protocol consists of these messages:</p>\n<ol>\n<li><code>/data-exchange/1.0/request-access</code></li>\n<li><code>/data-exchange/1.0/grant-access</code></li>\n</ol>\n<h5 id=\"DUS-request-access-to-personal-data\">DUS request access to personal data</h5>\n<p>The DUS requests access to personal data by presenting the hash of a signed DDA document to the DS. An example is provided below:</p>\n<pre><code class=\"language-json\">{\n  \"type\": \"https://didcomm.org/dda-negotiation/data-exchange/1.0/request-access\",\n  \"id\": \"1b8381a8-5b7a-44b0-a6b6-037a4aac5609\",\n  \"created_time\": \"1639288911\",\n  \"from\": \"&#x3C;sender did>\",\n  \"to\": \"&#x3C;receipient did>\"\n  \"body\": {\n    \"dda_hash\": \"\"\n    \"nonce\": \"\"\n  }\n}\n</code></pre>\n<h5 id=\"DS-grant-access-to-personal-data\">DS grant access to personal data</h5>\n<p>The DS validates (checks for e.g. expiry, revocation list etc.), authenticates the DDA and releases an \"access_token\" to the protected resources.</p>\n<p>The Access Token is constructed according to <a href=\"https://datatracker.ietf.org/doc/html/rfc7519\">JWT IETF 7519</a>. The Access Token claim set contains necessary claims for access to the protected resource. Following are the mandatory claims.</p>\n<ul>\n<li>dda: Hash of the signed DDA.</li>\n<li>resource_endpoints: Array of protected resource endpoints which accept the Access Token.</li>\n<li>iss (issuer): Issuer of the JWT</li>\n<li>sub (subject): Subject of the JWT (the user)</li>\n<li>aud (audience): Recipient for which the JWT is intended</li>\n<li>exp (expiration time): Time after which the JWT expires</li>\n<li>nbf (not before time): Time before which the JWT must not be accepted for processing</li>\n<li>iat (issued at the time): Time at which the JWT was issued; can be used to determine the age of the JWT</li>\n<li>jti (JWT ID): Unique identifier; can be used to prevent the JWT from being replayed (allows a token to be used only once)</li>\n</ul>\n<p>To ensure secure Access Token issuance, we implement an Authenticated Key Exchange (AKE) cryptographic protocol. The AKE provides additional security against potential attacks (MITM, replay attacks, etc.).</p>\n<p>The AKE1 variant, as described in chapters 21.1-21.2 (<a href=\"https://toc.cryptobook.us/book.pdf\">https://toc.cryptobook.us/book.pdf</a>) is implemented.</p>\n<p>The AKE is a non-interactive protocol. The steps are provided below.</p>\n<ol>\n<li>\n<p>Encrypt the Access Token using the secp256k1 public key associated with the DUS to obtain the cipher text. (AES-CBC ECIES)</p>\n</li>\n<li>\n<p>Generate a signature for the cipher text.</p>\n</li>\n</ol>\n<p>The DS publishes the access token to Ethereum by executing the <code>publishAccessToken</code> smart contract function. This function accepts three parameters:</p>\n<ul>\n<li>cipher_text</li>\n<li>sig</li>\n<li>nonce</li>\n</ul>\n<p>The DS constructs a /data-exchange/1.0/grant-access DIDComm message with an Ethereum transaction hash in the body and responds to the DUS. An example is provided below:</p>\n<pre><code class=\"language-json\">{\n  \"type\": \"https://didcomm.org/dda-negotiation/data-exchange/1.0/grant-access\",\n  \"id\": \"999f6c2b-b0e5-4123-aab0-b5f7bfc780c4\",\n  \"~thread\": {\n        \"thid\": \"1b8381a8-5b7a-44b0-a6b6-037a4aac5609\"\n    },\n  \"created_time\": \"1639288911\",\n  \"from\": \"&#x3C;sender did>\",\n  \"to\": \"&#x3C;receipient did>\"\n  \"body\": {\n    \"txn_hash\": \"0xeba2df809e7a612a0a0d444ccfa5c839624bdc00dd29e3340d46df3870f8a30e\"\n  }\n}\n</code></pre>\n<h5 id=\"DUS-obtains-the-access-token\">DUS obtains the access token</h5>\n<p>The DUS resolves the transaction to obtain the cipher_text, sig and nonce, then proceeds to perform the following steps:</p>\n<ol>\n<li>Decrypts the cipher_text using a private key (AES-CBC ECIES)</li>\n<li>Verifies the signature</li>\n<li>Decodes the payload in the Access Token JWT to obtain claims and identify the endpoints accessible for the access token</li>\n</ol>\n<p>Note: Cipher text format - &#x3C;iv>&#x3C;raw ephemeral public key>&#x3C;encrypted data>.</p>\n<h3 id=\"Exchange-personal-data-between-DS-and-DS-with-known-individual-identity\">Exchange personal data between DS and DS with known individual identity</h3>\n<p>The DS and DUS require individual identity proof before the data is exchanged. This is the case, for e.g. during a registration process, check-ins, covid-credential exchange etc.</p>\n<p><img src=\"../images/exchange-with-identification.png\" alt=\"\"></p>\n<p>The Individual in the above flow diagram maintains two identities. They are:</p>\n<ol>\n<li>Identity_DS - Identity of Individual at DS</li>\n<li>Identity_DUS - Identity of Individual at DUS</li>\n</ol>\n<h4 id=\"DA-Negotiation-between-DS-and-Individual\">DA Negotiation between DS and Individual</h4>\n<p>The DS and Individual agree on the terms of data usage in conformance to <a href=\"https://github.com/decentralised-dataexchange/automated-data-agreements/blob/main/docs/didcomm-protocol-spec.md#40ada-rfc-0003-data-agreement-negotiation-protocol-10\">ADA RFC 0003</a>.</p>\n<h4 id=\"DDelegated-DA-Negotiation-between-DUS-and-Individual\">DDelegated DA Negotiation between DUS and Individual</h4>\n<h5 id=\"Messages-3\">Messages</h5>\n<p>The <code>/delegated-da-negotiation/1.0</code> protocol consists of these messages:</p>\n<ol>\n<li><code>/delegated-da-negotiation/1.0/initiate</code></li>\n<li><code>/delegated-da-negotiation/1.0/connection-invitation</code></li>\n<li><code>/delegated-da-negotiation/1.0/offer</code></li>\n<li><code>/delegated-da-negotiation/1.0/accept</code></li>\n<li><code>/delegated-da-negotiation/1.0/reject</code></li>\n<li><code>/delegated-da-negotiation/1.0/forward</code></li>\n</ol>\n<h5 id=\"DUS-requests-DS-to-collect-sign-off-for-DA-DUS-from-Identity_DS\">DUS requests DS to collect sign-off for DA (DUS) from Identity_DS</h5>\n<p>An example is as provided below:</p>\n<pre><code class=\"language-json\">{\n  \"type\": \"https://didcomm.org/delegated-da-negotiation/1.0/initiate\",\n  \"id\": \"999f6c2b-b0e5-4123-aab0-b5f7bfc780c4\",\n  \"created_time\": \"1639288911\",\n  \"from\": \"&#x3C;sender did>\",\n  \"to\": \"&#x3C;receipient did>\",\n  \"body\": {\n    \"da\": {}\n  }\n}\n</code></pre>\n<h5 id=\"DS-responds-with-connection-invitation-for-the-individual\">DS responds with connection-invitation for the individual.</h5>\n<p>An example is provided below.</p>\n<pre><code class=\"language-json\">{\n  \"type\": \"https://didcomm.org/delegated-da-negotiation/1.0/initiate\",\n  \"id\": \"1b8381a8-5b7a-44b0-a6b6-037a4aac5609\",\n  \"~thread\": {\n    \"thid\": \"999f6c2b-b0e5-4123-aab0-b5f7bfc780c4\"\n  },\n  \"created_time\": \"1639288911\",\n  \"from\": \"&#x3C;sender did>\",\n  \"to\": \"&#x3C;receipient did>\",\n  \"body\": {\n    \"invitation\": {\n      \"serviceEndpoint\": \"https://didcomm.data-source.com/\",\n      \"routingKeys\": [],\n      \"recipientKeys\": [\n        \"kHJvUaokuKfz4sELM6qCSELiHxBNikjcMnvjo3Kjq8L\"\n      ],\n      \"@id\": \"cf4bbbab-a60a-472c-9d9f-66852b20f6cb\",\n      \"@type\": \"did:sov:BzCbsNYhMrjHiqZDTUASHg;spec/connections/1.0/invitation\"\n    }\n  }\n}\n</code></pre>\n<h5 id=\"Individual-establishes-connection-with-DS\">Individual establishes connection with DS</h5>\n<p>The DUS presents the connection-invitation received from DS to Individual as QR code (or other means). The Individual establishes a connection with the DS. [1]</p>\n<h5 id=\"DS-identifies-Individual-as-Identity_DS\">DS identifies Individual as Identity_DS</h5>\n<p>The DS identifies the Individual by requesting proof presentation for Verifiable Credential [2] that was issued when Individual onboarded to DS.</p>\n<h5 id=\"DS-offers-DA-to-Individual-on-behalf-of--DUS\">DS offers DA to Individual on behalf of  DUS</h5>\n<p>The DS checks if a DA (purpose: 3rd party disclosure) exists between the DS and Individual. If such exists, the DS adds the offer_endorsed event to the DA and signs it. The signed DUS DA is offered to the Individual. An example is as provided below:</p>\n<pre><code class=\"language-json\">{\n  \"type\": \"delegated-da-negotiation/1.0/offer\",\n  \"id\": \"999f6c2b-b0e5-4123-aab0-b5f7bfc780c4\",\n  \"created_time\": \"1639288911\",\n  \"from\": \"&#x3C;sender did>\",\n  \"to\": \"&#x3C;receipient did>\",\n  \"body\": {\n    \"da\": {}\n  }\n}\n</code></pre>\n<h5 id=\"Individual-accepts-the-DA\">Individual accepts the DA</h5>\n<p>Individual constructs the DIDComm message in accordance to <a href=\"https://github.com/decentralised-dataexchange/automated-data-agreements/blob/main/docs/didcomm-protocol-spec.md#4222accept\">ADA RFC 0003</a>.</p>\n<h5 id=\"Individual-rejects-the-DA\">Individual rejects the DA</h5>\n<p>Individual constructs the DIDComm message in accordance to <a href=\"https://github.com/decentralised-dataexchange/automated-data-agreements/blob/main/docs/didcomm-protocol-spec.md#4223reject\">ADA RFC 0003</a>. The individual constructs a forward message with the DUS as the recipient and sends it to the DS. The DS will forward the same to the DUS.</p>\n<h5 id=\"DS-forwards-the-response-from-Individual-to-DUS\">DS forwards the response from Individual to DUS</h5>\n<p>DUS process the <code>/forward</code> message from received DS in accordance to <a href=\"https://github.com/hyperledger/aries-rfcs/blob/main/concepts/0094-cross-domain-messaging/README.md\">Aries RFC 0094</a></p>\n<h4 id=\"Release-personal-data-1\">Release personal data</h4>\n<h5 id=\"Messages-4\">Messages</h5>\n<p>The <code>/data-exchange/1.0</code> protocol consists of these messages:</p>\n<ol>\n<li><code>/data-exchange/1.0/request-access</code></li>\n<li><code>/data-exchange/1.0/grant-access</code></li>\n</ol>\n<h5 id=\"DUS-requests-access-to-personal-data\">DUS requests access to personal data</h5>\n<p>The DUS requests access to personal data by presenting the hash of a signed DUS DA document to the DS. An example is provided below:</p>\n<pre><code class=\"language-json\">{\n  \"type\": \"https://didcomm.org/dda-negotiation/data-exchange/1.0/request-access\",\n  \"id\": \"1b8381a8-5b7a-44b0-a6b6-037a4aac5609\",\n  \"created_time\": \"1639288911\",\n  \"from\": \"&#x3C;sender did>\",\n  \"to\": \"&#x3C;receipient did>\"\n  \"body\": {\n    \"da_hash\": \"\"\n    \"nonce\": \"\"\n  }\n}\n</code></pre>\n<h5 id=\"DS-grant-access-to-personal-data-1\">DS grant access to personal data</h5>\n<p>The DS validates (for e.g., check expiry, check revocation list) and authenticates the DUS DA and releases an \"access_token\" to the protected resources.</p>\n<p>An Access Token is constructed according to <a href=\"https://datatracker.ietf.org/doc/html/rfc7519\">JWT IETF 7519</a>. The Access Token claim set contains necessary claims for access to the protected resource. The following are mandatory claims.</p>\n<ul>\n<li>dda: Hash of the signed dda.</li>\n<li>da: Hash of the signed da</li>\n<li>resource_endpoints: Array of protected resource endpoints which accepts the Access Token.</li>\n<li>iss (issuer): Issuer of the JWT</li>\n<li>sub (subject): Subject of the JWT (the user)</li>\n<li>aud (audience): Recipient for which the JWT is intended</li>\n<li>exp (expiration time): Time after which the JWT expires</li>\n<li>nbf (not before time): Time before which the JWT must not be accepted for processing</li>\n<li>iat (issued at time): Time at which the JWT was issued; can be used to determine age of the JWT</li>\n<li>jti (JWT ID): Unique identifier; can be used to prevent the JWT from being replayed (allows a token to be used only once)</li>\n</ul>\n<p>To ensure secure Access Token issuance, we implement an Authenticated Key Exchange (AKE) cryptographic protocol. The AKE provides additional security against potential attacks (MITM, replay attacks, etc.).</p>\n<p>An AKE1 variant, as described in chapters 21.1-21.2 (<a href=\"https://toc.cryptobook.us/book.pdf\">https://toc.cryptobook.us/book.pdf</a>) is implemented.</p>\n<p>The AKE is a non-interactive protocol. The steps are provided below.</p>\n<ol>\n<li>Encrypt the Access Token using the secp256k1 public key associated with DUS to obtain the cipher text. (AES-CBC ECIES)</li>\n<li>Generate a signature for the cipher text.</li>\n</ol>\n<p>The DS publishes the access token to Ethereum by executing the <code>publishAccessToken</code> smart contract function. This function accepts three parameters:</p>\n<ul>\n<li>cipher_text</li>\n<li>sig</li>\n<li>nonce</li>\n</ul>\n<p>The DS constructs <code>/data-exchange/1.0/grant-access</code> a DIDComm message with the Ethereum transaction hash in the body and responds to the DUS. An example is provided below:</p>\n<pre><code class=\"language-json\">{\n  \"type\": \"https://didcomm.org/dda-negotiation/data-exchange/1.0/grant-access\",\n  \"id\": \"999f6c2b-b0e5-4123-aab0-b5f7bfc780c4\",\n  \"~thread\": {\n        \"thid\": \"1b8381a8-5b7a-44b0-a6b6-037a4aac5609\"\n    },\n  \"created_time\": \"1639288911\",\n  \"from\": \"&#x3C;sender did>\",\n  \"to\": \"&#x3C;receipient did>\"\n  \"body\": {\n    \"txn_hash\": \"0xeba2df809e7a612a0a0d444ccfa5c839624bdc00dd29e3340d46df3870f8a30e\"\n  }\n}\n</code></pre>\n<h5 id=\"DUS-obtains-the-access-token-1\">DUS obtains the access token</h5>\n<p>The DUS resolves the transaction to obtain the cipher_text, sig and nonce, then proceeds to perform the following steps.</p>\n<ol>\n<li>Decrypts the cipher_text using a private key. (AES-CBC ECIES)</li>\n<li>Verifies the signature.</li>\n<li>Decodes the payload in Access Token JWT to obtain claims and identify the endpoints accessible for the access token.</li>\n</ol>\n<p>Note: Cipher text format - <code>&#x26;lt;iv>&#x26;lt;raw ephemeral public key>&#x26;lt;encrypted data></code></p>\n<h3 id=\"Smart-Contracts\">Smart Contracts</h3>\n<p>Following are the smart contracts that will be used in the protocol:</p>\n<ul>\n<li><a href=\"https://github.com/uport-project/ethr-did-registry/blob/develop/contracts/EthereumDIDRegistry.sol\">Ethereum DID Registry smart contract for did:ethr identifiers</a></li>\n<li>DDA Marketplace smart contract\n<ul>\n<li><code>publishDDACID(CID)</code></li>\n<li><code>publishAccessToken(cipher_text, sig, nonce)</code></li>\n</ul>\n</li>\n</ul>\n<h2 id=\"Implementation-Considerations\">Implementation Considerations</h2>\n<p>Successful execution of protocols described in this document might involve invoking sub-protocols; a coroutine approach can simplify this, where it is possible to compose multiple protocols to achieve a complex goal. For e.g. during the exchange of personal data with the identification of individuals, it is necessary for the DS to invoke a \"Connections'' protocol and then a \"Verifications\" protocol, e.t.c, after which the DS gets back to the DUS with a positive or negative response. All this while the DUS can check the status of an active protocol with the DS. This approach is being discussed in detail at <a href=\"https://github.com/hyperledger/aries-rfcs/tree/main/concepts/0478-coprotocols\">Aries RFC 0478</a>.</p>\n<h2 id=\"References\">References</h2>\n<ol>\n<li>Aries RFC 0160 Connection protocol - <a href=\"https://github.com/hyperledger/aries-rfcs/tree/main/features/0160-connection-protocol\">https://github.com/hyperledger/aries-rfcs/tree/main/features/0160-connection-protocol</a></li>\n<li>Aries RFC 0037 Present Proof protocol - <a href=\"https://github.com/hyperledger/aries-rfcs/tree/main/features/0037-present-proof\">https://github.com/hyperledger/aries-rfcs/tree/main/features/0037-present-proof</a></li>\n<li>W3C Data Integrity 1.0 specification - <a href=\"https://w3c-ccg.github.io/data-integrity-spec\">https://w3c-ccg.github.io/data-integrity-spec</a></li>\n<li><a href=\"https://ethereum.org/en/developers/docs/smart-contracts/anatomy/#events-and-logs\">https://ethereum.org/en/developers/docs/smart-contracts/anatomy/#events-and-logs</a></li>\n</ol>\n<h2 id=\"Appendix-A\">Appendix A</h2>\n<h3 id=\"A1-Abbreviations\">A.1\tAbbreviations</h3>\n<table>\n  <tr>\n   <td><strong>Abbr.</strong>\n   </td>\n   <td><strong>Description</strong>\n   </td>\n  </tr>\n  <tr>\n   <td>ADA\n   </td>\n   <td>Automated Data Agreements\n   </td>\n  </tr>\n  <tr>\n   <td>CRUD\n   </td>\n   <td>Create / Read / Update / Delete\n   </td>\n  </tr>\n  <tr>\n   <td>DA\n   </td>\n   <td>Data Agreement \n   </td>\n  </tr>\n  <tr>\n   <td>DAO\n   </td>\n   <td>Decentralized Autonomous Organizations\n   </td>\n  </tr>\n  <tr>\n   <td>DDA\n   </td>\n   <td>Data Disclosure Agreement (Introduced first in this specification)\n   </td>\n  </tr>\n  <tr>\n   <td>DEXA\n   </td>\n   <td>Data Exchange Agreements\n   </td>\n  </tr>\n  <tr>\n   <td>DID\n   </td>\n   <td>Decentralised Identifier (according to W3C)\n   </td>\n  </tr>\n  <tr>\n   <td>DPA\n   </td>\n   <td>Data Processing Agreement\n   </td>\n  </tr>\n  <tr>\n   <td>DPIA\n   </td>\n   <td>Data Protection Impact Assessment\n   </td>\n  </tr>\n  <tr>\n   <td>DS\n   </td>\n   <td>Data Source\n   </td>\n  </tr>\n  <tr>\n   <td>DUS\n   </td>\n   <td>Data Using Service\n   </td>\n  </tr>\n  <tr>\n   <td>EEA\n   </td>\n   <td>European Economic Area\n   </td>\n  </tr>\n  <tr>\n   <td>EU\n   </td>\n   <td>European Union\n   </td>\n  </tr>\n  <tr>\n   <td>GDPR\n   </td>\n   <td>General Data Protection Regulation\n   </td>\n  </tr>\n  <tr>\n   <td>IPFS\n   </td>\n   <td>Inter Planetary File System\n   </td>\n  </tr>\n  <tr>\n   <td>ISO\n   </td>\n   <td>International Organization for Standardization\n   </td>\n  </tr>\n  <tr>\n   <td>JSON\n   </td>\n   <td>JavaScript Object Notation\n   </td>\n  </tr>\n  <tr>\n   <td>SDK\n   </td>\n   <td>Software Development Kit\n   </td>\n  </tr>\n  <tr>\n   <td>SSI\n   </td>\n   <td>Self Sovereign Identity\n   </td>\n  </tr>\n  <tr>\n   <td>ToIP\n   </td>\n   <td>Trust over Internet Protocol\n   </td>\n  </tr>\n  <tr>\n   <td>VC\n   </td>\n   <td>Verifiable credentials\n   </td>\n  </tr>\n  <tr>\n   <td>W3C\n   </td>\n   <td>World wide web consortium\n   </td>\n  </tr>\n</table>\n<h3 id=\"A2-Terminology\">A.2\tTerminology</h3>\n<table>\n  <tr>\n   <td><strong>Term</strong>\n   </td>\n   <td><strong>Description</strong>\n   </td>\n  </tr>\n  <tr>\n   <td>Data Agreement (DA)\n   </td>\n   <td>A data agreement exists between organisations and individuals in the use of personal data. This agreement can have any legal basis outlined according to any data protection regulation, such as the GDPR.\n   </td>\n  </tr>\n  <tr>\n   <td>Data Disclosure Agreement (DDA)\n   </td>\n   <td>Data disclosure agreements are formal contracts that detail what data is being shared and the appropriate use for the data between a DS and a DUS. It records conditions on which a DUS will consume data from a DS. A DDA could contain both personal and non-personal data.\n   </td>\n  </tr>\n  <tr>\n   <td>Decentralised IDentifier (DID)\n   </td>\n   <td>A DID is a new type of identifier that is globally unique, resolvable with high availability, and cryptographically verifiable. DIDs are typically associated with cryptographic material, such as public keys and service endpoints, for establishing secure communication channels.\n   </td>\n  </tr>\n  <tr>\n   <td>Data Processing Agreement\n   </td>\n   <td>A Data Processing Agreement is a legally binding contract, either in written or electronic form, entered between a data processor and a data controller that states the rights and obligations of each party concerning the protection of personal data. The agreement will be legally binding in any data protection regulation, such as the GDPR.\n   </td>\n  </tr>\n  <tr>\n   <td>Data Source (DS)\n   </td>\n   <td>The role responsible for collecting, storing, and controlling personal data that persons, operators, and DUSs may wish to access and use; is defined as per MyData.\n   </td>\n  </tr>\n  <tr>\n   <td>Data Using Service (DUS)\n   </td>\n   <td>The role responsible for processing personal data from one or more data sources to deliver a service; is defined as per MyData\n   </td>\n  </tr>\n  <tr>\n   <td>Data Protection Impact Assessment (DPIA).\n   </td>\n   <td>A Data Protection Impact Assessment is a process designed to help systematically analyse, identify and minimise the data protection risks of a project or plan.\n   </td>\n  </tr>\n  <tr>\n   <td>Individual\n   </td>\n   <td>A natural, living human being, in the GDPR, also referred to as a data subject\n   </td>\n  </tr>\n  <tr>\n   <td>Inter Planetary File System (IPFS\n   </td>\n   <td>The InterPlanetary File System (IPFS) is a protocol and peer-to-peer network for storing and sharing data in a distributed file system. IPFS uses content-addressing to uniquely identify each file in a global namespace connecting all computing devices\n   </td>\n  </tr>\n  <tr>\n   <td>Self Sovereign Identity\n   </td>\n   <td>A model for managing digital identities where individual identity holders can create and control their verifiable credentials without being forced to request permission from an intermediary or centralised authority and give control over how their data is shared and used\n   </td>\n  </tr>\n</table>","frontmatter":{"title":"Data Disclosure Agreement","tags":[],"license":"MIT","publisher":"rodolfomiranda","status":"Production","piuri":"https://didcomm.org/data-disclosure-agreement/1.0","summary":"A Data Disclosure Agreement (DDA) enables automated agreement handling for data exchange between a Data Source (DS) and Data Using Service (DUS).","authors":[{"name":"Mr. George Padayatti (iGrant.io, Sweden)","email":null},{"name":"Mr. Lal Chandran (iGrant.io, Sweden)","email":null}]},"fields":{"modifiedDate":"Mon Mar 17 2025 19:26:22 GMT+0000 (Coordinated Universal Time)","avatar":"https://avatars.githubusercontent.com/u/2913773?v=4&s=48","version":"1.0"}}},"pageContext":{"matchPath":"data-disclosure-agreement/1.0/*","id":"5f172b60-19ce-5260-ab2c-6f4a230c3bbd","html":"<h1 id=\"Data-Disclosure-Agreement-Protocol-Specification\">Data Disclosure Agreement Protocol Specification</h1>\n<p><strong>Specification Status:</strong> version 1.0.0 (Ready for impplementation)\nThis is reviewed and implementation has started. This spec is live and is being iterated as part of the PS-SDA project in NGI-ONTOCHAIN. The project has received funding from the European Union’s Horizon 2020 research and innovation programme under grant agreement No 957338.</p>\n<p><strong>Latest Draft:</strong> <a href=\"https://dda.igrant.io\">Avaialble here</a></p>\n<p><strong>Editors:</strong>\nMr. George Padayatti (iGrant.io, Sweden)<br />\nMr. Lal Chandran (iGrant.io, Sweden)</p>\n<p><strong>Contributors and Reviwers:</strong>\nMs. Lotta Lundin (iGrant.io, Sweden)\nDr. David Goodman (iGrant.io, Sweden)<br />\nMr. Jan Linquist (Linaltec, Sweden)</p>\n<p><strong>Participate</strong></p>\n<ul>\n<li><a href=\"https://github.com/decentralised-dataexchange/data-exchange-agreements\">GitHub repo</a></li>\n<li><a href=\"https://github.com/decentralised-dataexchange/data-exchange-agreements/issues\">File a bug</a></li>\n<li><a href=\"https://github.com/decentralised-dataexchange/data-exchange-agreements/commits/main\">Commit history</a></li>\n</ul>\n<hr />\n<h2 id=\"Abstract\">Abstract</h2>\n<p>A Data Disclosure Agreement (DDA) enables automated agreement handling for data exchange between a Data Source (DS) and Data Using Service (DUS). It helps organisations to continue leveraging their data assets while being transparent and legitimate in their data usage. Automated agreement handling is a requisite for a scalable and regulatory-compliant data marketplace.. It also provides individuals control over how their data is used and exchanged.</p>\n<h2 id=\"Protocol-flow\">Protocol flow</h2>\n<h3 id=\"Actors\">Actors</h3>\n<ol>\n<li>Data Using Service (DUS)</li>\n<li>Data Source (DS)</li>\n<li>Individual</li>\n<li>Data Intermediary</li>\n</ol>\n<h3 id=\"Pre-requisite\">Pre-requisite</h3>\n<p>The prerequisites are:</p>\n<ol>\n<li>\n<p>All the actors involved in the protocol flow are DIDComm agents. Each interaction between the actors requires a DIDComm message.</p>\n</li>\n<li>\n<p>Prior to the PS-SDA protocol flow, actors must establish connections [1] between each other and identify themselves by presenting the necessary proofs [2].</p>\n</li>\n<li>\n<p>All the actors will have a wallet (mobile or cloud-based, individual and potentially for an enterprise) address and an associated public / private key pair.</p>\n</li>\n<li>\n<p>A wallet address is an externally owned account (EOA) address. Ethereum addresses are composed of the prefix \"0x\" (hexadecimal) concatenated with the rightmost 20 bytes of the Keccak-256 hash of the ECDSA public key with the curve secp256k1.</p>\n</li>\n</ol>\n<h3 id=\"Out-of-scope\">Out of scope</h3>\n<p>The administrative and governance frameworks of the “marketplace” or “data space” is out of scope. The marketplace has performed the proof of business and onboarded DS and DUS.</p>\n<h3 id=\"Publish-DDA-offer-to-Marketplace-DS\">Publish DDA offer to Marketplace (DS)</h3>\n<p><img src=\"../images/publish-dda-to-marketplace.png\" alt /></p>\n<h4 id=\"Messages\">Messages</h4>\n<p>The <code>/dda-marketplace/1.0</code> protocol consists of these messages:</p>\n<ol>\n<li><code>/dda-marketplace/1.0/publish-request</code></li>\n<li><code>/dda-marketplace/1.0/publish-response</code></li>\n</ol>\n<h4 id=\"Sign-the-DDA-offer\">Sign the DDA offer</h4>\n<p>The DS signs the DDA offer using the secp256k1 private key. The signature is prepared by performing the proof algorithm described by W3C Data Integrity 1.0 specification [3].</p>\n<h4 id=\"Send-signed-DDA-offer-to-Data-Intermediary\">Send signed DDA offer to Data Intermediary</h4>\n<p>The DS construct a DIDComm message of type <code>/dda-marketplace/1.0/publish-request</code> and sends it to the Data Intermediary DIDComm agent. An example is provided below.</p>\n<pre><code class=\"language-json\">{\n  \"type\": \"https://didcomm.org/dda/1.0/publish-request\",\n  \"id\": \"999f6c2b-b0e5-4123-aab0-b5f7bfc780c4\",\n  \"created_time\": \"1639288911\",\n  \"from\": \"&lt;sender did&gt;\",\n  \"to\": \"&lt;receipient did&gt;\",\n  \"body\": {\n    \"data_disclosure_agreement\": {}\n  }\n}\n</code></pre>\n<h4 id=\"Data-Intermediary-stores-the-signed-DDA-offer-to-CAS\">Data Intermediary stores the signed DDA offer to CAS</h4>\n<p>Once the DDA is received from the DS, the Data Intermediary stores the offer in Content Addressable Storage (CAS) for e.g. IPFS and obtains the Content Identifier (CID).</p>\n<h4 id=\"Data-Intermediary-anchors-CID-to-Ethereum\">Data Intermediary anchors CID to Ethereum</h4>\n<p>The Content Identifier (CID) pointing to a specific DDA offer is anchored to Ethereum by executing the <code>publishDDACID</code> smart contract function.</p>\n<p>The Data Intermediary create a /dda-marketplace/1.0/publish-response DIDComm message and sends it to the DS. This message contains Ethereum transaction hash for the DS to verify the transaction. An example is provided below:</p>\n<pre><code class=\"language-json\">{\n  \"type\": \"https://didcomm.org/dda/1.0/publish-response\",\n  \"id\": \"53f19e0b-5be2-480a-92bc-fcdeabf69ad3\",\n  \"~thread\": {\n        \"thid\": \"999f6c2b-b0e5-4123-aab0-b5f7bfc780c4\"\n    },\n  \"created_time\": \"1639288911\",\n  \"from\": \"&lt;sender did&gt;\",\n  \"to\": \"&lt;receipient did&gt;\",\n  \"body\": {\n    \"txn_hash\": \"0xeba2df809e7a612a0a0d444ccfa5c839624bdc00dd29e3340d46df3870f8a30e\"\n  }\n}\n</code></pre>\n<h4 id=\"Data-intermediary-publishes-the-DDA-offer-to-a-data-marketplace\">Data intermediary publishes the DDA offer to a data marketplace</h4>\n<p>The data marketplace will subscribe to the smart contract events specific to <code>publishDDACID</code> function and list the DDA in the marketplace. [4]</p>\n<h3 id=\"Negotiate-DDA\">Negotiate DDA</h3>\n<p>The DIDComm protocol is used to facilitate interaction between DS and DUS to negotiate terms for the DDA.</p>\n<p><img src=\"../images/negotiate-dda.png\" alt /></p>\n<h4 id=\"Messages-1\">Messages</h4>\n<p>The <code>/dda-negotiation/1.0</code> protocol consists of these messages:</p>\n<ol>\n<li><code>/dda-negotiation/1.0/propose-terms</code></li>\n<li><code>/dda-negotiation/1.0/accept-terms</code></li>\n<li><code>/dda-negotiation/1.0/reject-terms</code></li>\n<li><code>/dda-negotiation/1.0/accept-dda</code></li>\n</ol>\n<h4 id=\"DUS-proposes-terms-for-DDA-Counter-offer\">DUS proposes terms for DDA (Counter offer)</h4>\n<p>Resolve CID to obtain a DDA offer from IPFS and then construct a counter proposal if the \"terms\" are not satisfactory. An example is as provided below:</p>\n<pre><code class=\"language-json\">{\n  \"type\": \"https://didcomm.org/dda-negotiation/1.0/propose-terms\",\n  \"id\": \"999f6c2b-b0e5-4123-aab0-b5f7bfc780c4\",\n  \"created_time\": \"1639288911\",\n  \"from\": \"&lt;sender did&gt;\",\n  \"to\": \"&lt;receipient did&gt;\",\n  \"body\": {\n    \"data_disclosure_agreement\": {}\n  }\n}\n</code></pre>\n<h4 id=\"DS-accepts-the-proposed-terms\">DS accepts the proposed terms</h4>\n<p>The DS updates the DDA to include the proposed terms and signs it. A copy of the same is sent to the DUS for counter-signing. An example is as provided below:</p>\n<pre><code class=\"language-json\">{\n  \"type\": \"https://didcomm.org/dda-negotiation/dda-negotiation/1.0/accept-terms\",\n  \"id\": \"53f19e0b-5be2-480a-92bc-fcdeabf69ad3\",\n  \"~thread\": {\n        \"thid\": \"999f6c2b-b0e5-4123-aab0-b5f7bfc780c4\"\n    },\n  \"created_time\": \"1639288911\",\n  \"from\": \"&lt;sender did&gt;\",\n  \"to\": \"&lt;receipient did&gt;\",\n  \"body\": {\n    \"data_disclosure_agreement\": {}\n  }\n}\n</code></pre>\n<h4 id=\"DS-rejects-the-proposed-terms\">DS rejects the proposed terms</h4>\n<p>An example is provided below.</p>\n<pre><code class=\"language-json\">{\n  \"type\": \"https://didcomm.org/dda-negotiation/dda-negotiation/1.0/reject-terms\",\n  \"id\": \"53f19e0b-5be2-480a-92bc-fcdeabf69ad3\",\n  \"~thread\": {\n        \"thid\": \"999f6c2b-b0e5-4123-aab0-b5f7bfc780c4\"\n    },\n  \"created_time\": \"1639288911\",\n  \"from\": \"&lt;sender did&gt;\",\n  \"to\": \"&lt;receipient did&gt;\"\n}\n</code></pre>\n<h4 id=\"DUS-accepts-the-DDA\">DUS accepts the DDA</h4>\n<p>The DUS counter signs the DDA and sends a copy to the DS. An example is as provided below:</p>\n<pre><code class=\"language-json\">{\n  \"type\": \"https://didcomm.org/dda-negotiation/dda-negotiation/1.0/accept-dda\",\n  \"id\": \"1b8381a8-5b7a-44b0-a6b6-037a4aac5609\",\n  \"created_time\": \"1639288911\",\n  \"from\": \"&lt;sender did&gt;\",\n  \"to\": \"&lt;receipient did&gt;\"\n  \"body\": {\n    \"data_disclosure_agreement\": {}\n  }\n}\n</code></pre>\n<h3 id=\"Exchange-personal-data-between-DS-and-DS-with-unknown-individual-identity-Eg-Anonymised-data-exchange\">Exchange personal data between DS and DS with unknown individual identity (E.g. Anonymised data exchange)</h3>\n<p>In this mode of personal data exchange, DS and DUS do not need individual identity proof before the data is exchanged e.g. in the case of a DUS using anonymous or pseudonymous data sharing to offer personalised services,</p>\n<p><img src=\"../images/exchange-without-identification.png\" alt /></p>\n<h4 id=\"DA-Negotiation\">DA Negotiation</h4>\n<p>DS and Individual agree on the terms of data usage in conformance to <a href=\"https://github.com/decentralised-dataexchange/automated-data-agreements/blob/main/docs/didcomm-protocol-spec.md#40ada-rfc-0003-data-agreement-negotiation-protocol-10\">ADA RFC 0003</a>.</p>\n<h4 id=\"Release-personal-data\">Release personal data</h4>\n<h5 id=\"Messages-2\">Messages</h5>\n<p>The <code>/data-exchange/1.0</code> protocol consists of these messages:</p>\n<ol>\n<li><code>/data-exchange/1.0/request-access</code></li>\n<li><code>/data-exchange/1.0/grant-access</code></li>\n</ol>\n<h5 id=\"DUS-request-access-to-personal-data\">DUS request access to personal data</h5>\n<p>The DUS requests access to personal data by presenting the hash of a signed DDA document to the DS. An example is provided below:</p>\n<pre><code class=\"language-json\">{\n  \"type\": \"https://didcomm.org/dda-negotiation/data-exchange/1.0/request-access\",\n  \"id\": \"1b8381a8-5b7a-44b0-a6b6-037a4aac5609\",\n  \"created_time\": \"1639288911\",\n  \"from\": \"&lt;sender did&gt;\",\n  \"to\": \"&lt;receipient did&gt;\"\n  \"body\": {\n    \"dda_hash\": \"\"\n    \"nonce\": \"\"\n  }\n}\n</code></pre>\n<h5 id=\"DS-grant-access-to-personal-data\">DS grant access to personal data</h5>\n<p>The DS validates (checks for e.g. expiry, revocation list etc.), authenticates the DDA and releases an \"access_token\" to the protected resources.</p>\n<p>The Access Token is constructed according to <a href=\"https://datatracker.ietf.org/doc/html/rfc7519\">JWT IETF 7519</a>. The Access Token claim set contains necessary claims for access to the protected resource. Following are the mandatory claims.</p>\n<ul>\n<li>dda: Hash of the signed DDA.</li>\n<li>resource_endpoints: Array of protected resource endpoints which accept the Access Token.</li>\n<li>iss (issuer): Issuer of the JWT</li>\n<li>sub (subject): Subject of the JWT (the user)</li>\n<li>aud (audience): Recipient for which the JWT is intended</li>\n<li>exp (expiration time): Time after which the JWT expires</li>\n<li>nbf (not before time): Time before which the JWT must not be accepted for processing</li>\n<li>iat (issued at the time): Time at which the JWT was issued; can be used to determine the age of the JWT</li>\n<li>jti (JWT ID): Unique identifier; can be used to prevent the JWT from being replayed (allows a token to be used only once)</li>\n</ul>\n<p>To ensure secure Access Token issuance, we implement an Authenticated Key Exchange (AKE) cryptographic protocol. The AKE provides additional security against potential attacks (MITM, replay attacks, etc.).</p>\n<p>The AKE1 variant, as described in chapters 21.1-21.2 (<a href=\"https://toc.cryptobook.us/book.pdf\">https://toc.cryptobook.us/book.pdf</a>) is implemented.</p>\n<p>The AKE is a non-interactive protocol. The steps are provided below.</p>\n<ol>\n<li>\n<p>Encrypt the Access Token using the secp256k1 public key associated with the DUS to obtain the cipher text. (AES-CBC ECIES)</p>\n</li>\n<li>\n<p>Generate a signature for the cipher text.</p>\n</li>\n</ol>\n<p>The DS publishes the access token to Ethereum by executing the <code>publishAccessToken</code> smart contract function. This function accepts three parameters:</p>\n<ul>\n<li>cipher_text</li>\n<li>sig</li>\n<li>nonce</li>\n</ul>\n<p>The DS constructs a /data-exchange/1.0/grant-access DIDComm message with an Ethereum transaction hash in the body and responds to the DUS. An example is provided below:</p>\n<pre><code class=\"language-json\">{\n  \"type\": \"https://didcomm.org/dda-negotiation/data-exchange/1.0/grant-access\",\n  \"id\": \"999f6c2b-b0e5-4123-aab0-b5f7bfc780c4\",\n  \"~thread\": {\n        \"thid\": \"1b8381a8-5b7a-44b0-a6b6-037a4aac5609\"\n    },\n  \"created_time\": \"1639288911\",\n  \"from\": \"&lt;sender did&gt;\",\n  \"to\": \"&lt;receipient did&gt;\"\n  \"body\": {\n    \"txn_hash\": \"0xeba2df809e7a612a0a0d444ccfa5c839624bdc00dd29e3340d46df3870f8a30e\"\n  }\n}\n</code></pre>\n<h5 id=\"DUS-obtains-the-access-token\">DUS obtains the access token</h5>\n<p>The DUS resolves the transaction to obtain the cipher_text, sig and nonce, then proceeds to perform the following steps:</p>\n<ol>\n<li>Decrypts the cipher_text using a private key (AES-CBC ECIES)</li>\n<li>Verifies the signature</li>\n<li>Decodes the payload in the Access Token JWT to obtain claims and identify the endpoints accessible for the access token</li>\n</ol>\n<p>Note: Cipher text format - &lt;iv&gt;&lt;raw ephemeral public key&gt;&lt;encrypted data&gt;.</p>\n<h3 id=\"Exchange-personal-data-between-DS-and-DS-with-known-individual-identity\">Exchange personal data between DS and DS with known individual identity</h3>\n<p>The DS and DUS require individual identity proof before the data is exchanged. This is the case, for e.g. during a registration process, check-ins, covid-credential exchange etc.</p>\n<p><img src=\"../images/exchange-with-identification.png\" alt /></p>\n<p>The Individual in the above flow diagram maintains two identities. They are:</p>\n<ol>\n<li>Identity_DS - Identity of Individual at DS</li>\n<li>Identity_DUS - Identity of Individual at DUS</li>\n</ol>\n<h4 id=\"DA-Negotiation-between-DS-and-Individual\">DA Negotiation between DS and Individual</h4>\n<p>The DS and Individual agree on the terms of data usage in conformance to <a href=\"https://github.com/decentralised-dataexchange/automated-data-agreements/blob/main/docs/didcomm-protocol-spec.md#40ada-rfc-0003-data-agreement-negotiation-protocol-10\">ADA RFC 0003</a>.</p>\n<h4 id=\"DDelegated-DA-Negotiation-between-DUS-and-Individual\">DDelegated DA Negotiation between DUS and Individual</h4>\n<h5 id=\"Messages-3\">Messages</h5>\n<p>The <code>/delegated-da-negotiation/1.0</code> protocol consists of these messages:</p>\n<ol>\n<li><code>/delegated-da-negotiation/1.0/initiate</code></li>\n<li><code>/delegated-da-negotiation/1.0/connection-invitation</code></li>\n<li><code>/delegated-da-negotiation/1.0/offer</code></li>\n<li><code>/delegated-da-negotiation/1.0/accept</code></li>\n<li><code>/delegated-da-negotiation/1.0/reject</code></li>\n<li><code>/delegated-da-negotiation/1.0/forward</code></li>\n</ol>\n<h5 id=\"DUS-requests-DS-to-collect-sign-off-for-DA-DUS-from-Identity_DS\">DUS requests DS to collect sign-off for DA (DUS) from Identity_DS</h5>\n<p>An example is as provided below:</p>\n<pre><code class=\"language-json\">{\n  \"type\": \"https://didcomm.org/delegated-da-negotiation/1.0/initiate\",\n  \"id\": \"999f6c2b-b0e5-4123-aab0-b5f7bfc780c4\",\n  \"created_time\": \"1639288911\",\n  \"from\": \"&lt;sender did&gt;\",\n  \"to\": \"&lt;receipient did&gt;\",\n  \"body\": {\n    \"da\": {}\n  }\n}\n</code></pre>\n<h5 id=\"DS-responds-with-connection-invitation-for-the-individual\">DS responds with connection-invitation for the individual.</h5>\n<p>An example is provided below.</p>\n<pre><code class=\"language-json\">{\n  \"type\": \"https://didcomm.org/delegated-da-negotiation/1.0/initiate\",\n  \"id\": \"1b8381a8-5b7a-44b0-a6b6-037a4aac5609\",\n  \"~thread\": {\n    \"thid\": \"999f6c2b-b0e5-4123-aab0-b5f7bfc780c4\"\n  },\n  \"created_time\": \"1639288911\",\n  \"from\": \"&lt;sender did&gt;\",\n  \"to\": \"&lt;receipient did&gt;\",\n  \"body\": {\n    \"invitation\": {\n      \"serviceEndpoint\": \"https://didcomm.data-source.com/\",\n      \"routingKeys\": [],\n      \"recipientKeys\": [\n        \"kHJvUaokuKfz4sELM6qCSELiHxBNikjcMnvjo3Kjq8L\"\n      ],\n      \"@id\": \"cf4bbbab-a60a-472c-9d9f-66852b20f6cb\",\n      \"@type\": \"did:sov:BzCbsNYhMrjHiqZDTUASHg;spec/connections/1.0/invitation\"\n    }\n  }\n}\n</code></pre>\n<h5 id=\"Individual-establishes-connection-with-DS\">Individual establishes connection with DS</h5>\n<p>The DUS presents the connection-invitation received from DS to Individual as QR code (or other means). The Individual establishes a connection with the DS. [1]</p>\n<h5 id=\"DS-identifies-Individual-as-Identity_DS\">DS identifies Individual as Identity_DS</h5>\n<p>The DS identifies the Individual by requesting proof presentation for Verifiable Credential [2] that was issued when Individual onboarded to DS.</p>\n<h5 id=\"DS-offers-DA-to-Individual-on-behalf-of--DUS\">DS offers DA to Individual on behalf of  DUS</h5>\n<p>The DS checks if a DA (purpose: 3rd party disclosure) exists between the DS and Individual. If such exists, the DS adds the offer_endorsed event to the DA and signs it. The signed DUS DA is offered to the Individual. An example is as provided below:</p>\n<pre><code class=\"language-json\">{\n  \"type\": \"delegated-da-negotiation/1.0/offer\",\n  \"id\": \"999f6c2b-b0e5-4123-aab0-b5f7bfc780c4\",\n  \"created_time\": \"1639288911\",\n  \"from\": \"&lt;sender did&gt;\",\n  \"to\": \"&lt;receipient did&gt;\",\n  \"body\": {\n    \"da\": {}\n  }\n}\n</code></pre>\n<h5 id=\"Individual-accepts-the-DA\">Individual accepts the DA</h5>\n<p>Individual constructs the DIDComm message in accordance to <a href=\"https://github.com/decentralised-dataexchange/automated-data-agreements/blob/main/docs/didcomm-protocol-spec.md#4222accept\">ADA RFC 0003</a>.</p>\n<h5 id=\"Individual-rejects-the-DA\">Individual rejects the DA</h5>\n<p>Individual constructs the DIDComm message in accordance to <a href=\"https://github.com/decentralised-dataexchange/automated-data-agreements/blob/main/docs/didcomm-protocol-spec.md#4223reject\">ADA RFC 0003</a>. The individual constructs a forward message with the DUS as the recipient and sends it to the DS. The DS will forward the same to the DUS.</p>\n<h5 id=\"DS-forwards-the-response-from-Individual-to-DUS\">DS forwards the response from Individual to DUS</h5>\n<p>DUS process the <code>/forward</code> message from received DS in accordance to <a href=\"https://github.com/hyperledger/aries-rfcs/blob/main/concepts/0094-cross-domain-messaging/README.md\">Aries RFC 0094</a></p>\n<h4 id=\"Release-personal-data-1\">Release personal data</h4>\n<h5 id=\"Messages-4\">Messages</h5>\n<p>The <code>/data-exchange/1.0</code> protocol consists of these messages:</p>\n<ol>\n<li><code>/data-exchange/1.0/request-access</code></li>\n<li><code>/data-exchange/1.0/grant-access</code></li>\n</ol>\n<h5 id=\"DUS-requests-access-to-personal-data\">DUS requests access to personal data</h5>\n<p>The DUS requests access to personal data by presenting the hash of a signed DUS DA document to the DS. An example is provided below:</p>\n<pre><code class=\"language-json\">{\n  \"type\": \"https://didcomm.org/dda-negotiation/data-exchange/1.0/request-access\",\n  \"id\": \"1b8381a8-5b7a-44b0-a6b6-037a4aac5609\",\n  \"created_time\": \"1639288911\",\n  \"from\": \"&lt;sender did&gt;\",\n  \"to\": \"&lt;receipient did&gt;\"\n  \"body\": {\n    \"da_hash\": \"\"\n    \"nonce\": \"\"\n  }\n}\n</code></pre>\n<h5 id=\"DS-grant-access-to-personal-data-1\">DS grant access to personal data</h5>\n<p>The DS validates (for e.g., check expiry, check revocation list) and authenticates the DUS DA and releases an \"access_token\" to the protected resources.</p>\n<p>An Access Token is constructed according to <a href=\"https://datatracker.ietf.org/doc/html/rfc7519\">JWT IETF 7519</a>. The Access Token claim set contains necessary claims for access to the protected resource. The following are mandatory claims.</p>\n<ul>\n<li>dda: Hash of the signed dda.</li>\n<li>da: Hash of the signed da</li>\n<li>resource_endpoints: Array of protected resource endpoints which accepts the Access Token.</li>\n<li>iss (issuer): Issuer of the JWT</li>\n<li>sub (subject): Subject of the JWT (the user)</li>\n<li>aud (audience): Recipient for which the JWT is intended</li>\n<li>exp (expiration time): Time after which the JWT expires</li>\n<li>nbf (not before time): Time before which the JWT must not be accepted for processing</li>\n<li>iat (issued at time): Time at which the JWT was issued; can be used to determine age of the JWT</li>\n<li>jti (JWT ID): Unique identifier; can be used to prevent the JWT from being replayed (allows a token to be used only once)</li>\n</ul>\n<p>To ensure secure Access Token issuance, we implement an Authenticated Key Exchange (AKE) cryptographic protocol. The AKE provides additional security against potential attacks (MITM, replay attacks, etc.).</p>\n<p>An AKE1 variant, as described in chapters 21.1-21.2 (<a href=\"https://toc.cryptobook.us/book.pdf\">https://toc.cryptobook.us/book.pdf</a>) is implemented.</p>\n<p>The AKE is a non-interactive protocol. The steps are provided below.</p>\n<ol>\n<li>Encrypt the Access Token using the secp256k1 public key associated with DUS to obtain the cipher text. (AES-CBC ECIES)</li>\n<li>Generate a signature for the cipher text.</li>\n</ol>\n<p>The DS publishes the access token to Ethereum by executing the <code>publishAccessToken</code> smart contract function. This function accepts three parameters:</p>\n<ul>\n<li>cipher_text</li>\n<li>sig</li>\n<li>nonce</li>\n</ul>\n<p>The DS constructs <code>/data-exchange/1.0/grant-access</code> a DIDComm message with the Ethereum transaction hash in the body and responds to the DUS. An example is provided below:</p>\n<pre><code class=\"language-json\">{\n  \"type\": \"https://didcomm.org/dda-negotiation/data-exchange/1.0/grant-access\",\n  \"id\": \"999f6c2b-b0e5-4123-aab0-b5f7bfc780c4\",\n  \"~thread\": {\n        \"thid\": \"1b8381a8-5b7a-44b0-a6b6-037a4aac5609\"\n    },\n  \"created_time\": \"1639288911\",\n  \"from\": \"&lt;sender did&gt;\",\n  \"to\": \"&lt;receipient did&gt;\"\n  \"body\": {\n    \"txn_hash\": \"0xeba2df809e7a612a0a0d444ccfa5c839624bdc00dd29e3340d46df3870f8a30e\"\n  }\n}\n</code></pre>\n<h5 id=\"DUS-obtains-the-access-token-1\">DUS obtains the access token</h5>\n<p>The DUS resolves the transaction to obtain the cipher_text, sig and nonce, then proceeds to perform the following steps.</p>\n<ol>\n<li>Decrypts the cipher_text using a private key. (AES-CBC ECIES)</li>\n<li>Verifies the signature.</li>\n<li>Decodes the payload in Access Token JWT to obtain claims and identify the endpoints accessible for the access token.</li>\n</ol>\n<p>Note: Cipher text format - <code>&amp;lt;iv&gt;&amp;lt;raw ephemeral public key&gt;&amp;lt;encrypted data&gt;</code></p>\n<h3 id=\"Smart-Contracts\">Smart Contracts</h3>\n<p>Following are the smart contracts that will be used in the protocol:</p>\n<ul>\n<li><a href=\"https://github.com/uport-project/ethr-did-registry/blob/develop/contracts/EthereumDIDRegistry.sol\">Ethereum DID Registry smart contract for did:ethr identifiers</a></li>\n<li>DDA Marketplace smart contract\n<ul>\n<li><code>publishDDACID(CID)</code></li>\n<li><code>publishAccessToken(cipher_text, sig, nonce)</code></li>\n</ul>\n</li>\n</ul>\n<h2 id=\"Implementation-Considerations\">Implementation Considerations</h2>\n<p>Successful execution of protocols described in this document might involve invoking sub-protocols; a coroutine approach can simplify this, where it is possible to compose multiple protocols to achieve a complex goal. For e.g. during the exchange of personal data with the identification of individuals, it is necessary for the DS to invoke a \"Connections'' protocol and then a \"Verifications\" protocol, e.t.c, after which the DS gets back to the DUS with a positive or negative response. All this while the DUS can check the status of an active protocol with the DS. This approach is being discussed in detail at <a href=\"https://github.com/hyperledger/aries-rfcs/tree/main/concepts/0478-coprotocols\">Aries RFC 0478</a>.</p>\n<h2 id=\"References\">References</h2>\n<ol>\n<li>Aries RFC 0160 Connection protocol - <a href=\"https://github.com/hyperledger/aries-rfcs/tree/main/features/0160-connection-protocol\">https://github.com/hyperledger/aries-rfcs/tree/main/features/0160-connection-protocol</a></li>\n<li>Aries RFC 0037 Present Proof protocol - <a href=\"https://github.com/hyperledger/aries-rfcs/tree/main/features/0037-present-proof\">https://github.com/hyperledger/aries-rfcs/tree/main/features/0037-present-proof</a></li>\n<li>W3C Data Integrity 1.0 specification - <a href=\"https://w3c-ccg.github.io/data-integrity-spec\">https://w3c-ccg.github.io/data-integrity-spec</a></li>\n<li><a href=\"https://ethereum.org/en/developers/docs/smart-contracts/anatomy/#events-and-logs\">https://ethereum.org/en/developers/docs/smart-contracts/anatomy/#events-and-logs</a></li>\n</ol>\n<h2 id=\"Appendix-A\">Appendix A</h2>\n<h3 id=\"A1-Abbreviations\">A.1\tAbbreviations</h3>\n<table>\n  <tr>\n   <td><strong>Abbr.</strong>\n   </td>\n   <td><strong>Description</strong>\n   </td>\n  </tr>\n  <tr>\n   <td>ADA\n   </td>\n   <td>Automated Data Agreements\n   </td>\n  </tr>\n  <tr>\n   <td>CRUD\n   </td>\n   <td>Create / Read / Update / Delete\n   </td>\n  </tr>\n  <tr>\n   <td>DA\n   </td>\n   <td>Data Agreement \n   </td>\n  </tr>\n  <tr>\n   <td>DAO\n   </td>\n   <td>Decentralized Autonomous Organizations\n   </td>\n  </tr>\n  <tr>\n   <td>DDA\n   </td>\n   <td>Data Disclosure Agreement (Introduced first in this specification)\n   </td>\n  </tr>\n  <tr>\n   <td>DEXA\n   </td>\n   <td>Data Exchange Agreements\n   </td>\n  </tr>\n  <tr>\n   <td>DID\n   </td>\n   <td>Decentralised Identifier (according to W3C)\n   </td>\n  </tr>\n  <tr>\n   <td>DPA\n   </td>\n   <td>Data Processing Agreement\n   </td>\n  </tr>\n  <tr>\n   <td>DPIA\n   </td>\n   <td>Data Protection Impact Assessment\n   </td>\n  </tr>\n  <tr>\n   <td>DS\n   </td>\n   <td>Data Source\n   </td>\n  </tr>\n  <tr>\n   <td>DUS\n   </td>\n   <td>Data Using Service\n   </td>\n  </tr>\n  <tr>\n   <td>EEA\n   </td>\n   <td>European Economic Area\n   </td>\n  </tr>\n  <tr>\n   <td>EU\n   </td>\n   <td>European Union\n   </td>\n  </tr>\n  <tr>\n   <td>GDPR\n   </td>\n   <td>General Data Protection Regulation\n   </td>\n  </tr>\n  <tr>\n   <td>IPFS\n   </td>\n   <td>Inter Planetary File System\n   </td>\n  </tr>\n  <tr>\n   <td>ISO\n   </td>\n   <td>International Organization for Standardization\n   </td>\n  </tr>\n  <tr>\n   <td>JSON\n   </td>\n   <td>JavaScript Object Notation\n   </td>\n  </tr>\n  <tr>\n   <td>SDK\n   </td>\n   <td>Software Development Kit\n   </td>\n  </tr>\n  <tr>\n   <td>SSI\n   </td>\n   <td>Self Sovereign Identity\n   </td>\n  </tr>\n  <tr>\n   <td>ToIP\n   </td>\n   <td>Trust over Internet Protocol\n   </td>\n  </tr>\n  <tr>\n   <td>VC\n   </td>\n   <td>Verifiable credentials\n   </td>\n  </tr>\n  <tr>\n   <td>W3C\n   </td>\n   <td>World wide web consortium\n   </td>\n  </tr>\n</table>\n<h3 id=\"A2-Terminology\">A.2\tTerminology</h3>\n<table>\n  <tr>\n   <td><strong>Term</strong>\n   </td>\n   <td><strong>Description</strong>\n   </td>\n  </tr>\n  <tr>\n   <td>Data Agreement (DA)\n   </td>\n   <td>A data agreement exists between organisations and individuals in the use of personal data. This agreement can have any legal basis outlined according to any data protection regulation, such as the GDPR.\n   </td>\n  </tr>\n  <tr>\n   <td>Data Disclosure Agreement (DDA)\n   </td>\n   <td>Data disclosure agreements are formal contracts that detail what data is being shared and the appropriate use for the data between a DS and a DUS. It records conditions on which a DUS will consume data from a DS. A DDA could contain both personal and non-personal data.\n   </td>\n  </tr>\n  <tr>\n   <td>Decentralised IDentifier (DID)\n   </td>\n   <td>A DID is a new type of identifier that is globally unique, resolvable with high availability, and cryptographically verifiable. DIDs are typically associated with cryptographic material, such as public keys and service endpoints, for establishing secure communication channels.\n   </td>\n  </tr>\n  <tr>\n   <td>Data Processing Agreement\n   </td>\n   <td>A Data Processing Agreement is a legally binding contract, either in written or electronic form, entered between a data processor and a data controller that states the rights and obligations of each party concerning the protection of personal data. The agreement will be legally binding in any data protection regulation, such as the GDPR.\n   </td>\n  </tr>\n  <tr>\n   <td>Data Source (DS)\n   </td>\n   <td>The role responsible for collecting, storing, and controlling personal data that persons, operators, and DUSs may wish to access and use; is defined as per MyData.\n   </td>\n  </tr>\n  <tr>\n   <td>Data Using Service (DUS)\n   </td>\n   <td>The role responsible for processing personal data from one or more data sources to deliver a service; is defined as per MyData\n   </td>\n  </tr>\n  <tr>\n   <td>Data Protection Impact Assessment (DPIA).\n   </td>\n   <td>A Data Protection Impact Assessment is a process designed to help systematically analyse, identify and minimise the data protection risks of a project or plan.\n   </td>\n  </tr>\n  <tr>\n   <td>Individual\n   </td>\n   <td>A natural, living human being, in the GDPR, also referred to as a data subject\n   </td>\n  </tr>\n  <tr>\n   <td>Inter Planetary File System (IPFS\n   </td>\n   <td>The InterPlanetary File System (IPFS) is a protocol and peer-to-peer network for storing and sharing data in a distributed file system. IPFS uses content-addressing to uniquely identify each file in a global namespace connecting all computing devices\n   </td>\n  </tr>\n  <tr>\n   <td>Self Sovereign Identity\n   </td>\n   <td>A model for managing digital identities where individual identity holders can create and control their verifiable credentials without being forced to request permission from an intermediary or centralised authority and give control over how their data is shared and used\n   </td>\n  </tr>\n</table>"}},
    "staticQueryHashes": ["3000541721","3766577012"],
    "matchPath": "data-disclosure-agreement/1.0/*"}
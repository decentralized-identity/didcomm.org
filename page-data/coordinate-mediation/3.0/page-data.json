{
    "componentChunkName": "component---src-templates-protocol-protocol-tsx",
    "path": "/coordinate-mediation/3.0/",
    "result": {"data":{"markdownRemark":{"html":"<h1 id=\"Motivation\">Motivation</h1>\n<p>Use of the forward message in the Routing Protocol 3.0 requires an exchange of information. The <em>Recipient</em> must know which endpoint and routing did(s) to share, and the <em>Mediator</em> needs to know which did should be routed via this relationship.</p>\n<h2 id=\"Roles\">Roles</h2>\n<p>There are two roles in this protocol:</p>\n<ul>\n<li><code>mediator</code>: The agent that will be receiving <code>forward</code> messages on behalf of the <em>recipient</em>.</li>\n<li><code>recipient</code>: The agent for whom the <code>forward</code> message payload is intended.</li>\n</ul>\n<h2 id=\"Requirements\">Requirements</h2>\n<p>The <code>return_route</code> extension must be supported by both agents (<code>recipient</code> and <code>mediator</code>).\nThe common use of this protocol is for the reply messages from the <code>mediator</code> to be synchronous, utilizing the same connection channel for the reply. In order to have this synchronous behavior the <code>recipient</code> should specify <code>return_route</code> header to <code>all</code>.\nThis header must be set each time the communication channel is established: once per established websocket, and every message for an HTTP POST.</p>\n<h2 id=\"Connectivity\">Connectivity</h2>\n<p>This protocol consists of three different message requests from the <code>recipient</code> that should be replied by the <code>mediator</code>:</p>\n<ol>\n<li>Mediate Request -> Mediate Grant or Mediate Deny</li>\n<li>Recipient Update -> Recipient Update Response</li>\n<li>Recipient Query -> Recipient</li>\n</ol>\n<h2 id=\"States\">States</h2>\n<p>This protocol follows the request-response message exchange pattern, and only requires the simple state of waiting for a response or to produce a response.</p>\n<h2 id=\"Basic-Walkthrough\">Basic Walkthrough</h2>\n<p>A <code>recipient</code> may discover an agent capable of routing using the Discover Features Protocol 2.0. If protocol is supported with the <code>mediator</code>, a <code>recipient</code> may send a <code>mediate-request</code> to initiate a routing relationship.</p>\n<p>First, the <code>recipient</code> sends a <code>mediate-request</code> message to the <code>mediator</code>. If the <code>mediator</code> is willing to route messages, it will respond with a <code>mediate-grant</code> message, otherwise with a <code>mediate-deny</code> message. The <code>recipient</code> will share the routing information in the grant message with other contacts.</p>\n<p>When a new DID is used by the <code>recipient</code>, it must be registered with the <code>mediator</code> to enable route identification. This is done with a <code>recipient-update</code> message.</p>\n<p>The <code>recipient-update</code> and <code>recipient-query</code> methods are used over time to identify and remove DIDs that are no longer in use by the <code>recipient</code>.</p>\n<h2 id=\"Design-By-Contract\">Design By Contract</h2>\n<p>No protocol specific errors exist. Any errors related to headers or other core features are documented in the appropriate places.</p>\n<h2 id=\"Security\">Security</h2>\n<p>This protocol expects messages to be encrypted during transmission, and repudiable.</p>\n<h2 id=\"Composition\">Composition</h2>\n<table>\n<thead>\n<tr>\n<th>Supported Goal Code</th>\n<th>Notes</th>\n</tr>\n</thead>\n</table>\n<h2 id=\"Message-Reference\">Message Reference</h2>\n<h3 id=\"Mediate-Request\">Mediate Request</h3>\n<p>This message serves as a request from the <code>recipient</code> to the <code>mediator</code>, asking for the permission (and routing information) to publish the endpoint as a mediator.</p>\n<p>Message Type URI: <code>https://didcomm.org/coordinate-mediation/3.0/mediate-request</code></p>\n<pre><code class=\"language-json\">{\n    \"id\": \"123456780\",\n    \"type\": \"https://didcomm.org/coordinate-mediation/3.0/mediate-request\",\n}\n</code></pre>\n<h3 id=\"Mediate-Deny\">Mediate Deny</h3>\n<p>This message serves as notification of the <code>mediator</code> denying the <code>recipient</code>'s request for mediation.</p>\n<p>Message Type URI: <code>https://didcomm.org/coordinate-mediation/3.0/mediate-deny</code></p>\n<pre><code class=\"language-json\">{\n    \"id\": \"123456780\",\n    \"type\": \"https://didcomm.org/coordinate-mediation/3.0/mediate-deny\",\n}\n</code></pre>\n<h3 id=\"Mediate-Grant\">Mediate Grant</h3>\n<p>A mediate grant message is a signal from the <code>mediator</code> to the <code>recipient</code> that permission is given to distribute the included information as an inbound route.</p>\n<p>Message Type URI: <code>https://didcomm.org/coordinate-mediation/3.0/mediate-grant</code></p>\n<pre><code class=\"language-json\">{\n    \"id\": \"123456780\",\n    \"type\": \"https://didcomm.org/coordinate-mediation/3.0/mediate-grant\",\n    \"body\": \n            {\n                \"routing_did\": [\"did:peer:0z6Mkfriq1MqLBoPWecGoDLjguo1sB9brj6wT3qZ5BxkKpuP6\"]\n            }\n}\n</code></pre>\n<p>where:</p>\n<ul>\n<li><code>routing_did</code>: DID of the mediator where forwarded messages should be sent. The <code>recipient</code> may use this DID as an enpoint as explained in <a href=\"https://identity.foundation/didcomm-messaging/spec/#using-a-did-as-an-endpoint\">Using a DID as an endpoint</a> section of the specification.</li>\n</ul>\n<p><strong>NOTE</strong>: After receiving a <code>mediate-grant</code> message the <code>recipient</code> should update his <code>recipient_did</code> with a <code>recipient-update</code> message and add DIDs. In order for the <code>mediator</code> to start accepting Forward Message for those DIDs.</p>\n<h3 id=\"Recipient-Update\">Recipient Update</h3>\n<p>Used to notify the <code>mediator</code> of DIDs in use by the <code>recipient</code>.</p>\n<p>Message Type URI: <code>https://didcomm.org/coordinate-mediation/3.0/recipient-update</code></p>\n<pre><code class=\"language-json\">{\n    \"id\": \"123456780\",\n    \"type\": \"https://didcomm.org/coordinate-mediation/3.0/recipient-update\",\n    \"body\": {\n        \"updates\": [\n            {\n                \"recipient_did\": \"did:peer:0z6MkpTHR8VNsBxYAAWHut2Geadd9jSwuBV8xRoAnwWsdvktH\",\n                \"action\": \"add\"\n            }\n        ]\n    },\n    \"return_route\": \"all\"\n}\n</code></pre>\n<p>where:</p>\n<ul>\n<li><code>recipient_did</code>: DID subject of the update.</li>\n<li><code>action</code>: one of <code>add</code> or <code>remove</code>.</li>\n</ul>\n<h3 id=\"Recipient-Response\">Recipient Response</h3>\n<p>Confirmation of requested Recipient DID updates.</p>\n<p>Message Type URI: <code>https://didcomm.org/coordinate-mediation/3.0/recipient-update-response</code></p>\n<pre><code class=\"language-json\">{\n    \"id\": \"123456780\",\n    \"type\": \"https://didcomm.org/coordinate-mediation/3.0/recipient-update-response\",\n    \"body\": {\n        \"updated\": [\n            {\n                \"recipient_did\": \"did:peer:0z6MkpTHR8VNsBxYAAWHut2Geadd9jSwuBV8xRoAnwWsdvktH\",\n                \"action\": \"\" // \"add\" or \"remove\"\n                \"result\": \"\" // [client_error | server_error | no_change | success]\n            }\n        ]\n    }\n}\n</code></pre>\n<p>where:</p>\n<ul>\n<li><code>recipient_did</code>: DID subject of the update.</li>\n<li><code>action</code>: one of <code>add</code> or <code>remove</code>.</li>\n<li><code>result</code>: one of <code>client_error</code>, <code>server_error</code>, <code>no_change</code>, <code>success</code>; describes the resulting state of the Recipient update.</li>\n</ul>\n<h3 id=\"Recipient-Query\">Recipient Query</h3>\n<p>Query <code>mediator</code> for a list of DIDs registered for this connection.</p>\n<p>Message Type URI: <code>https://didcomm.org/coordinate-mediation/3.0/recipient-query</code></p>\n<pre><code class=\"language-json\">{\n    \"id\": \"123456780\",\n    \"type\": \"https://didcomm.org/coordinate-mediation/3.0/recipient-query\",\n    \"body\": {\n        \"paginate\": {\n            \"limit\": 30,\n            \"offset\": 0\n        }\n    }\n}\n</code></pre>\n<p>where:</p>\n<ul>\n<li><code>paginate</code>: is optional, and if present must include <code>limit</code> and <code>offset</code>.</li>\n</ul>\n<h3 id=\"Recipient\">Recipient</h3>\n<p>Response to recipient query, containing retrieved recipient DIDs.</p>\n<p>Message Type URI: <code>https://didcomm.org/coordinate-mediation/3.0/recipient</code></p>\n<pre><code class=\"language-json\">{\n    \"id\": \"123456780\",\n    \"type\": \"https://didcomm.org/coordinate-mediation/3.0/recipient\",\n    \"body\": {\n        \"dids\": [\n            {\n                \"recipient_did\": \"did:peer:0z6MkpTHR8VNsBxYAAWHut2Geadd9jSwuBV8xRoAnwWsdvktH\"\n            }\n        ],\n        \"pagination\": {\n            \"count\": 30,\n            \"offset\": 30,\n            \"remaining\": 100\n        }\n    }\n}\n</code></pre>\n<p>where:</p>\n<ul>\n<li><code>pagination</code>: is optional, and if present must include <code>count</code>, <code>offset</code> and <code>remaining</code>.</li>\n</ul>\n<h2 id=\"L10n\">L10n</h2>\n<p>No localization is required.</p>\n<h2 id=\"Implementations\">Implementations</h2>\n<h2 id=\"Endnotes\">Endnotes</h2>\n<h3 id=\"Future-Considerations\">Future Considerations</h3>\n<ul>\n<li>Should we allow listing dids by date? You could query dids in use by date?</li>\n<li>We are missing a way to check a single did (or a few dids) without doing a full list.</li>\n<li>Mediation grant supports only one endpoint. What can be done to support multiple endpoint options i.e. http, ws, etc.</li>\n<li>Requiring proof of did ownership (with a signature) would prevent an edge case where a malicious party registers a did for another party at the same mediator, and before the other party.</li>\n<li>How do we express terms and conditions for mediation?</li>\n</ul>","frontmatter":{"title":"Coordinate Mediation","tags":[],"license":"MIT","publisher":"rodolfomiranda","status":"Production","piuri":"https://didcomm.org/coordinate-mediation/3.0","summary":"A protocol to coordinate mediation configuration between a mediating agent and the recipient.","authors":[{"name":null,"email":null}]},"fields":{"modifiedDate":"Mon Mar 17 2025 19:26:22 GMT+0000 (Coordinated Universal Time)","avatar":"https://avatars.githubusercontent.com/u/2913773?v=4&s=48","version":"3.0"}}},"pageContext":{"matchPath":"coordinate-mediation/3.0/*","id":"8995f608-70bb-5513-958f-c2f54371f5a3","html":"<h1 id=\"Motivation\">Motivation</h1>\n<p>Use of the forward message in the Routing Protocol 3.0 requires an exchange of information. The <em>Recipient</em> must know which endpoint and routing did(s) to share, and the <em>Mediator</em> needs to know which did should be routed via this relationship.</p>\n<h2 id=\"Roles\">Roles</h2>\n<p>There are two roles in this protocol:</p>\n<ul>\n<li><code>mediator</code>: The agent that will be receiving <code>forward</code> messages on behalf of the <em>recipient</em>.</li>\n<li><code>recipient</code>: The agent for whom the <code>forward</code> message payload is intended.</li>\n</ul>\n<h2 id=\"Requirements\">Requirements</h2>\n<p>The <code>return_route</code> extension must be supported by both agents (<code>recipient</code> and <code>mediator</code>).\nThe common use of this protocol is for the reply messages from the <code>mediator</code> to be synchronous, utilizing the same connection channel for the reply. In order to have this synchronous behavior the <code>recipient</code> should specify <code>return_route</code> header to <code>all</code>.\nThis header must be set each time the communication channel is established: once per established websocket, and every message for an HTTP POST.</p>\n<h2 id=\"Connectivity\">Connectivity</h2>\n<p>This protocol consists of three different message requests from the <code>recipient</code> that should be replied by the <code>mediator</code>:</p>\n<ol>\n<li>Mediate Request -&gt; Mediate Grant or Mediate Deny</li>\n<li>Recipient Update -&gt; Recipient Update Response</li>\n<li>Recipient Query -&gt; Recipient</li>\n</ol>\n<h2 id=\"States\">States</h2>\n<p>This protocol follows the request-response message exchange pattern, and only requires the simple state of waiting for a response or to produce a response.</p>\n<h2 id=\"Basic-Walkthrough\">Basic Walkthrough</h2>\n<p>A <code>recipient</code> may discover an agent capable of routing using the Discover Features Protocol 2.0. If protocol is supported with the <code>mediator</code>, a <code>recipient</code> may send a <code>mediate-request</code> to initiate a routing relationship.</p>\n<p>First, the <code>recipient</code> sends a <code>mediate-request</code> message to the <code>mediator</code>. If the <code>mediator</code> is willing to route messages, it will respond with a <code>mediate-grant</code> message, otherwise with a <code>mediate-deny</code> message. The <code>recipient</code> will share the routing information in the grant message with other contacts.</p>\n<p>When a new DID is used by the <code>recipient</code>, it must be registered with the <code>mediator</code> to enable route identification. This is done with a <code>recipient-update</code> message.</p>\n<p>The <code>recipient-update</code> and <code>recipient-query</code> methods are used over time to identify and remove DIDs that are no longer in use by the <code>recipient</code>.</p>\n<h2 id=\"Design-By-Contract\">Design By Contract</h2>\n<p>No protocol specific errors exist. Any errors related to headers or other core features are documented in the appropriate places.</p>\n<h2 id=\"Security\">Security</h2>\n<p>This protocol expects messages to be encrypted during transmission, and repudiable.</p>\n<h2 id=\"Composition\">Composition</h2>\n<table>\n<thead>\n<tr>\n<th>Supported Goal Code</th>\n<th>Notes</th>\n</tr>\n</thead>\n</table>\n<h2 id=\"Message-Reference\">Message Reference</h2>\n<h3 id=\"Mediate-Request\">Mediate Request</h3>\n<p>This message serves as a request from the <code>recipient</code> to the <code>mediator</code>, asking for the permission (and routing information) to publish the endpoint as a mediator.</p>\n<p>Message Type URI: <code>https://didcomm.org/coordinate-mediation/3.0/mediate-request</code></p>\n<pre><code class=\"language-json\">{\n    \"id\": \"123456780\",\n    \"type\": \"https://didcomm.org/coordinate-mediation/3.0/mediate-request\",\n}\n</code></pre>\n<h3 id=\"Mediate-Deny\">Mediate Deny</h3>\n<p>This message serves as notification of the <code>mediator</code> denying the <code>recipient</code>'s request for mediation.</p>\n<p>Message Type URI: <code>https://didcomm.org/coordinate-mediation/3.0/mediate-deny</code></p>\n<pre><code class=\"language-json\">{\n    \"id\": \"123456780\",\n    \"type\": \"https://didcomm.org/coordinate-mediation/3.0/mediate-deny\",\n}\n</code></pre>\n<h3 id=\"Mediate-Grant\">Mediate Grant</h3>\n<p>A mediate grant message is a signal from the <code>mediator</code> to the <code>recipient</code> that permission is given to distribute the included information as an inbound route.</p>\n<p>Message Type URI: <code>https://didcomm.org/coordinate-mediation/3.0/mediate-grant</code></p>\n<pre><code class=\"language-json\">{\n    \"id\": \"123456780\",\n    \"type\": \"https://didcomm.org/coordinate-mediation/3.0/mediate-grant\",\n    \"body\": \n            {\n                \"routing_did\": [\"did:peer:0z6Mkfriq1MqLBoPWecGoDLjguo1sB9brj6wT3qZ5BxkKpuP6\"]\n            }\n}\n</code></pre>\n<p>where:</p>\n<ul>\n<li><code>routing_did</code>: DID of the mediator where forwarded messages should be sent. The <code>recipient</code> may use this DID as an enpoint as explained in <a href=\"https://identity.foundation/didcomm-messaging/spec/#using-a-did-as-an-endpoint\">Using a DID as an endpoint</a> section of the specification.</li>\n</ul>\n<p><strong>NOTE</strong>: After receiving a <code>mediate-grant</code> message the <code>recipient</code> should update his <code>recipient_did</code> with a <code>recipient-update</code> message and add DIDs. In order for the <code>mediator</code> to start accepting Forward Message for those DIDs.</p>\n<h3 id=\"Recipient-Update\">Recipient Update</h3>\n<p>Used to notify the <code>mediator</code> of DIDs in use by the <code>recipient</code>.</p>\n<p>Message Type URI: <code>https://didcomm.org/coordinate-mediation/3.0/recipient-update</code></p>\n<pre><code class=\"language-json\">{\n    \"id\": \"123456780\",\n    \"type\": \"https://didcomm.org/coordinate-mediation/3.0/recipient-update\",\n    \"body\": {\n        \"updates\": [\n            {\n                \"recipient_did\": \"did:peer:0z6MkpTHR8VNsBxYAAWHut2Geadd9jSwuBV8xRoAnwWsdvktH\",\n                \"action\": \"add\"\n            }\n        ]\n    },\n    \"return_route\": \"all\"\n}\n</code></pre>\n<p>where:</p>\n<ul>\n<li><code>recipient_did</code>: DID subject of the update.</li>\n<li><code>action</code>: one of <code>add</code> or <code>remove</code>.</li>\n</ul>\n<h3 id=\"Recipient-Response\">Recipient Response</h3>\n<p>Confirmation of requested Recipient DID updates.</p>\n<p>Message Type URI: <code>https://didcomm.org/coordinate-mediation/3.0/recipient-update-response</code></p>\n<pre><code class=\"language-json\">{\n    \"id\": \"123456780\",\n    \"type\": \"https://didcomm.org/coordinate-mediation/3.0/recipient-update-response\",\n    \"body\": {\n        \"updated\": [\n            {\n                \"recipient_did\": \"did:peer:0z6MkpTHR8VNsBxYAAWHut2Geadd9jSwuBV8xRoAnwWsdvktH\",\n                \"action\": \"\" // \"add\" or \"remove\"\n                \"result\": \"\" // [client_error | server_error | no_change | success]\n            }\n        ]\n    }\n}\n</code></pre>\n<p>where:</p>\n<ul>\n<li><code>recipient_did</code>: DID subject of the update.</li>\n<li><code>action</code>: one of <code>add</code> or <code>remove</code>.</li>\n<li><code>result</code>: one of <code>client_error</code>, <code>server_error</code>, <code>no_change</code>, <code>success</code>; describes the resulting state of the Recipient update.</li>\n</ul>\n<h3 id=\"Recipient-Query\">Recipient Query</h3>\n<p>Query <code>mediator</code> for a list of DIDs registered for this connection.</p>\n<p>Message Type URI: <code>https://didcomm.org/coordinate-mediation/3.0/recipient-query</code></p>\n<pre><code class=\"language-json\">{\n    \"id\": \"123456780\",\n    \"type\": \"https://didcomm.org/coordinate-mediation/3.0/recipient-query\",\n    \"body\": {\n        \"paginate\": {\n            \"limit\": 30,\n            \"offset\": 0\n        }\n    }\n}\n</code></pre>\n<p>where:</p>\n<ul>\n<li><code>paginate</code>: is optional, and if present must include <code>limit</code> and <code>offset</code>.</li>\n</ul>\n<h3 id=\"Recipient\">Recipient</h3>\n<p>Response to recipient query, containing retrieved recipient DIDs.</p>\n<p>Message Type URI: <code>https://didcomm.org/coordinate-mediation/3.0/recipient</code></p>\n<pre><code class=\"language-json\">{\n    \"id\": \"123456780\",\n    \"type\": \"https://didcomm.org/coordinate-mediation/3.0/recipient\",\n    \"body\": {\n        \"dids\": [\n            {\n                \"recipient_did\": \"did:peer:0z6MkpTHR8VNsBxYAAWHut2Geadd9jSwuBV8xRoAnwWsdvktH\"\n            }\n        ],\n        \"pagination\": {\n            \"count\": 30,\n            \"offset\": 30,\n            \"remaining\": 100\n        }\n    }\n}\n</code></pre>\n<p>where:</p>\n<ul>\n<li><code>pagination</code>: is optional, and if present must include <code>count</code>, <code>offset</code> and <code>remaining</code>.</li>\n</ul>\n<h2 id=\"L10n\">L10n</h2>\n<p>No localization is required.</p>\n<h2 id=\"Implementations\">Implementations</h2>\n<h2 id=\"Endnotes\">Endnotes</h2>\n<h3 id=\"Future-Considerations\">Future Considerations</h3>\n<ul>\n<li>Should we allow listing dids by date? You could query dids in use by date?</li>\n<li>We are missing a way to check a single did (or a few dids) without doing a full list.</li>\n<li>Mediation grant supports only one endpoint. What can be done to support multiple endpoint options i.e. http, ws, etc.</li>\n<li>Requiring proof of did ownership (with a signature) would prevent an edge case where a malicious party registers a did for another party at the same mediator, and before the other party.</li>\n<li>How do we express terms and conditions for mediation?</li>\n</ul>"}},
    "staticQueryHashes": ["3000541721","3766577012"],
    "matchPath": "coordinate-mediation/3.0/*"}